!function(t){"use strict";t.WS_Form.prototype.set_is_admin=function(){return!0},t.WS_Form.prototype.init=function(){this.set_globals(),this.form_build(),this.sidebar_reset(),this.window_resize_init(),this.keydown_events_init(),this.intro()},t.WS_Form.prototype.keydown_events_init=function(){t(document).keydown(function(e){var i=void 0!==e.metaKey&&e.metaKey||void 0!==e.ctrlKey&&e.ctrlKey;if("object"==typeof t.WS_Form.this.keydown[e.keyCode]){var a=t.WS_Form.this.keydown[e.keyCode];(a.ctrl_key&&i||!a.ctrl_key)&&(e.preventDefault(),a.function())}})},t.WS_Form.prototype.window_resize_init=function(){t(window).on("resize",function(){("toolbox"==t("#wsf-sidebars").attr("data-current")||null==t("#wsf-sidebars").attr("data-current"))&&t("#wsf-sidebar-toolbox").hasClass("wsf-sidebar-closed")&&window.matchMedia("(min-width: 851px)").matches&&t.WS_Form.this.sidebar_open("toolbox")})},t.WS_Form.prototype.set_globals=function(e,i){this.framework_id=void 0!==e?e:t.WS_Form.settings_plugin.framework,this.framework=t.WS_Form.frameworks.types[this.framework_id],this.framework_fields=this.framework.fields[void 0!==i?i:"admin"],this.invalid_feedback_mask_placeholder="",void 0!==t.WS_Form.meta_keys.invalid_feedback&&void 0!==t.WS_Form.meta_keys.invalid_feedback.mask_placeholder&&(this.invalid_feedback_mask_placeholder=t.WS_Form.meta_keys.invalid_feedback.mask_placeholder)},t.WS_Form.prototype.intro=function(){if("function"==typeof introJs){var e=this;t.WS_Form.this.api_call("helper/intro/","GET",!1,function(i){if(t.WS_Form.this.loader_off(),"object"==typeof i){var a=[],o=[],s=[];for(var r in i){var n=i[r],d={};void 0!==n.hint&&(d.hint=n.hint),void 0!==n.position&&(d.hintPosition=n.position),void 0!==n.element&&(d.element=t(n.element)[0]),void 0!==n.sidebar_open&&(o[r]=n.sidebar_open),void 0!==n.button_url&&(s[r]=n.button_url),a.push(d)}var _=introJs();_.setOptions({hints:a}),_.onhintclick(function(i,a,r){if(void 0!==o[r]){var n=o[r],d="sidebar_"+n+"_open";if("function"==typeof window[d]){var _=t("#wsf-sidebar-"+n),l=t(".wsf-sidebar-inner",_);window[d](t.WS_Form.this,l,t(this))}else t.WS_Form.this.sidebar_open(n)}if(void 0!==s[r]){var c=s[r];setTimeout(function(){t(".introjs-tooltiptext").append('&nbsp;<a href="'+c+'" class="introjs-button" role="button" target="_blank">'+e.language("intro_learn_more")+"</a>"),t(".introjs-tooltiptext").append('<div data-action="wsf-intro-skip" class="wsf-intro-skip">'+e.language("intro_skip")+"</div>"),t('[data-action="wsf-intro-skip"]',t(".introjs-tooltiptext")).click(function(){introJs().hideHints()})},50)}}),_.addHints()}})}},t.WS_Form.prototype.form_render=function(){t('[data-action="wsf-form-label"]').val(this.form.label),this.form_interface||(this.sidebars_render(),this.breakpoints(),t('[data-action="wsf-form-label"]').change(function(e){if(e.originalEvent){var i=t(this).val();""==i&&(i=t.WS_Form.this.get_label_default("form"),t(this).val(i)),t.WS_Form.this.form.label=i,t.WS_Form.this.form_put()}}),t('[data-action="wsf-form-label"]').keyup(function(){t('#wsf-sidebar-form [name="label"]').val(t(this).val())}),t('[data-action="wsf-publish"]').click(function(){t.WS_Form.this.form_publish()}),t.WS_Form.settings_plugin.helper_live_preview&&t('[data-action="wsf-preview"]').click(function(e){t.WS_Form.this.form_preview(e,t(this))}),t('[data-action="wsf-form-upload"]').click(function(){t('input[id="wsf-form-upload-file"]').click()}),t('input[id="wsf-form-upload-file"]').change(function(){var e=t('input[id="wsf-form-upload-file"]').prop("files");if(e.length>0){var i=t(".wsf-form-upload-json-window",t.WS_Form.this.form_obj);i.fadeIn(200),t.WS_Form.this.form_upload_json(e,i,function(e){t.WS_Form.this.form_build()},function(){},!0)}}),t('[data-action="wsf-form-download"]').click(function(){t.WS_Form.this.form_download()}),t('[data-action="wsf-undo"]').click(function(){t.WS_Form.this.undo()}),t('[data-action="wsf-redo"]').click(function(){t.WS_Form.this.redo()}),this.mouseup_mode=!1,t(document).mouseup(function(){switch(t.WS_Form.this.mouseup_mode){case"column_size":t.WS_Form.this.column_size_change_release();break;case"offset":t.WS_Form.this.offset_change_release()}}),this.form_interface=!0);var e='<li class="wsf-group-add wsf-ui-cancel" title="'+this.language("add_group")+'"><button tabindex="-1">'+this.svg("group")+this.svg("plus")+"</button></li>";t(".wsf-group-tabs").append(e),t(".wsf-group-add button").click(function(){t.WS_Form.this.group_post(t(this))}),this.group_tabs_init(),this.undo_redo_update(),t(".wsf-group").each(function(){t.WS_Form.this.group_render(t(this))}),this.breakpoint_buttons(),this.init_ui(),this.form_obj.append('<div class="wsf-form-upload-json-window"><div class="wsf-form-upload-json-window-content"><h1>'+this.language("form_upload_json")+'</h1><div class="wsf-uploads"></div></div></div>'),this.form_obj.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t(".wsf-form-upload-json-window",t(this)).fadeIn(200)}),t(".wsf-form-upload-json-window",this.form_obj).on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),t(".wsf-form-upload-json-window",this.form_obj).on("drop",function(e){e.preventDefault();var i=e.originalEvent.dataTransfer.files;t.WS_Form.this.form_upload_json(i,t(this),function(e){t.WS_Form.this.form_build()},function(){t(".wsf-form-upload-json-window",t.WS_Form.this.form_obj).fadeOut(200)},!0)}),t(".wsf-form-upload-json-window",this.form_obj).on("dragleave",function(e){t(".wsf-form-upload-json-window",t.WS_Form.this.form_obj).fadeOut(200)}),this.field_check_multiple(),t(".wsf-loading-hidden").show()},t.WS_Form.prototype.form_put=function(e,i,a,o){if(void 0===e)e=!1;if(void 0===i)i=!0;if(void 0===a)a=!1;var s=t.extend(!0,{},this.form);e||delete s.groups,i&&t.WS_Form.this.form_build(),a&&(s.history_suppress="on"),this.api_call("form/"+this.form_id+(e?"/full":""),"PUT",{form:s},function(e){void 0!==o&&o(),a||t.WS_Form.this.preview_update(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.form_publish=function(){this.loader_on(),this.api_call("form/"+this.form_id+"/publish/","PUT",!1,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.form_preview=function(e,i){e.preventDefault(),this.preview_window&&!this.preview_window.closed||(this.preview_window=window.open(i.attr("href"),"wsf-preview-"+this.form_id),t(window).on("beforeunload",function(){t.WS_Form.this.preview_window.close(),this.preview_window=void 0})),this.preview_window.focus()},t.WS_Form.prototype.form_upload_json=function(e,i,a,o,s){if(void 0===s)s=!1;if(s&&!confirm(t.WS_Form.this.language("form_import_confirm")))return t(".wsf-form-upload-json-window",t.WS_Form.this.form_obj).hide(),void o();if(t("h1",i).hide(),0==e.length)return o(),!1;var r=new FormData;r.append("form_id",this.form_id),r.append("file",e[0]),r.append(ws_form_settings.wsf_nonce_field_name,ws_form_settings.wsf_nonce),this.sidebar_reset();var n=new this.upload_status_bar(i);n.populate(e[0].name,e[0].size),this.form_upload_ajax(r,n,i,a,o)},t.WS_Form.prototype.form_upload_ajax=function(e,i,a,o,s){var r=t.ajax({beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ws_form_settings.x_wp_nonce)},xhr:function(){var e=t.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(t){var e=0,a=t.loaded||t.position,o=t.total;t.lengthComputable&&(e=Math.ceil(a/o*100)),i.set_progress(e)},!1),e},url:ws_form_settings.url+"form/"+this.form_id+"/upload/json",type:"POST",contentType:!1,processData:!1,cache:!1,data:e,statusCode:{200:function(e){i.set_progress(100),void 0!==e.form&&void 0!==e.form_full&&e.form_full&&(t.WS_Form.this.form=e.form,t.WS_Form.this.data_cache_build(),void 0!==e.form.checksum&&void 0!==e.form.published_checksum&&(t.WS_Form.this.published_checksum=e.form.published_checksum,t.WS_Form.this.publish_render(e.form.checksum))),void 0!==e.history&&t.WS_Form.this.history_push(e),"function"==typeof o&&o(e)},400:function(e){var i=e.responseJSON;i.error&&(i.error&&(i.error_message?t.WS_Form.this.error("error_bad_request_message",i.error_message):t.WS_Form.this.error("error_bad_request")),s())},403:function(e){t.WS_Form.this.error("error_forbidden",url),s()},404:function(e){t.WS_Form.this.error("error_not_found",url),s()},500:function(e){t.WS_Form.this.error("error_server",url),s()}}});i.set_abort(r)},t.WS_Form.prototype.form_download=function(){var e='<form id="wsf-data-grid-downloader" action="'+ws_form_settings.url+"form/"+this.form_id+'/download/json" method="post">';e+='<input type="hidden" name="form_id" value="'+this.form_id+'" />',e+='<input type="hidden" name="_wpnonce" value="'+ws_form_settings.x_wp_nonce+'" />',e+='<input type="hidden" name="'+ws_form_settings.wsf_nonce_field_name+'" value="'+ws_form_settings.wsf_nonce+'" />',e+="</form>";t("body").append(e);t("#wsf-data-grid-downloader").submit(),t("#wsf-data-grid-downloader").remove()},t.WS_Form.prototype.group_render=function(e){var i=e.attr("data-id");"on"==t.WS_Form.settings_plugin.helper_columns&&e.addClass("wsf-column-helper");this.group_data_cache[i];var a=t('.wsf-group-tab[data-id="'+i+'"]');if(a.length&&!a.find(".wsf-settings").length){var o=this.settings_html("group",i,!0);a.append(o),this.settings_events(a,"group")}var s='<li class="wsf-section-blank"><div>'+this.language("blank_section")+"</div></li>";if(e.find(".wsf-sections").prepend(s),!e.find(".wsf-section-add").length){var r='<div class="wsf-section-add" data-group-id="'+i+'" title="'+this.language("add_section")+'"><button>'+this.svg("section")+this.svg("plus")+"</button></div>";e.append(r),t('.wsf-section-add[data-group-id="'+i+'"] button').click(function(){t.WS_Form.this.section_post(t(this))})}this.label_init(a),e.find(".wsf-section").each(function(){t.WS_Form.this.section_render(t(this),!1)})},t.WS_Form.prototype.group_tabs_init=function(e){if(void 0===e)e=this.get_object_meta_value(this.form,"tab_index",0,!0);else t.WS_Form.this.group_tab_index_save(e);t.widget("ui.tabs",t.ui.tabs,{options:{keyboard:!0},_tabKeydown:function(t){if(!this.options.keyboard)return!1;this._super("_tabKeydown")}}),t("#"+this.form_obj_id).hasClass("ui-tabs")&&t("#"+this.form_obj_id).tabs("destroy"),t("#"+this.form_obj_id).tabs({active:e,activate:function(e,i){t.WS_Form.this.loader_on(),t.WS_Form.this.group_tab_index_save(i.newTab.index())}})},t.WS_Form.prototype.group_tab_index_save=function(t){this.set_object_meta_value(this.form,"tab_index",t),this.form_put(!1,!1,!0)},t.WS_Form.prototype.group_post=function(e){this.loader_on();var i=e.index();this.set_object_meta_value(this.form,"tab_index",i);t.WS_Form.this.api_call("group","POST",!1,function(e){var i=t.extend(!0,{},e.data),a=i.id,o=t.WS_Form.this.get_group_html(i);t("#wsf-form").append(o);var s=t('.wsf-group[data-id="'+a+'"]'),r=t.WS_Form.this.get_tab_html(i);t(".wsf-group-tabs li.wsf-group-add").before(r);var n=t('.wsf-group-tab[data-id="'+a+'"]');t.WS_Form.this.group_tabs_init(n.index()),t.WS_Form.this.group_render(s),t("input",n).first().trigger("dblclick"),t.WS_Form.this.init_ui(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.group_put_sort_index=function(e){var i=void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0;if(this.next_sibling_id_old==i)return!1;this.loader_on();var a=e.attr("data-id"),o={next_sibling_id:i};this.set_object_meta_value(this.form,"tab_index",e.index());this.api_call("group/"+a+"/sort_index","PUT",o,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.group_put_clone=function(e){this.loader_on();var i=e.attr("data-id"),a=e.index();this.set_object_meta_value(this.form,"tab_index",a+1);var o={next_sibling_id:void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0},s=e;this.api_call("group/"+i+"/clone","PUT",o,function(e){var a=e.data.id,o=t.WS_Form.this.get_tab_html(e.data),r=t(o).insertAfter(t('.wsf-group-tab[data-id="'+i+'"]')),n=t.WS_Form.this.get_group_html(e.data);t(n).insertAfter(s);var d=t('.wsf-group[data-id="'+a+'"]');t.WS_Form.this.group_render(d),t.WS_Form.this.group_tabs_init(r.index()),t.WS_Form.this.object_blank_update(d),t("input",r).first().trigger("dblclick"),t.WS_Form.this.init_ui(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.section_render=function(e){var i=e.attr("data-id"),a=this.section_data_cache[i],o=this.get_object_meta_value(a,"hidden_section",!1),s=this.get_object_meta_value(a,"disabled_section",!1),r=this.get_object_meta_value(a,"section_repeatable",!1),n=0;o&&n++,s&&n++,r&&n++;for(var d=t(".wsf-section-label",e),_=0;_<4;_++)d.removeClass("wsf-section-icon-count-"+_);if(d.addClass("wsf-section-icon-count-"+n),o?t(".wsf-section-hidden",e).show():t(".wsf-section-hidden",e).hide(),s?t(".wsf-section-disabled",e).show():t(".wsf-section-disabled",e).hide(),r?t(".wsf-section-repeatable",e).show():t(".wsf-section-repeatable",e).hide(),"on"==t.WS_Form.settings_plugin.helper_columns&&e.addClass("wsf-column-helper"),0==e.find(".wsf-settings-section").length){var l=this.settings_html("section",i,!0);l+=this.column_size_change_html(),l+=this.offset_change_html(),e.append(l),this.settings_events(e,"section");var c='<li class="wsf-field-blank"><div>'+this.language("blank_field")+"</div></li>";e.find(".wsf-fields").prepend(c),this.column_size_change_init(e),this.offset_change_init(e),this.label_init(e)}e.find(".wsf-field-wrapper").each(function(){t.WS_Form.this.field_render(t(this))})},t.WS_Form.prototype.section_post=function(e){this.loader_on();var i=e.closest(".wsf-group").attr("data-id"),a={group_id:i};t.WS_Form.this.api_call("section","POST",a,function(e){var a=t.extend(!0,{},e.data),o=a.id,s=t.WS_Form.this.get_section_html(a);t('.wsf-sections[data-id="'+i+'"]').append(s);var r=t('.wsf-section[data-id="'+o+'"]');t.WS_Form.this.section_render(r),t("input",r).first().trigger("dblclick"),t.WS_Form.this.init_ui(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.section_put_sort_index=function(e){var i=void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0,a=e.closest(".wsf-group").attr("data-id");if(this.next_sibling_id_old==i&&this.group_id_old==a)return!1;this.loader_on();var o=e.attr("data-id"),s={group_id:a,next_sibling_id:i};t.WS_Form.this.api_call("section/"+o+"/sort_index","PUT",s,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.section_put_clone=function(e){this.loader_on();var i=e.attr("data-id"),a={next_sibling_id:void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0},o=e;this.api_call("section/"+i+"/clone","PUT",a,function(e){var i=e.data.id,a=t.WS_Form.this.get_section_html(e.data);t(a).insertAfter(o);var s=t('.wsf-section[data-id="'+i+'"]');t.WS_Form.this.section_render(s),t("input",s).first().trigger("dblclick"),t.WS_Form.this.object_blank_update(s),t.WS_Form.this.init_ui(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.field_render=function(e,i){if(void 0===i){var a=e.attr("data-id");i=this.field_data_cache[a]}else a=i.id;t.WS_Form.settings_plugin.helper_field_id&&e.attr("title","#field("+a+")");var o=this.column_class_array(i);e.hasClass("wsf-editing")&&o.push("wsf-editing");var s="wsf-field-wrapper"+(o.length?" "+o.join(" "):"");e.attr("class",s);var r=t.WS_Form.field_type_cache[i.type],n=i.label;if(void 0!==r)var d=r.label,_=r.icon,l=(r.mask_field_label,void 0!==r.mask_preview),c=void 0===r.multiple||r.multiple;else d=this.language("error_field_type_unknown"),_=this.svg("default"),l=!1;var f=this.get_object_meta_value(i,"required",!1),h=this.get_object_meta_value(i,"hidden",!1),u=this.get_object_meta_value(i,"disabled",!1),m=this.get_object_meta_value(i,"readonly",!1),p=this.get_object_meta_value(i,"data_source_last_api_error",""),v=this.field_setting_error(i);v.has_required_setting&&e.attr("data-required-setting","");var b=[];f&&b.push('<span class="wsf-required" title="'+this.language("required")+'"></span>'),h&&b.push('<span title="'+this.language("hidden")+'">'+this.svg("hidden")+"</span>"),u&&b.push('<span title="'+this.language("disabled")+'">'+this.svg("disabled")+"</span>"),m&&b.push('<span title="'+this.language("readonly")+'">'+this.svg("readonly")+"</span>"),!1!==v.field_setting_error&&b.push('<span class="wsf-required-setting" title="'+this.language("required_setting")+'">'+this.svg("warning")+"</span>"),""!==p&&(void 0===this.form_obj.attr("data-data-source-error")&&(this.data_source_error(i,p),this.form_obj.attr("data-data-source-error","")),b.push('<span class="wsf-data-source-error" title="'+this.language("data_grid_data_source_error")+'">'+this.svg("warning")+"</span>"));var g=b.length,w='<div class="wsf-field-inner">';if(w+='<div class="wsf-field-label'+(g>0?" wsf-field-icon-count-"+g:"")+'">'+_,w+=b.join(""),w+='<input type="text" value="'+this.html_encode(n)+'" data-label="'+a+'" readonly maxlength="190"></div>',w+='<div class="wsf-field-type">'+this.html_encode(d),t.WS_Form.settings_plugin.helper_field_id&&(w+='<span class="wsf-field-id">'+this.language("id")+": "+a+"</span>"),w+="</div>",l){var S={text_editor:this.get_object_meta_value(i,"text_editor","",!0),html_editor:this.get_object_meta_value(i,"html_editor","",!0)},W=this.mask_parse(r.mask_preview,S);void 0!==r.meta_wpautop&&r.meta_wpautop&&(W=this.wpautop(W));var F=document.createElement("div");F.innerHTML=W,w+='<div class="wsf-field-preview">'+(W=F.innerHTML)+"</div>"}w+="</div>";var y=void 0!==r.mask_wrappers_drop&&r.mask_wrappers_drop;"recaptcha"==i.type&&"invisible"==this.get_object_meta_value(i,"recaptcha_recaptcha_type","default")&&(y=!0),w+=this.settings_html("field",a,c),y||(w+=this.column_size_change_html(),w+=this.offset_change_html()),e.html(w),this.settings_events(e,"field"),this.label_init(e),y||(this.column_size_change_init(e),this.offset_change_init(e))},t.WS_Form.prototype.fields_setting_error=function(){t("[data-required-setting]",this.form_obj).each(function(){t.WS_Form.this.field_render(t(this))})},t.WS_Form.prototype.field_setting_error=function(e){var i=[];if(void 0===e.meta)return!1;if(void 0===t.WS_Form.meta_keys_required_setting[e.type]&&void 0!==t.WS_Form.field_type_cache[e.type]){var a=t.WS_Form.field_type_cache[e.type],o=this.field_type_meta_keys(a,"required_setting");t.WS_Form.meta_keys_required_setting[e.type]=o}var s=t.WS_Form.meta_keys_required_setting[e.type].length>0;if(s)for(var r in t.WS_Form.meta_keys_required_setting[e.type]){var n=t.WS_Form.meta_keys_required_setting[e.type][r];if(void 0!==e.meta[n]&&""!=e.meta[n]||i.push(n),void 0!==t.WS_Form.meta_keys[n]){var d=t.WS_Form.meta_keys[n];if(void 0!==d.type&&"select"==d.type){if(void 0===d.options)continue;if("fields"==d.options){var _=e.meta[n];void 0===this.field_data_cache[_]&&i.push(n)}if("sections"==d.options){var l=e.meta[n];void 0===this.section_data_cache[l]&&i.push(n)}}}}return{has_required_setting:s,field_setting_error:i.length>0&&i}},t.WS_Form.prototype.object_blank_update=function(e){if(void 0===e)e=t(".wsf-group");t(".wsf-sections",e).each(function(){var e=t(".wsf-section:not(.ui-sortable-helper)",t(this)).length,i=(t(".wsf-section-wrapper.ui-sortable-helper",t(this)).length,t(".wsf-section-placeholder",t(this)).length),a=(t(".wsf-section-blank:visible",t(this)).length,e+i),o=t(".wsf-section-blank",t(this));0==a?o.show():o.hide()}),t(".wsf-fields",e).each(function(){var e=t(".wsf-field-wrapper:not(.ui-sortable-helper)",t(this)).length,i=t(".wsf-field-wrapper.ui-sortable-helper",t(this)).length,a=t(".wsf-field-placeholder",t(this)).length,o=t(".wsf-field-blank:visible",t(this)).length,s=e+a;t.WS_Form.this.dragged_field&&0==e&&1==i&&1==a&&0==o&&(s=0);var r=t(".wsf-field-blank",t(this));0==s?r.show():r.hide()})},t.WS_Form.prototype.field_post=function(e){this.loader_on(),t(".wsf-field-wrapper input:not([readonly])").blur();var i=e.parent().attr("data-id"),a=e.attr("data-type"),o=e.attr("data-width-factor"),s=void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0,r={section_id:i,type:a,next_sibling_id:s};o&&(r.width_factor=o);var n=e;t.WS_Form.this.api_call("field","POST",r,function(a){n.attr("data-id",a.data.id),t.WS_Form.this.field_data_cache[a.data.id]=t.extend(!0,{},a.data),t.WS_Form.this.field_render(n),t("input",e).first().trigger("dblclick"),t.WS_Form.this.object_blank_update(t('.wsf-section[data-id="'+i+'"]')),t.WS_Form.this.field_check_multiple(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.field_type_click_section_id_set=function(){var t=this.get_object_meta_value(this.form,"tab_index",0,!0);if(void 0===this.form.groups)return!1;if(void 0===this.form.groups[t])return!1;var e=this.form.groups[t];if(void 0===e.sections)return!1;var i=!1,a=!1;for(var o in e.sections){var s=e.sections[o];if(!1===i&&(i=s.id),void 0===s.fields)return!1;if(0==s.fields.length){i=s.id;break}for(var r in s.fields){var n=s.fields[r];(!1===a||a<n.date_updated)&&(a=n.date_updated,i=s.id)}}return i},t.WS_Form.prototype.field_check_multiple=function(){var e=[];for(var i in t.WS_Form.field_type_cache)e[i]=!1;for(var a in this.field_data_cache)if(void 0!==this.field_data_cache[a]){var o=this.field_data_cache[a];if(void 0!==o.type){i=o.type;var s=t.WS_Form.field_type_cache[i];if(void 0!==s.multiple)s.multiple||(e[i]=!0)}}for(var i in t.WS_Form.field_type_cache){var r=t('#wsf-form-field-selector [data-type="'+i+'"]');e[i]?r.addClass("wsf-field-disabled"):r.removeClass("wsf-field-disabled")}},t.WS_Form.prototype.field_put_sort_index=function(e){var i=void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0,a=e.closest(".wsf-section").attr("data-id");if(this.next_sibling_id_old==i&&this.section_id_old==a)return!1;this.loader_on();var o=e.attr("data-id"),s={next_sibling_id:i,section_id:a};t.WS_Form.this.api_call("field/"+o+"/sort_index","PUT",s,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.field_put_clone=function(e){this.loader_on();var i=e.attr("data-id"),a={next_sibling_id:void 0!==e.next().attr("data-id")?e.next().attr("data-id"):0},o=e;this.api_call("field/"+i+"/clone","PUT",a,function(e){var i=e.data.id,a=t.WS_Form.this.get_field_html(e.data);t(a).insertAfter(o);var s=t('.wsf-field-wrapper[data-id="'+i+'"]');s.hide(),t.WS_Form.this.field_render(s),s.show(),t("input",s).first().trigger("dblclick"),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.label_init=function(e){var i=e.find("input").first();e.attr("data-id"),t.WS_Form.this.get_object_type(e);i.on("keyup",function(e){var i=t(this).closest("[data-id]"),a=i.attr("data-id"),o=t.WS_Form.this.get_object_type(i);switch(e.which){case 13:e.preventDefault(),t(this).blur();break;default:var s=t(this).val();t.WS_Form.this.label_update(o,a,s)}}),i.focusout(function(){var e=t(this).closest("[data-id]"),i=e.attr("data-id"),a=t.WS_Form.this.get_object_type(e);t.WS_Form.this.label_save(t(this),a,i)}),i.on("dblclick focus",function(){t(this).prop("readonly",!1).select(),t.WS_Form.this.label_old=i.val()})},t.WS_Form.prototype.label_update=function(e,i,a){switch(e){case"group":t.WS_Form.this.group_data_cache[i].label=a;break;case"section":t.WS_Form.this.section_data_cache[i].label=a;break;case"field":t.WS_Form.this.field_data_cache[i].label=a}var o=t("#wsf-sidebar-"+e+'[data-id="'+i+'"] [name="label"]');o.length&&(""==t.trim(a)&&(a=this.get_label_default(e)),o.val(a))},t.WS_Form.prototype.label_save=function(e,i,a){document.getSelection().removeAllRanges(),e.prop("readonly",!0);var o=t.trim(e.val());if(o==this.label_old)return!0;""==o&&(o=this.get_label_default(i),t('input[data-label="'+a+'"]').val(o)),this.label_update(i,a,o),t.WS_Form.this.loader_on();var s={};switch(s.form_id=this.form_id,i){case"group":s[i]=t.WS_Form.this.group_data_cache[a];break;case"section":s[i]=t.WS_Form.this.section_data_cache[a];break;case"field":s[i]=t.WS_Form.this.field_data_cache[a]}this.api_call(i+"/"+a,"PUT",s,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.get_object_type=function(t){return t.hasClass("wsf-form")?"form":t.hasClass("wsf-group-tab")?"group":t.hasClass("wsf-group")?"group":t.hasClass("wsf-section")?"section":!!t.hasClass("wsf-field-wrapper")&&"field"},t.WS_Form.prototype.get_label_default=function(t){var e="";switch(t){case"form":e=this.language("default_label_form");break;case"group":e=this.language("default_label_group");break;case"section":e=this.language("default_label_section");break;case"field":e=this.language("default_label_field")}return e},t.WS_Form.prototype.object_edit=function(e,i){t(".wsf-sidebar:not(#wsf-sidebar-support) [data-meta-key]").removeAttr("id data-meta-key data-meta-key-type");var a=this.get_object_type(e),o=e.attr("data-id"),s=t("#wsf-sidebar-"+a);if(e.hasClass("wsf-editing"))return this.object_cancel(e),this.sidebar_reset(),!1;var r=t(".wsf-editing",t("#wsf-form"));switch(r.length&&!i&&t.WS_Form.this.object_cancel(r),e.addClass("wsf-editing"),a){case"group":t('.wsf-group-tab[data-id="'+o+'"]').addClass("wsf-editing");t('.wsf-group-tab[data-id="'+o+'"] a').click()}var n=this.get_object_data(a,o),d=this.get_object_meta(a,o);i||(this.object_data_scratch=t.extend(!0,{},n)),s.hasClass("ui-tabs")&&s.tabs("destroy"),s.attr("data-object",a).attr("data-id",o);var _="",l="",c="",f=[];if(void 0!==d.fieldsets){this.sidebar_cache_clear(s);var h=[{class:"wsf-button-primary",action:"wsf-sidebar-save-close",label:this.language("save_and_close")},{class:"wsf-button-primary",action:"wsf-sidebar-save",label:this.language("save")},{class:"",action:"wsf-sidebar-cancel",label:this.language("cancel")}];switch(a){case"group":case"section":case"field":h.push({class:"",action:"wsf-sidebar-clone",right:!0,label:this.language("clone")}),h.push({class:"wsf-button-danger",action:"wsf-sidebar-delete",label:this.language("delete")})}var u=this.sidebar_html(a,o,this.object_data_scratch,d,!1,!0,!0,!0,h);_=u.html_tabs,l=u.html,c=u.html_buttons,f=u.inits}this.sidebar_title_init(a,o,d,s),s.append(_),s.append('<div class="wsf-sidebar-inner">'+l+"</div>");var m=t(".wsf-sidebar-inner",s);s.append(c),this.sidebar_inits(f,s,m,this.object_data_scratch),this.sidebar_label_init(d,e,a,s,m),this.sidebar_buttons_init(e,s),this.sidebar_change_event_init(e,a,m),this.sidebar_open(a)},t.WS_Form.prototype.object_button_save=function(t,e){if(void 0===e)e=!1;this.object_save(t);this.get_object_type(t),t.attr("data-id");e&&(this.object_cancel(t),this.sidebar_reset())},t.WS_Form.prototype.object_button_cancel=function(t){this.object_cancel(t),this.sidebar_reset()},t.WS_Form.prototype.object_button_clone=function(t){switch(this.get_object_type(t)){case"group":wsf_group_clone(this,t);break;case"section":wsf_section_clone(this,t);break;case"field":wsf_field_clone(this,t)}},t.WS_Form.prototype.object_button_delete=function(t){switch(this.object_cancel(t),this.sidebar_reset(),this.get_object_type(t)){case"group":wsf_group_delete(this,t);break;case"section":wsf_section_delete(this,t);break;case"field":wsf_field_delete(this,t)}},t.WS_Form.prototype.save_notification=function(e){t("#wsf-sidebars .wsf-sidebar").addClass("wsf-saved");var i=!1;if(e){e.addClass("wsf-saved");var a=this.get_object_type(e),o=e.attr("data-id");switch(a){case"group":i=t('.wsf-group-tab[data-id="'+o+'"]')}}i&&i.addClass("wsf-saved"),setTimeout(function(){t("#wsf-sidebars .wsf-sidebar").removeClass("wsf-saved"),e&&e.removeClass("wsf-saved"),i&&i.removeClass("wsf-saved")},2e3)},t.WS_Form.prototype.object_save=function(e,i){if(void 0===i)i=!0;var a=this.get_object_type(e),o=e.attr("data-id"),s=t("#wsf-sidebar-"+a),r=t(".wsf-sidebar-inner",s);for(var n in i&&this.loader_on(),this.object_meta_cache){var d=this.object_meta_cache[n].meta_key;this.object_data_update_by_meta_key(a,this.object_data_scratch,d)}switch(a){case"field":var _=this.field_data_cache[o],l=t.WS_Form.field_type_cache[_.type],c=l.label_default;break;default:c=this.get_label_default(a)}var f=t('[name="label"]',r).val();if(void 0!==f&&(this.object_data_scratch.label=""==f?c:f),i){var h=!1;switch(a){case"form":this.form.label=this.object_data_scratch.label,this.form.meta=this.object_data_scratch.meta;break;case"group":this.group_data_cache[o].label=this.object_data_scratch.label,this.group_data_cache[o].meta=this.object_data_scratch.meta;break;case"section":var u=this.get_object_meta_value(this.section_data_cache[o],"section_repeatable",!1),m=this.get_object_meta_value(this.object_data_scratch,"section_repeatable",!1);h=!u&&m,this.section_data_cache[o].label=this.object_data_scratch.label,this.section_data_cache[o].meta=this.object_data_scratch.meta,this.breakpoint_optimize(this.section_data_cache[o]);break;case"field":switch(this.field_data_cache[o].label=this.object_data_scratch.label,this.field_data_cache[o].meta=this.object_data_scratch.meta,this.breakpoint_optimize(this.field_data_cache[o]),void 0!==this.object_data_scratch.type&&this.object_data_scratch.type){case"checkbox":case"radio":this.orientation_breakpoint_optimize(this.field_data_cache[o])}}var p={};p.form_id=this.form_id,p[a]=this.object_data_scratch,this.api_call(a+"/"+o,"PUT",p,function(i){switch(a){case"field":void 0!==l.mask_preview&&l.mask_preview&&t.WS_Form.this.field_render(e,t.WS_Form.this.field_data_cache[o]);break;case"section":h&&t.WS_Form.this.sidebar_fields_toggle_init(e,a,r)}t.WS_Form.this.save_notification(e),t.WS_Form.this.loader_off()})}},t.WS_Form.prototype.object_cancel=function(e){var i=this.get_object_type(e),a=e.attr("data-id");switch(i){case"form":t('[data-action="wsf-form-label"]').val(t.WS_Form.this.html_encode(t.WS_Form.this.form.label)),t('[data-action="wsf-form-settings"]').removeClass("wsf-editing");break;case"group":this.group_render(e);var o=this.get_object_data(i,a);t('.wsf-group-tab[data-id="'+a+'"] a input').val(t.WS_Form.this.html_encode(o.label)),t('.wsf-group-tab[data-id="'+a+'"]').removeClass("wsf-editing");break;case"section":o=this.get_object_data(i,a);t('.wsf-section[data-id="'+a+'"] .wsf-section-label input').val(t.WS_Form.this.html_encode(o.label)),t.WS_Form.this.section_render(e);break;case"field":this.field_render(e)}if(!1!==this.object_data_scratch){o=!1;switch(i){case"section":o=this.section_data_cache[a];break;case"field":o=this.field_data_cache[a]}!1!==o&&(this.column_classes_render(e,this.object_data_scratch,!1),this.column_classes_render(e,o))}e.removeClass("wsf-editing"),this.object_data_scratch=!1,t(".wsf-breakpoint-sizes.wsf-breakpoint-sizes-initialized").remove(),t.WS_Form.this.keydown=[]},t.WS_Form.prototype.object_delete=function(e){this.loader_on();var i=this.get_object_type(e),a=e.attr("data-id");switch(i){case"group":delete this.group_data_cache[a];break;case"section":delete this.section_data_cache[a];break;case"field":delete this.field_data_cache[a]}if("group"==i){var o=t('.wsf-group-tab[data-id="'+a+'"]'),s=o.index();--s<0&&(s=0),this.set_object_meta_value(this.form,"tab_index",s)}var r=e;this.api_call(i+"/"+a,"DELETE",!1,function(e){switch(i){case"group":r.remove(),o.remove(),t(".wsf-group-tabs li.wsf-group-tab:eq("+s+") a").click();break;case"section":case"field":r.remove(),t.WS_Form.this.object_blank_update()}t.WS_Form.this.field_check_multiple(),t.WS_Form.this.fields_setting_error(),t.WS_Form.this.loader_off()})},t.WS_Form.prototype.object_data_update_by_meta_key=function(e,i,a){var o=t.WS_Form.meta_keys[a].type;void 0!==t.WS_Form.meta_keys[a].key&&(a=t.WS_Form.meta_keys[a].key);var s=t("#wsf-sidebar-"+e+' [data-meta-key="'+a+'"]');if(!s.length)return!1;var r=this.get_meta_value_by_obj(s,o);!1!==r&&this.set_object_meta_value(i,a,r)},t.WS_Form.prototype.get_meta_value_by_obj=function(e,i){var a=!1;switch(i){case"data_grid":break;case"checkbox":a=e.is(":checked")?e.val():"";break;case"repeater":var o=this.sidebar_repeater_get(e),s=e.attr("data-meta-key");for(var r in a=[],o.meta_keys){var n=o.meta_keys[r];if(void 0!==t.WS_Form.meta_keys[n]){void 0!==t.WS_Form.meta_keys[n].key&&(n=t.WS_Form.meta_keys[n].key);var d=0;t('[name="'+s+"_"+n+'[]"]').each(function(){void 0===a[d]&&(a[d]={});var e=t.WS_Form.this.get_meta_value_by_obj(t(this),t(this).attr("data-meta-key-type"));!1!==e&&(a[d][n]=e),d++})}}break;default:a=e.val()}return null==a&&(a=""),a},t.WS_Form.prototype.sidebar_html=function(e,i,a,o,s,r,n,d,_,l,c,f){if(void 0===o.fieldsets)return"";if(void 0===s)s=!1;if(void 0===r)r=!0;if(void 0===n)n=!0;if(void 0===d)d=!0;if(void 0===_)_=!0;if(void 0===h)var h=!0;if(void 0===l)l=1;if(void 0===c)c=[];if(void 0===f)f="datetime-local";var u=!1!==s;u&&(r=!1,n=!1,d=!1,_=!1,h=!1);var m=o.fieldsets,p=0,v="";if(1==l&&!u){for(var b in v='<ul class="wsf-sidebar-tabs">',m){v+='<li><a href="#wsf-'+e+"-"+b+'" data-wsf-tab-key="'+b+'">'+(S=m[b]).label+"</a></li>",p++}v+="</ul>\n\n",p>1?c.push("tabs"):v=""}var g="",w=0;for(var b in m){var S=m[b];1!=l||u||(g+=this.comment_html(this.language("group")+" - "+S.label),g+='<div id="wsf-'+e+"-"+b+'"'+(p>1?' class="wsf-sidebar-tabs-panel"':"")+">");var W=["wsf-fieldset"];if(void 0!==S.class&&(W=W.concat(S.class)),g+=r?'<fieldset class="'+W.join(" ")+'">':"",l>1&&(g+="<legend>"+S.label+"</legend>"),0==w&&1==l&&d)g+='<div class="wsf-field-wrapper"><label class="wsf-label" for="wsf-label">Label</label><input name="label" class="wsf-field" type="text" value="'+this.html_encode(a.label)+'" maxlength="190" /></div>',c.push("label");if(void 0!==S.meta_keys)for(var b in S.meta_keys){var F="",y=S.meta_keys[b];if(void 0!==t.WS_Form.meta_keys[y]){var k=t.WS_Form.meta_keys[y];if(void 0!==k.key&&(y=k.key),void 0!==k.condition)for(var x in k.condition){var j=k.condition[x];this.sidebar_conditions.push({logic:j.logic,meta_key:j.meta_key,meta_value:j.meta_value,show:y,logic_previous:(j.logic_previous,j.logic_previous)}),c.push("conditions")}var C=void 0!==k.required&&k.required,z=k.label,q=k.type,I=this.get_object_meta_value(a,y,"",!0);if(""===I&&void 0!==k.fallback&&(I=k.fallback),"input_type_datetime"==y&&(f=I),void 0!==k.help&&(t.WS_Form.settings_plugin.helper_field_help||void 0!==k.help_force&&k.help_force)&&!u)var T='<div class="wsf-helper">'+k.help+"</div>";else T="";var O=u||void 0===z?"":'<label class="wsf-label" for="wsf_'+y+'">'+z+(C?' <span class="wsf-required"></span>':"")+"</label>",P=" "+(u?' name="'+s+"_"+y+'[]"':'id="wsf_'+y+'"')+' class="wsf-field'+(void 0!==k.class_field?" "+k.class_field:"")+(u?" wsf-field-small":"")+'" data-meta-key="'+y+'" data-meta-key-type="'+q+'"',U=[];if(void 0!==k.required_setting&&k.required_setting&&(U.push('<li class="wsf-required-setting">'+this.svg("warning")+"</li>"),P+=" data-required-setting",c.push("required_setting")),void 0!==k.compatibility_url&&t.WS_Form.settings_plugin.helper_compatibility&&!u&&U.push('<li><a class="wsf-compatibility" href="'+k.compatibility_url+'" target="_blank" title="'+this.language("attribute_compatibility")+'" tabindex="-1">'+this.svg("markup-circle")+"</a></li>"),"field"===e&&void 0!==k.calc){var A=a.type;void 0!==(Ft=t.WS_Form.field_type_cache[A]).calc_in&&Ft.calc_in&&(U.push('<li><span data-action="wsf-calc" data-option-meta-key="'+y+'" title="'+this.language("calc")+'">'+this.svg("calc")+"</span></li>"),c.push("calc"))}if(void 0!==k.select_list&&(U.push('<li><span data-action="wsf-select-list" data-option-meta-key="'+y+'" title="'+this.language("select_list")+'">'+this.svg("menu")+"</span></li>"),c.push("select_list")),void 0===k.auto_map||u||(U.push('<li><span data-action="wsf-auto-map" data-option-meta-key="'+y+'" data-object="'+e+'" data-object-id="'+i+'" title="'+this.language("auto_map")+'">'+this.svg("exchange")+"</span></li>"),c.push("auto_map")),void 0!==k.reload){var N=k.reload,M="";void 0!==N.action_id&&(M+=' data-action-id="'+N.action_id+'"'),void 0!==N.action_id_meta_key&&(M+=' data-action-id-meta-key="'+N.action_id_meta_key+'"'),void 0!==N.list_id_meta_key&&(M+=' data-list-id-meta-key="'+N.list_id_meta_key+'"'),void 0!==N.list_sub_id_meta_key&&(M+=' data-list-sub-id-meta-key="'+N.list_sub_id_meta_key+'"'),M+=' data-method="'+N.method+'"',u&&(M+=' data-repeater-meta-key="'+s+'"'),U.push('<li><span data-action="wsf-api-reload"'+M+' data-meta-key-for="'+y+'" title="'+this.language("action_api_reload")+'">'+this.svg("reload")+"</span></li>"),c.push("options-action-reload")}var D="";if(U.length>0&&(D='<ul class="wsf-meta-key-options">'+U.join("")+"</ul>"),void 0!==k.options_default){var E=!1,J=k.options_default,R=this.get_object_meta_value(this.form,J,void 0);if(void 0!==R)switch((J=t.WS_Form.meta_keys[J]).type){case"select":if(void 0!==J.options){var H=J.options;for(var G in H){H[G].value==R&&(E=H[G].text)}}break;default:E=R}F+='<option value="default"'+(lt="default"==I?" selected":"")+">"+this.language("default")+(!1!==E?" ("+E+")":"")+"</option>\n"}if(void 0!==k.options){U=k.options;var L=!1;switch(void 0!==k.options_framework_filter&&void 0!==this.framework[k.options_framework_filter]&&(L=this.framework[k.options_framework_filter]),U){case"sections":if(void 0!==this.meta_key_options_cache.sections){U=t.extend(!0,[],this.meta_key_options_cache.sections);break}U=[];var B=void 0!==k.section_filter_attribute&&k.section_filter_attribute;for(var X in this.section_data_cache){var K=this.section_data_cache[X];switch(B){case"section_repeatable":if(!this.get_object_meta_value(K,"section_repeatable",!1))continue}var Q=K.label;U.push({value:K.id,text:Q+" ("+this.language("id")+": "+K.id+")",type:K.type})}U.sort(function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}),this.meta_key_options_cache.sections=t.extend(!0,[],U);break;case"fields":if(void 0!==this.meta_key_options_cache.fields){U=t.extend(!0,[],this.meta_key_options_cache.fields);break}U=this.options_fields();this.meta_key_options_cache.fields=t.extend(!0,[],U);break;case"data_source":if(void 0!==this.meta_key_options_cache.data_source){U=t.extend(!0,[],this.meta_key_options_cache.data_source);break}U=this.options_data_sources();this.meta_key_options_cache.data_source=t.extend(!0,[],U);break;case"action_api_populate":U=[];break;case"ecommerce_cart_price_type":U=[];var V=!1;for(var $ in t.WS_Form.ecommerce.cart_price_types){var Y=t.WS_Form.ecommerce.cart_price_types[$],Z=!1;if($!==I)for(var tt in t.WS_Form.this.field_data_cache){var et=t.WS_Form.this.field_data_cache[tt];if(this.get_object_meta_value(et,"ecommerce_cart_price_type",!1)===$){Z=!0;break}}if("other"!=$)U.push({value:$,text:Y.label,disabled:Z});else V={value:$,text:Y.label,disabled:Z}}U.sort(function(t,e){return t.text<e.text?-1:t.text>e.text?1:0}),!1!==V&&U.push(V);break;default:U=t.extend(!0,[],U)}void 0!==k.options_blank&&U.unshift({value:"",text:k.options_blank,disabled_never:!0});var it=void 0!==k.fields_filter_type&&k.fields_filter_type,at=void 0!==k.fields_filter_attribute&&k.fields_filter_attribute,ot=!1;for(var st in U){var rt=U[st];if(!1!==it&&void 0!==rt.type){if(-1===it.indexOf(rt.type))continue;if(rt.value==i)continue}if(!1!==at&&void 0!==rt.type&&void 0!==t.WS_Form.field_type_cache[rt.type]){var nt=t.WS_Form.field_type_cache[rt.type];if(!at.find(function(t){return void 0!==nt[t]&&nt[t]}))continue}var dt=rt.value;if(!1===L||-1!=L.indexOf(dt)){var _t=rt.text,lt=I==dt?" selected":"",ct=void 0!==rt.disabled&&rt.disabled?" disabled":"",ft=void 0!==rt.disabled_always&&rt.disabled_always?" data-disabled-always":"",ht=void 0!==rt.disabled_never&&rt.disabled_never?" data-disabled-never":"",ut=void 0!==rt.optgroup&&rt.optgroup;ut!==ot&&(!1!==ot&&(F+="</optgroup>"),F+='<optgroup label="'+this.html_encode(ut)+'">',ot=ut),F+='<option value="'+this.html_encode(dt)+'"'+lt+ct+ft+ht+">"+this.html_encode(_t)+"</option>\n"}}!1!==ot&&(F+="</optgroup>")}if("select_ajax"==q){var mt=void 0!==k.select_ajax_method_search&&k.select_ajax_method_search,pt=void 0!==k.select_ajax_method_cache&&k.select_ajax_method_cache,vt=void 0!==k.select_ajax_placeholder&&k.select_ajax_placeholder;mt&&(P+=' data-select-ajax-method-search="'+mt+'"',P+=' data-select-ajax-method-cache="'+pt+'"',P+=vt?' data-select-ajax-placeholder="'+vt+'"':"",I&&(P+=' data-select-ajax-id="'+this.html_encode(I)+'"'),c.push("select-ajax"))}if("select_number"==q){var bt=void 0!==k.minimum?k.minimum:1,gt=void 0!==k.maximum?k.maximum:100;"framework_column_count"==gt&&(gt=t.WS_Form.settings_plugin.framework_column_count-1);for(dt=bt;dt<=gt;dt++){F+='<option value="'+dt+'"'+(lt=I==dt?" selected":"")+">"+dt+"</option>\n"}q="select"}if(void 0!==k.mask_placeholder&&(P+=' data-placeholder="'+this.html_encode(k.mask_placeholder)+'"',c.push("placeholders")),void 0!==k.placeholder&&(P+=' placeholder="'+k.placeholder+'"'),void 0!==k.data_change&&(P+=' data-change-event="'+k.data_change.event+'"',P+=' data-change-action="'+k.data_change.action+'"'),void 0!==k.fields_toggle&&(P+=" data-fields-toggle"),void 0!==k.min&&(P+=' min="'+parseInt(k.min)+'"'),void 0!==k.max&&(P+=' max="'+parseInt(k.max)+'"'),void 0!==k.step&&(P+=' step="'+parseInt(k.step)+'"'),void 0===k.options_action_id&&void 0===k.options_action_id_meta_key||void 0===k.options_action_api_populate||(void 0!==k.options_action_id&&(P+=' data-options-action-id="'+k.options_action_id+'"'),void 0!==k.options_action_id_meta_key&&(P+=' data-options-action-id-meta-key="'+k.options_action_id_meta_key+'"'),void 0!==k.options_list_id_meta_key&&(P+=' data-options-list-id-meta-key="'+k.options_list_id_meta_key+'"'),void 0!==k.options_list_sub_id_meta_key&&(P+=' data-options-list-sub-id-meta-key="'+k.options_list_sub_id_meta_key+'"'),P+=' data-options-action-api-populate="'+k.options_action_api_populate+'"',P+=' data-object="'+e+'"',P+=' data-object-id="'+i+'"',u&&(P+=' data-repeater-meta-key="'+s+'"'),c.push("options-action")),C&&(P+=" required"),void 0!==k.attributes)for(var wt in k.attributes){P+=" "+wt+'="'+k.attributes[wt]+'"'}if(u||this.object_meta_cache.push({meta_key:y,meta_key_type:q,meta_value:I}),"default_value"==y){var St=t.WS_Form.settings_plugin.mode,Wt=void 0!==k.type_advanced&&k.type_advanced;"advanced"==St&&!1!==Wt&&(q=Wt)}if(void 0!==k.show_if_groups_group){A=a.type;var Ft,yt=void 0!==(Ft=t.WS_Form.field_type_cache[A]).data_source&&Ft.data_source;if(void 0!==yt.id&&void 0!==t.WS_Form.meta_keys[yt.id]){var kt=t.WS_Form.meta_keys[yt.id];(void 0!==kt.groups_group&&kt.groups_group)!==k.show_if_groups_group&&(q="hidden",I="")}}switch(q){case"checkbox":var xt='<input type="checkbox"'+P+("on"==I?" checked":"")+" />"+O+D+T;break;case"select":case"select_ajax":case"regex_filter":case"data_grid_field":xt=O+D+"<select"+P+">"+F+"</select>"+T;break;case"text_editor":xt=O+D+'<textarea data-text-editor="true"'+(P+=void 0!==k.css?' data-helper-css="'+k.css+'"':"")+">"+this.html_encode(I)+"</textarea>"+T;c.push("text-editor");break;case"html_editor":xt=O+D+'<textarea data-html-editor="true"'+P+">"+this.html_encode(I)+"</textarea>"+T;c.push("html-editor");break;case"textarea":xt=O+D+"<textarea"+P+">"+this.html_encode(I)+"</textarea>"+T;break;case"number":xt=O+D+'<input type="number"'+P+' value="'+this.html_encode(I)+'" />'+T;c.push("number");break;case"range":xt=O+D+'<input type="range"'+P+' value="'+this.html_encode(I)+'" /><small id="wsf_'+y+'_range_value"></small>'+T;c.push("range");break;case"password":xt=O+D+'<input type="password"'+P+' value="'+this.html_encode(I)+'" autocomplete="new-password" />'+T;break;case"email":xt=O+D+'<input type="email"'+P+' value="'+this.html_encode(I)+'" />'+T;break;case"tel":xt=O+D+'<input type="tel"'+P+' value="'+this.html_encode(I)+'" />'+T;break;case"url":xt=O+D+'<input type="url"'+P+' value="'+this.html_encode(I)+'" />'+T;break;case"datetime":xt=O+D+'<input type="'+f+'"'+P+' value="'+this.html_encode(I)+'" />'+T;c.push("datetime");break;case"color":xt=O+D+'<input type="color"'+P+' value="'+this.html_encode(I)+'" />'+T;break;case"breakpoint_sizes":xt='<div class="wsf-breakpoint-sizes" data-object="'+e+'" data-id="'+i+'" data-meta-key="'+y+'"></div>';c.push("breakpoint-sizes");break;case"orientation_breakpoint_sizes":xt='<div class="wsf-orientation-breakpoint-sizes" data-object="'+e+'" data-id="'+i+'" data-meta-key="'+y+'"></div>';c.push("orientation-breakpoint-sizes");break;case"data_grid":xt='<fieldset class="wsf-fieldset wsf-data-grid" data-object="'+e+'" data-id="'+i+'" data-meta-key="'+y+'"></fieldset>';c.push("data-grid");break;case"field_select":xt='<div class="wsf-field-select"></div>';c.push("field-select");break;case"form_history":xt="";c.push("form-history");break;case"knowledgebase":xt="";break;case"contact":xt="";c.push("contact");break;case"repeater":xt=O+D+'<div id="wsf_'+y+'" class="wsf-repeater" data-object="'+e+'" data-id="'+i+'" data-meta-key="'+y+'" data-meta-key-type="'+q+'"></div>'+T;c.push("repeater");break;case"button":xt='<button class="wsf-button wsf-button-primary wsf-button-full" id="wsf_'+y+'" data-object="'+e+'" data-id="'+i+'" data-meta-key="'+y+'" data-meta-key-type="'+q+'">'+this.html_encode(z)+"</button>";break;case"image":xt=O+D+'<div class="wsf-field-inline"><input type="text"'+P+' value="'+this.html_encode(I)+'" />';xt+='<button class="wsf-button wsf-button-primary" data-for="wsf_'+y+'">'+this.language("sidebar_button_image")+"</button></div>"+T,c.push("image");break;case"html":xt='<div class="wsf-sidebar-html"'+P+">"+(void 0!==k.html?k.html:"")+"</div>";break;case"hidden":xt='<input type="hidden"'+P+' value="'+this.html_encode(I)+'" />';break;default:xt=O+D+'<input type="text"'+P+' value="'+this.html_encode(I)+'" />'+T}var jt=void 0!==k.indent?" wsf-field-indent":"",Ct=void 0===k.field_wrapper||k.field_wrapper;if(n&&Ct)g+='<div class="wsf-field-wrapper'+(void 0!==k.class_wrapper?" "+k.class_wrapper:"")+jt+'">'+xt+"</div>\n";else g+=xt+"\n"}else this.error("error_meta_key",y)}if(void 0!==S.fieldsets){var zt=this.sidebar_html(e,i,a,S,u,r,n,d,_,l+1,c,f);g+=zt.html,c=c.concat(zt.inits)}g+=r?"</fieldset>":"",1!=l||u||(g+="</div>",g+=this.comment_html(this.language("group")+" - "+S.label,!0)),w++}return{html_tabs:v,html:g,html_buttons:!1!==_?this.sidebar_buttons_html(_):"",inits:c}},t.WS_Form.prototype.options_fields=function(){var t=[];for(var e in this.form.groups){var i=this.form.groups[e];t.push({value:i.id,text:i.label+" ("+this.language("id")+": "+i.id+")",type:"group",disabled:!0,disabled_always:!0});var a=i.sections;for(var o in a){var s=a[o];t.push({value:s.id,text:"- "+s.label+" ("+this.language("id")+": "+s.id+")",type:"section",disabled:!0,disabled_always:!0});var r=s.fields;for(var n in r){var d=r[n];t.push({value:d.id,text:"-- "+d.label+" ("+this.language("id")+": "+d.id+")",type:d.type})}}}return t},t.WS_Form.prototype.options_data_sources=function(){var e=[];for(var i in t.WS_Form.data_sources){var a=t.WS_Form.data_sources[i];void 0!==a.label&&e.push({value:i,text:a.label})}return e},t.WS_Form.prototype.sidebar_cache_clear=function(t){this.object_meta_cache=[],this.sidebar_conditions=[],t.removeAttr("data-sidebar-conditions-init"),this.meta_key_options_cache=[]},t.WS_Form.prototype.sidebar_buttons_html=function(t){if(void 0===t||!0===t)t=[{class:"wsf-button-primary",action:"wsf-sidebar-save-close",label:this.language("save_and_close")},{class:"wsf-button-primary",action:"wsf-sidebar-save",label:this.language("save")},{class:"",action:"wsf-sidebar-cancel",label:this.language("cancel")}];if(!1===t)return"";var e='<div class="wsf-sidebar-footer">';for(var i in e+='<div class="wsf-sidebar-footer-saved">Saved</div>',e+='<ul class="wsf-list-inline">',t){var a=t[i];void 0===a.class&&(a.class=""),void 0!==a.action&&(void 0!==a.label&&(void 0===a.disabled&&(a.disabled=!1),void 0===a.right&&(a.right=!1),e+="<li"+(a.right?' class="wsf-button-right"':"")+'><button class="wsf-button wsf-button-small'+(""!=a.class?" "+a.class:"")+'" data-action="'+a.action+'"'+(void 0!==a.id?' data-id="'+a.id+'"':"")+(a.disabled?" disabled":"")+">"+a.label+"</button></li>"))}return e+="</ul>",e+="</div>"},t.WS_Form.prototype.sidebar_inits=function(e,i,a,o){if("object"!=typeof e)e=[];if(e.length){if(void 0===a)a=i;if(void 0===o)o=[];var s="basic"==t.WS_Form.settings_plugin.mode;-1!=e.indexOf("tabs")&&this.sidebar_tabs_init(i,a),t(".wsf-sidebar-tabs li",i).length?i.addClass("wsf-sidebar-has-tabs"):i.removeClass("wsf-sidebar-has-tabs"),-1!=e.indexOf("text-editor")&&this.sidebar_tinymce_init(a),-1!=e.indexOf("html-editor")&&this.sidebar_html_editor_init(a),-1!=e.indexOf("repeater")&&this.sidebar_repeater_init(a),-1!=e.indexOf("data-grid")&&this.sidebar_data_grids_init(i),-1!=e.indexOf("field-select")&&this.sidebar_field_select_init(i),-1!=e.indexOf("form-history")&&this.sidebar_form_history_init(),-1!=e.indexOf("breakpoint-sizes")&&this.sidebar_breakpoint_sizes(i),-1!=e.indexOf("orientation-breakpoint-sizes")&&this.sidebar_orientation_breakpoint_sizes(i),-1!=e.indexOf("select-ajax")&&this.sidebar_select_ajax(i),-1!=e.indexOf("range")&&this.sidebar_range_init(a),-1!=e.indexOf("number")&&s&&this.sidebar_number_init(a),-1!=e.indexOf("datetime")&&s&&this.sidebar_datetime_init(i),-1!=e.indexOf("placeholders")&&this.sidebar_placeholders_init(i),-1!=e.indexOf("calc")&&this.sidebar_calc(i),-1!=e.indexOf("select_list")&&this.sidebar_select_list(i),-1!=e.indexOf("auto_map")&&this.sidebar_auto_map(i),-1!=e.indexOf("knowledgebase")&&this.sidebar_knowledgebase(i,a),-1!=e.indexOf("required_setting")&&this.sidebar_required_setting(o,i,a),-1!=e.indexOf("image")&&this.sidebar_image(a),-1!=e.indexOf("options-action")?this.sidebar_option_action_init(a,function(){-1!=e.indexOf("options-action-reload")&&t.WS_Form.this.sidebar_api_reload_init(a),-1!=e.indexOf("repeater")&&t.WS_Form.this.sidebar_repeater_init(a),-1!=e.indexOf("conditions")&&t.WS_Form.this.sidebar_conditions_init(i)}):-1!=e.indexOf("conditions")&&t.WS_Form.this.sidebar_conditions_init(i)}},t.WS_Form.prototype.sidebar_title_init=function(e,i,a,o){switch(e){case"form":var s=this.language("sidebar_title_"+e),r=this.svg(e),n="",d='<a class="wsf-kb-url" href="'+this.get_plugin_website_url("/knowledgebase/form-settings/","sidebar")+'" target="_blank" title="'+this.language("field_kb_url")+'" tabindex="-1">'+this.svg("question-circle")+"</a>",_=t.WS_Form.settings_plugin.helper_field_id?"<span>"+this.language("id")+": "+this.form_id+"</span>":"";break;case"group":s=this.language("sidebar_title_"+e),r=this.svg(e),n="",d='<a class="wsf-kb-url" href="'+this.get_plugin_website_url("/knowledgebase/tabs/","sidebar")+'" target="_blank" title="'+this.language("field_kb_url")+'" tabindex="-1">'+this.svg("question-circle")+"</a>",_=t.WS_Form.settings_plugin.helper_field_id?"<span>"+this.language("id")+": "+i+"</span>":"";break;case"section":s=this.language("sidebar_title_"+e),r=this.svg(e),n="",d='<a class="wsf-kb-url" href="'+this.get_plugin_website_url("/knowledgebase/sections/","sidebar")+'" target="_blank" title="'+this.language("field_kb_url")+'" tabindex="-1">'+this.svg("question-circle")+"</a>",_=t.WS_Form.settings_plugin.helper_field_id?"<span>"+this.language("id")+": "+i+"</span>":"";break;case"field":s=this.html_encode(a.label),r=void 0!==a.icon?a.icon:"";if(void 0!==a.kb_url)d='<a class="wsf-kb-url" href="'+this.get_plugin_website_url(a.kb_url,"sidebar")+'" target="_blank" title="'+this.language("field_kb_url")+'" tabindex="-1">'+this.svg("question-circle")+"</a>";if(void 0!==a.compatibility_url&&t.WS_Form.settings_plugin.helper_compatibility)n='<a class="wsf-compatibility" href="'+a.compatibility_url+'" target="_blank" title="'+this.language("field_compatibility")+'" tabindex="-1">'+this.svg("markup-circle")+"</a>";_=t.WS_Form.settings_plugin.helper_field_id?"<span>"+this.language("id")+": "+i+"</span>":"";break;default:s=this.language("sidebar_title_"+e),r=this.svg(e),n="",_=""}o.html(this.sidebar_title(r,s,n,d,_,!0)),this.sidebar_expand_contract_init()},t.WS_Form.prototype.sidebar_label_init=function(e,i,a,o,s){t('[name="label"]',s).keyup(function(){if(!1===t.WS_Form.this.object_data_scratch)return!1;var s=t.trim(t(this).val());switch(a){case"field":var r=e.label_default;break;default:r=t.WS_Form.this.get_label_default(a)}switch(t.WS_Form.this.object_data_scratch.label=""==s?r:s,a){case"form":t('[data-action="wsf-form-label"]').val(t.WS_Form.this.html_encode(t.WS_Form.this.object_data_scratch.label));break;case"group":var n=i.attr("data-id");t('.wsf-group-tab[data-id="'+n+'"] a input').val(t.WS_Form.this.html_encode(t.WS_Form.this.object_data_scratch.label));break;case"section":var d=i.attr("data-id");t('.wsf-section[data-id="'+d+'"] .wsf-section-label input').val(t.WS_Form.this.html_encode(t.WS_Form.this.object_data_scratch.label));break;case"field":t.WS_Form.this.field_render(i,t.WS_Form.this.object_data_scratch),t.WS_Form.this.sidebar_placeholders_init(o)}})},t.WS_Form.prototype.sidebar_fields_toggle_init=function(e,i,a){t("[data-fields-toggle]:checked",a).each(function(){var e=t(this).attr("data-meta-key");if(void 0===t.WS_Form.meta_keys[e])return!1;var i=t.WS_Form.meta_keys[e];if(void 0===i.fields_toggle)return!1;var a=i.fields_toggle,o=void 0!==i.fields_ignore?i.fields_ignore:[],s=t(this).closest('[data-object="section"]').attr("data-id");for(var r in o){var n=o[r];if(t.WS_Form.this.field_type_in_section(s,n))return!1}for(var d in a){var _=a[d],l=(n=_.type,void 0!==_.width_factor&&_.width_factor);if(!t.WS_Form.this.field_type_in_section(s,n)){var c='<li class="wsf-field-wrapper" data-type="'+n+'"'+(!1!==l?' data-width-factor="'+l+'"':"")+">"+t(this).html()+"</li>";t("#wsf-fields-"+s).append(c);var f=t("#wsf-fields-"+s+" li").last();t.WS_Form.this.field_post(f),t.WS_Form.this.init_ui()}}})},t.WS_Form.prototype.field_type_in_section=function(e,i){var a=t("#wsf-section-"+e).closest(".wsf-sections").attr("data-id");if(!a)return!1;if(void 0===this.form.groups)return!1;for(var o in this.form.groups){var s=this.form.groups[o];if(s.id==a){if(void 0===s.sections)return!1;for(var r in s.sections){var n=s.sections[r];if(n.id==e){if(void 0===n.fields)return!1;for(var d in n.fields){if(n.fields[d].type==i)return!0}}}}}return!1},t.WS_Form.prototype.sidebar_change_event_init=function(e,i,a){t("[data-change-event]",a).each(function(){var a=t(this).attr("data-change-event");t(this).on(a,function(){var a=t(this).attr("data-change-action"),o=e.attr("data-id"),s=t(this).attr("data-meta-key");switch(t.WS_Form.this.object_data_update_by_meta_key(i,t.WS_Form.this.object_data_scratch,s),s){case"recaptcha_recaptcha_type":"invisible"==t(this).val()&&(t.WS_Form.this.column_classes_render(e,t.WS_Form.this.object_data_scratch,!1),t.WS_Form.this.breakpoint_reset_process(t.WS_Form.this.object_data_scratch),t.WS_Form.this.column_classes_render(e,t.WS_Form.this.object_data_scratch))}switch(i){case"section":var r=t.extend(!0,{},t.WS_Form.this.section_data_cache[o]);t.WS_Form.this.section_data_cache[o]=t.WS_Form.this.object_data_scratch,t.WS_Form.this.section_render(e),e.addClass("wsf-editing"),t.WS_Form.this.section_data_cache[o]=r;break;case"field":r=t.extend(!0,{},t.WS_Form.this.field_data_cache[o]);t.WS_Form.this.field_data_cache[o]=t.WS_Form.this.object_data_scratch,t.WS_Form.this.field_render(e),e.addClass("wsf-editing"),t.WS_Form.this.field_data_cache[o]=r}"reload"==a&&(t.WS_Form.this.object_save(e,!1),e.removeClass("wsf-editing"),t.WS_Form.this.object_edit(e,!0))})})},t.WS_Form.prototype.sidebar_image=function(e){var i;t('input[data-meta-key-type="image"]',e).each(function(){var e=t(this).attr("id");t('button[data-for="'+e+'"]').click(function(){var e=t(this).attr("data-for");i?i.open():((i=wp.media.frames.file_frame=wp.media({title:"Select image",button:{text:"Use this image"},multiple:!1})).on("select",function(){var a=i.state().get("selection").first().toJSON();t("#"+e).val(a.url)}),i.open())})})},t.WS_Form.prototype.sidebar_required_setting=function(e,i){t("[data-required-setting]",i).on("change keyup input",function(){t.WS_Form.this.sidebar_required_setting_process(e,i)}),t.WS_Form.this.sidebar_required_setting_process(e,i)},t.WS_Form.prototype.sidebar_required_setting_process=function(e,i,a){t("[data-required-setting]",a).each(function(){var e=t(".wsf-required-setting",t(this).closest(".wsf-field-wrapper"));""==t(this).val()?(t(this).addClass("wsf-error"),e.show()):(t(this).removeClass("wsf-error"),e.hide())})},t.WS_Form.prototype.sidebar_knowledgebase=function(e,i){var a=t("#wsf-form-knowledgebase .wsf-fieldset",i);if(a.attr("data-loaded"))return!0;var o='<div class="wsf-field-wrapper">';o+='<label class="wsf-label" for="wsf-kb-search">'+this.language("knowledgebase_search_label")+"</label>",o+='<div class="wsf-field-inline">',o+='<input type="text" id="wsf-kb-search-keyword" class="wsf-field" value="" placeholder="'+this.language("knowledgebase_search_placeholder")+'" />',o+='<button class="wsf-button wsf-button-primary" data-action="wsf-kb-search">'+this.language("knowledgebase_search_button")+"</button>",o+="</div>",o+="</div>",o+='<div class="wsf-field-wrapper">',o+='<p><a href="https://wsform.com/knowledgebase/" target="_blank">'+this.language("knowledgebase_view_all")+"</a></p>",o+="</div>",o+='<div class="wsf-field-wrapper">',o+='<div id="wsf-kb-content"></div>',o+="</div>",a.html(o),t.get("https://wsform.com/plugin-support/knowledgebase_content.php?l="+encodeURIComponent(ws_form_settings.locale)+"&e="+encodeURIComponent(ws_form_settings.edition)+"&v="+encodeURIComponent(ws_form_settings.version),function(e){t("#wsf-kb-content").html(e),a.attr("data-loaded","true")}),t('[data-action="wsf-kb-search"]').click(function(){t.WS_Form.this.sidebar_knowledgebase_search()}),t("#wsf-kb-search-keyword").keypress(function(e){13==e.which&&t.WS_Form.this.sidebar_knowledgebase_search()});var s='<form id="wsf-contact-form">'+(s=t("#wsf-form-contact").html())+"</form>";t("#wsf-form-contact").html(s),t("#wsf-contact-form").on("submit",function(e){if(t("#wsf_contact_submit").attr("disabled","disabled"),!t("#wsf_contact_gdpr").is(":checked"))return!1;var i={contact_first_name:t("#wsf_contact_first_name").val(),contact_last_name:t("#wsf_contact_last_name").val(),contact_email:t("#wsf_contact_email").val(),contact_inquiry:t("#wsf_contact_inquiry").val(),contact_push_form:t("#wsf_contact_push_form").is(":checked"),contact_push_system:t("#wsf_contact_push_system").is(":checked")};return t.WS_Form.this.api_call("helper/support_contact_submit/","POST",i,function(e){e.error?t.WS_Form.this.error(support_contact_error,e.error_message):t("#wsf-form-contact form fieldset").html('<div class="wsf-field-wrapper">'+e.response+"</div>"),t.WS_Form.this.loader_off()}),!1})},t.WS_Form.prototype.sidebar_knowledgebase_search=function(){var e=t("#wsf-kb-search-keyword").val();""!=e&&(e=t.trim(e),t.get("https://wsform.com/plugin-support/knowledgebase_search.php?l="+encodeURIComponent(ws_form_settings.locale)+"&e="+encodeURIComponent(ws_form_settings.edition)+"&v="+encodeURIComponent(ws_form_settings.version)+"&k="+encodeURIComponent(e),function(e){t("#wsf-kb-content").html(e)}))},t.WS_Form.prototype.sidebar_auto_map=function(e){t('[data-action="wsf-auto-map"]').click(function(){var i=t(this);i.addClass("wsf-api-method-calling");var a=t(this).attr("data-option-meta-key"),o=t(this).attr("data-object"),s=t(this).attr("data-object-id");if(void 0===t.WS_Form.meta_keys[a])return!1;if(void 0===(p=t.WS_Form.meta_keys[a]).type)return!1;if("repeater"!==p.type)return!1;if(void 0===p.meta_keys)return!1;var r=p.meta_keys;if(2!==r.length)return!1;var n=!1,d=!1,_=!1,l=!1,c=!1,f=!1,h=!1,u="list_fields_fetch";for(var m in r){var p,v=r[m];if(void 0===t.WS_Form.meta_keys[v])return!1;if(void 0===(p=t.WS_Form.meta_keys[v]).type)return!1;if("select"!=p.type)return!1;if(void 0===p.options)return!1;switch(p.options){case"fields":d=void 0!==p.key?p.key:v,n=m;break;case"action_api_populate":l=m,_=v,f=p.options_list_id_meta_key,h=p.options_list_sub_id_meta_key,c=void 0!==p.options_action_id_meta_key?t('[data-meta-key="'+p.options_action_id_meta_key+'"]').val():p.options_action_id,u=void 0!==p.options_action_api_populate?p.options_action_api_populate:"list_fields_fetch"}}if(!1===n)return!1;if(!1===l)return!1;var b=t('[data-meta-key="'+f+'"]').val(),g=t('[data-meta-key="'+h+'"]').val(),w=t.WS_Form.this.action_api_method_path(c,u,b,g);t.WS_Form.this.options_action_cache_clear(w);var S=[];t.WS_Form.this.api_call(w,"GET",!1,function(r){if(void 0===r.data)return!1;for(var n in r.data){var l=r.data[n];S.push({id:l.id,label:l.label})}if(0==S.length)return t.WS_Form.error("error_auto_map_api_fields"),!1;var c=[];for(var f in S){var h=S[f],u=h.label,m=!1,p=0;for(var v in t.WS_Form.this.field_data_cache){var b=t.WS_Form.this.field_data_cache[v].label,g=t.WS_Form.this.score(String(b),String(u));(g+=t.WS_Form.this.score(String(u),String(b)))>p&&(p=g,m=v)}if(p>0){var w={};w[d]=m,w[_]=h.id,c.push(w)}}if(c.length>0){t.WS_Form.this.get_object_data(o,s,!0).meta[a]=c;var W=e.closest(".wsf-sidebar-inner");W.length||(W=t(".wsf-sidebar-inner",e)),t.WS_Form.this.sidebar_inits(["options-action","repeater"],W)}i.removeClass("wsf-api-method-calling")},function(){},!0)})},t.WS_Form.prototype.sidebar_calc=function(e){var i=this;t('[data-action="wsf-calc"]').click(function(){var e=t(this).closest(".wsf-field-wrapper"),a=t(this).attr("data-option-meta-key"),o=t(this).hasClass("wsf-calc-open");if(t(".wsf-calc",t("#wsf-sidebars")).remove(),t(".wsf-calc-open").removeClass("wsf-calc-open").attr("autocomplete",!1),!o){t(this).addClass("wsf-calc-open").attr("autocomplete","off");var s=i.sidebar_calc_html();t.WS_Form.this.sidebar_calc_process(e,s,a)}})},t.WS_Form.prototype.sidebar_calc_process=function(e,i,a){var o=t('[data-meta-key="'+a+'"]').closest(".wsf-field-wrapper"),s=t(".wsf-helper",o);s.length?t(i).insertBefore(s):t(i).insertAfter(t('[data-meta-key="'+a+'"]')),t.WS_Form.this.input_insert_function(t('[data-meta-key="'+a+'"]'),"#calc()",!0,!0),t('[data-action="wsf-calc-insert"]').click(function(e){var i=void 0!==t(this).attr("data-insert")&&t(this).attr("data-insert");!1!==i&&t.WS_Form.this.input_insert_text(t('[data-meta-key="'+a+'"]'),i)}),t('[data-action="wsf-calc-insert-select"]').change(function(e){var i=t(this).val();""!==i&&t.WS_Form.this.input_insert_function(t('[data-meta-key="'+a+'"]'),i,!1,!1),t(this).find("option:eq(0)").prop("selected",!0)}),t('[data-action="wsf-calc-insert-select-highlight-parameters"]').change(function(e){var i=t(this).val();""!==i&&t.WS_Form.this.input_insert_function(t('[data-meta-key="'+a+'"]'),i,!1,!0),t(this).find("option:eq(0)").prop("selected",!0)}),t('[data-action="wsf-calc-delete"]').click(function(e){t.WS_Form.this.input_delete(t('[data-meta-key="'+a+'"]'))}),t('[data-action="wsf-calc-clear"]').click(function(e){t.WS_Form.this.input_clear(t('[data-meta-key="'+a+'"]')),t.WS_Form.this.input_insert_function(t('[data-meta-key="'+a+'"]'),"#calc()",!0,!0)})},t.WS_Form.prototype.sidebar_calc_html=function(e){var i='<div class="wsf-calc"><table><tbody>';for(var a in t.WS_Form.calc){var o=t.WS_Form.calc[a];for(var s in i+="<tr>",o){var r=o[s],n=void 0!==r.title?r.title:void 0!==r.label&&r.label,d=void 0!==r.colspan?' colspan="'+r.colspan+'"':"",_=void 0!==r.action?' data-action="wsf-calc-'+r.action+'"':"",l=void 0!==r.action?' data-insert="'+r.insert+'"':"",c=["wsf-button","wsf-button-large","wsf-button-full"];switch(void 0!==r.class&&c.push(r.class),i+="<td"+d+">",r.type){case"button":i+='<button class="'+c.join(" ")+'"'+(n?' title="'+n+'"':"")+_+l+">"+r.label+"</button>";break;case"select":switch(i+='<select class="'+c.join(" ")+'"'+(n?' title="'+n+'"':"")+_+">",i+="<option selected>"+r.label+"</option>",r.source){case"field":var f=t.WS_Form.this.get_select_options_field(!0);for(var h in f){var u=f[h];i+='<option value="'+u.value+'">'+u.text+"</option>"}break;case"variables":var m=r.variables_group_id;for(var p in t.WS_Form.parse_variable_help){var v=t.WS_Form.parse_variable_help[p];v.group_id==m&&(i+='<option value="'+v.value+'">'+v.text+"</option>")}}i+="</select>"}i+="</td>"}i+="</tr>"}return i+="</tbody></table></div>"},t.WS_Form.prototype.sidebar_select_list=function(e){t('[data-action="wsf-select-list"]').click(function(){var e=t(this).closest(".wsf-field-wrapper"),i=t(this).attr("data-option-meta-key"),a=t(this).hasClass("wsf-select-list-open");if(t(".wsf-select-list",t("#wsf-sidebars")).remove(),t(".wsf-select-list-open").removeClass("wsf-select-list-open").attr("autocomplete",!1),!a)if(t(this).addClass("wsf-select-list-open").attr("autocomplete","off"),"object"==typeof t.WS_Form.meta_keys[i].select_list){var o=void 0!==t.WS_Form.meta_keys[i].select_list_heading&&t.WS_Form.meta_keys[i].select_list_heading;t.WS_Form.this.sidebar_select_list_process(e,t.WS_Form.meta_keys[i].select_list,i,o)}else{var s=t.WS_Form.parse_variable_help;s=t.WS_Form.this.get_select_options_field().concat(s),t.WS_Form.this.sidebar_select_list_process(e,s,i,t.WS_Form.this.language("fields"))}})},t.WS_Form.prototype.get_select_options_field=function(e){if(void 0!==e)e=!1;var i=[];for(var a in t.WS_Form.this.form.groups){var o=t.WS_Form.this.form.groups[a];for(var s in o.sections){var r=o.sections[s];for(var n in r.fields){var d=r.fields[n],_=t.WS_Form.field_type_cache[d.type],l=(_.value_out,_.value_out),c=!e||(_.calc_out,_.calc_out);l&&c&&i.push({text:d.label+" ("+this.language("id")+": "+d.id+")",value:"#field("+d.id+")",group:t.WS_Form.this.language("field")})}}}return i},t.WS_Form.prototype.sidebar_select_list_process=function(e,i,a,o){if(void 0===o)o=!1;var s='<div class="wsf-select-list"><table>';!1!==o&&(s+="<thead><tr><th>"+o+"</th></tr></thead>"),s+="<tbody>";var r=!1;for(var n in i){var d=i[n];if(void 0!==d.group_id){var _=d.group_id;_!==r&&(s+="<tr><th>"+d.group_label+"</th></tr>",r=_)}s+='<tr data-action="wsf-list-item-insert" data-action-html="'+t.WS_Form.this.html_encode(d.value)+'"><td title="'+t.WS_Form.this.html_encode(d.description)+'">'+d.text+"</td></tr>"}s+="</tbody></table></div>";var l=t('[data-meta-key="'+a+'"]').closest(".wsf-field-wrapper"),c=t(".wsf-helper",l);c.length?t(s).insertBefore(c):t(s).insertAfter(t('[data-meta-key="'+a+'"]')),t.WS_Form.this.loader_off(),t('[data-action="wsf-list-item-insert"]').click(function(e){var i=t(this).attr("data-action-html");t.WS_Form.this.input_insert_text(t('[data-meta-key="'+a+'"]'),i)})},t.WS_Form.prototype.sidebar_api_reload_init=function(e){this.api_reload_init(e,function(e,i,a){var o=e.closest(".wsf-sidebar-inner");t.WS_Form.this.sidebar_inits(["options-action","repeater"],o)},null,!0)},t.WS_Form.prototype.sidebar_option_action_init=function(e,i){this.options_action_objects=t("[data-options-action-api-populate]",e).toArray(),this.sidebar_option_action_process(i)},t.WS_Form.prototype.sidebar_option_action_process=function(e){if(0==this.options_action_objects.length)return e(),!0;var i=t(this.options_action_objects.shift()),a=i.attr("data-options-action-id");if(null==a){var o=i.attr("data-options-action-id-meta-key");null!=o&&(a=t('[data-meta-key="'+o+'"]',t("#wsf-sidebars")).val())}var s=i.attr("data-options-action-api-populate"),r=i.attr("data-options-list-id-meta-key"),n=null!=r&&t('[data-meta-key="'+r+'"]',t("#wsf-sidebars")).val(),d=i.attr("data-options-list-sub-id-meta-key"),_=null!=d&&t('[data-meta-key="'+d+'"]',t("#wsf-sidebars")).val(),l=t.WS_Form.this.action_api_method_path(a,s,n,_);if(!1===l)return this.sidebar_option_action_process(e);var c=i.attr("data-object"),f=i.attr("data-object-id"),h=t.WS_Form.this.get_object_data(c,f,!0),u=i.attr("data-meta-key");if(!1===(void 0!==t.WS_Form.meta_keys[u]&&t.WS_Form.meta_keys[u]))return this.sidebar_option_action_process(e);var m=i.attr("data-repeater-meta-key");if(void 0===m)var p=t.WS_Form.this.get_object_meta_value(h,u,[],!0);else{var v=i.closest("tr").index(),b=t.WS_Form.this.get_object_meta_value(h,m,[],!0),g=void 0!==b[v]?b[v]:[];p=void 0!==g[u]?g[u]:""}if(void 0!==this.options_action_cache[l]){var w=this.options_action_cache[l];return this.sidebar_option_action_process_render(i,w,p,e)}t.WS_Form.this.api_call(l,"GET",!1,function(a){var o=[];if(void 0!==a.data){var s=a.data;for(var r in s){var n=s[r],d=n.label;void 0!==n.required&&n.required&&(d+=" *"),o.push({value:n.id,text:d})}}return t.WS_Form.this.options_action_cache[l]=o,t.WS_Form.this.sidebar_option_action_process_render(i,o,p,e)},function(){return t.WS_Form.this.sidebar_option_action_process(e)},!0)},t.WS_Form.prototype.sidebar_option_action_process_render=function(e,i,a,o){var s="",r=e.attr("data-meta-key"),n=t.WS_Form.meta_keys[r];for(var d in void 0!==n.options_blank&&(s+='<option value="">'+this.html_encode(n.options_blank)+"</option>"),i){var _=i[d];s+='<option value="'+this.html_encode(_.value)+'"'+(a==_.value?' selected="selected"':"")+">"+this.html_encode(_.text)+"</option>"}return e.html(s),this.sidebar_option_action_process(o)},t.WS_Form.prototype.sidebar_repeater_init=function(e){t(".wsf-repeater",e).each(function(){t.WS_Form.this.sidebar_repeater_render(t(this))})},t.WS_Form.prototype.sidebar_repeater_render=function(e){var i=this.sidebar_repeater_get(e),a=this.sidebar_repeater_html(i);if(e.html(a.html),this.sidebar_inits(a.inits,e),!1!==i.meta_keys_unique)for(var o in i.meta_keys_unique){var s=i.meta_keys_unique[o],r=t.WS_Form.meta_keys[s];void 0!==r.key&&(s=r.key),this.sidebar_repeater_options_unique(s,e),t('select[data-meta-key="'+s+'"]',e).change(function(){t.WS_Form.this.sidebar_repeater_options_unique(s,e)})}t('[data-action="wsf-repeater-row-add"] div',e).click(function(){var e=t(this).closest(".wsf-repeater"),i=e.attr("data-object"),a=e.attr("data-id"),o=t.WS_Form.this.get_object_data(i,a,!0),s=e.attr("data-meta-key");t.WS_Form.this.object_data_update_by_meta_key(i,o,s);var r=t.WS_Form.this.sidebar_repeater_get(e),n=t.WS_Form.this.sidebar_repeater_row_new(r.meta_keys);r.data.push(n),t.WS_Form.this.set_object_meta_value(r.object_data,r.meta_key,r.data),t.WS_Form.this.sidebar_repeater_render(e);t.WS_Form.this.sidebar_inits(["options-action","repeater"],e)}),t('[data-action="wsf-repeater-row-delete"]',e).click(function(){var e=t(this).closest(".wsf-repeater"),i=e.attr("data-object"),a=e.attr("data-id"),o=t.WS_Form.this.get_object_data(i,a,!0),s=e.attr("data-meta-key"),r=(t.WS_Form.this.sidebar_repeater_get(e),t(this).closest("tr"));r.index();r.remove(),t.WS_Form.this.object_data_update_by_meta_key(i,o,s),t.WS_Form.this.sidebar_repeater_render(e);t.WS_Form.this.sidebar_inits(["options-action","repeater"],e)})},t.WS_Form.prototype.sidebar_repeater_options_unique=function(e,i){var a=[];t('select[data-meta-key="'+e+'"]',i).each(function(){a.push(t(this).val()),t("option:not([data-disabled-always])",t(this)).attr("disabled",!1)}),t('select[data-meta-key="'+e+'"]',i).each(function(){var e=t.extend(!0,[],a),i=e.indexOf(t(this).val());for(var o in i>-1&&e.splice(i,1),e)t('option[value="'+e[o]+'"]:not([data-disabled-never])',t(this)).attr("disabled","")})},t.WS_Form.prototype.sidebar_repeater_row_new=function(e){var i={};for(var a in e){var o=e[a];if(void 0===t.WS_Form.meta_keys[o])return!1;var s=void 0!==t.WS_Form.meta_keys[o].default?t.WS_Form.meta_keys[o].default:"";void 0!==t.WS_Form.meta_keys[o].key&&(o=t.WS_Form.meta_keys[o].key),i[o]=s}return i},t.WS_Form.prototype.sidebar_repeater_get=function(e){var i=e.attr("data-meta-key");if(void 0===t.WS_Form.meta_keys[i])return!1;var a=t.WS_Form.meta_keys[i];if("object"!=typeof a.meta_keys)return!1;var o=a.meta_keys,s=void 0!==a.meta_keys_unique&&a.meta_keys_unique,r=e.attr("data-object"),n=e.attr("data-id"),d=t.WS_Form.this.get_object_data(r,n,!0),_=t.WS_Form.this.get_object_meta_value(d,i,[],!0);return"object"!=typeof _&&(_=[]),{object:r,object_id:n,meta_key:i,meta_keys:o,meta_keys_unique:s,object_data:d,data:_}},t.WS_Form.prototype.sidebar_repeater_html=function(e){var i="<table><thead><tr>",a=[];for(var o in e.meta_keys){var s=e.meta_keys[o];if(void 0===t.WS_Form.meta_keys[s])return!1;var r=t.WS_Form.meta_keys[s];i+="<th>"+this.html_encode(r.label)+"</th>"}for(var n in i+="<th data-icon></th>",i+="</tr></thead><tbody>",e.data){var d=e.data[n],_=this.sidebar_repeater_row_html(e,d,e.meta_key);i+=_.html,a=a.concat(_.inits)}return i+="</tbody></table>",{html:i+='<div data-action="wsf-repeater-row-add" title="'+this.language("repeater_row_add")+'"><div>'+this.svg("plus-circle")+"</div></div>",inits:a}},t.WS_Form.prototype.sidebar_repeater_row_html=function(t,e,i){var a="<tr>",o=[],s=[];for(var r in s.meta=e,t.meta_keys){var n=t.meta_keys[r],d={fieldsets:{}};d.fieldsets[t.object_id]={meta_keys:[n]};var _=this.sidebar_html(t.object,t.object_id,s,d,i);a+="<td>"+_.html+"</td>",o=o.concat(_.inits)}return a+='<td data-icon><div data-action="wsf-repeater-row-delete" title="'+this.language("repeater_row_delete")+'">'+this.svg("minus-circle")+"</div></td>",{html:a+="</tr>",inits:o}},t.WS_Form.prototype.sidebar_range_init=function(e){var i=t('input[type="range"]',e).first();return!!i.length&&(i.on("input",function(){t.WS_Form.this.sidebar_range_update(e,i)}),t.WS_Form.this.sidebar_range_update(e,i),"advanced"==t.WS_Form.settings_plugin.mode||!!t('input[type="range"][data-meta-key="default_value"]',e).first().length&&(t('[data-meta-key="min"],[data-meta-key="max"],[data-meta-key="step"]',e).change(function(){t.WS_Form.this.sidebar_default_value_attributes(e,i,"range"),this.sidebar_range_update(e,i)}),void t.WS_Form.this.sidebar_default_value_attributes(e,i,"range")))},t.WS_Form.prototype.sidebar_range_update=function(e,i){var a=i.val(),o=i.attr("data-meta-key");t("#wsf_"+o+"_range_value",e).html(a)},t.WS_Form.prototype.sidebar_number_init=function(e){var i=t('input[type="number"][data-meta-key="default_value"]',e).first();if(!i.length)return!1;t('[data-meta-key="min"],[data-meta-key="max"],[data-meta-key="step"]',e).change(function(){t.WS_Form.this.sidebar_default_value_attributes(e,i,"number")}),t.WS_Form.this.sidebar_default_value_attributes(e,i,"number")},t.WS_Form.prototype.sidebar_datetime_init=function(e){var i=t('input[data-meta-key="default_value"]',e).first();if(!i.length)return!1;t('[data-meta-key="min_date"],[data-meta-key="max_date"],[data-meta-key="step"]',e).change(function(){t.WS_Form.this.sidebar_default_value_attributes(e,i,"datetime")}),t.WS_Form.this.sidebar_default_value_attributes(e,i,"datetime")},t.WS_Form.prototype.sidebar_default_value_attributes=function(e,i,a){var o=i.val();switch(a){case"datetime":var s="min_date",r="max_date";break;default:s="min",r="max"}var n=t('[data-meta-key="'+s+'"]',e).first(),d=t('[data-meta-key="'+r+'"]',e).first(),_=t('[data-meta-key="step"]',e).first();switch(a){case"range":var l=this.get_number(n.val(),0),c=this.get_number(d.val(),100),f=this.get_number(_.val(),1);""!=d.val()&&l>c&&(l=c,n.val(l)),0==l?i.removeAttr("min"):i.attr("min",l),100==c?i.removeAttr("max"):i.attr("max",c),1==f?i.removeAttr("step"):i.attr("step",f),i.val(o>c?c:o<l?l:o);break;case"number":l=""!=n.val()&&this.get_number(n.val()),c=""!=n.val()&&this.get_number(d.val()),f=""!=n.val()&&this.get_number(_.val());!1!==l&&!1!==c&&l>c&&(l=c,n.val(l)),!1===l?i.removeAttr("min"):i.attr("min",l),!1===c?i.removeAttr("max"):i.attr("max",c),!1===f?i.removeAttr("step"):i.attr("step",f),!1!==c&&o>c&&i.val(c),!1!==l&&o<l&&i.val(l);case"datetime":l=""!=n.val()&&n.val(),c=""!=n.val()&&d.val(),f=""!=n.val()&&_.val();!1===l?i.removeAttr("min"):i.attr("min",l),!1===c?i.removeAttr("max"):i.attr("max",c),!1===f?i.removeAttr("step"):i.attr("step",f)}},t.WS_Form.prototype.sidebar_tabs_init=function(e,i){e.tabs({activate:function(){i.scrollTop(0),t.WS_Form.this.sidebar_tinymce_init(i),t.WS_Form.this.sidebar_html_editor_init(i)}})},t.WS_Form.prototype.sidebar_field_select_init=function(){var e='<div class="wsf-field-select"><ul>';for(var i in t.WS_Form.field_types){var a=t.WS_Form.field_types[i],o=a.label,s=a.types;if(0!=s.length){for(var r in e+='<li class="wsf-field-selector-group wsf-fields-group-'+i+'"><h3>'+o+"</h3><ul>",s){var n=s[r];e+='<li class="wsf-field-wrapper'+(n.pro_required?" wsf-pro-required":"")+'" data-type="'+r+'"><div class="wsf-field-inner"><div class="wsf-field-label">'+n.icon+'</div><div class="wsf-field-type">'+n.label+"</div></div></li>"}e+="</ul></li>"}}e+="</ul></div>",t("#wsf-form-field-selector").html(e),t(".wsf-field-selector-group > ul > li:not(.wsf-pro-required)").draggable({connectToSortable:".wsf-fields",helper:"clone",revert:"invalid",zIndex:100001,cancel:".wsf-field-disabled, .wsf-pro-required",appendTo:"#wsf-field-draggable ul",distance:3,start:function(e,i){i.helper.width(t(this).width()),t.WS_Form.this.dragged_field=t(i.helper),t.WS_Form.this.sidebar_reset()},drag:function(){t.WS_Form.this.field_type_click_drag_check=!0}}).disableSelection(),t(".wsf-field-selector-group > ul > li:not(.wsf-pro-required)").bind("mousedown",function(){t.WS_Form.this.field_type_click_drag_check=!1}),t(".wsf-field-selector-group > ul > li:not(.wsf-pro-required)").bind("mouseup",function(){if(!1===t.WS_Form.this.field_type_click_drag_check){var e=t.WS_Form.this.field_type_click_section_id_set();if(!1===e)return;var i='<li class="wsf-field-wrapper" data-type="'+t(this).attr("data-type")+'">'+t(this).html()+"</li>";t("#wsf-fields-"+e).append(i);var a=t("#wsf-fields-"+e+" li").last();t.WS_Form.this.field_post(a),t.WS_Form.this.init_ui(),t.WS_Form.this.sidebar_reset()}}),t('[data-action="wsf-sidebar-cancel"]',t("#wsf-sidebar-toolbox")).click(function(){t.WS_Form.this.sidebar_reset()})},t.WS_Form.prototype.sidebar_form_history_init=function(){var e='<div class="wsf-form-history"><h3>'+this.language("sidebar_title_history")+"</h3><ul></ul></div>";t("#wsf-form-form-history").html(e),this.touch_device||t(".wsf-form-history ul").mouseleave(function(){var e=t.WS_Form.this.history_index;t.WS_Form.this.history_pull(e),t.WS_Form.this.sidebar_form_history_classes()})},t.WS_Form.prototype.sidebar_tinymce_init=function(e){return"undefined"!=typeof wp&&(void 0!==wp.editor&&(void 0!==wp.editor.remove&&(void 0!==wp.editor.initialize&&void t('.wsf-sidebar-tabs-panel:visible [data-text-editor="true"], [id^=wsf-action] [data-text-editor="true"], .wsf-text-editor [data-text-editor="true"]',e).each(function(){var e=t(this).attr("id"),i={tinymce:{wpautop:!0,plugins:"charmap colorpicker compat3x directionality fullscreen hr image lists media paste tabfocus textcolor wordpress wpautoresize wpdialogs wpeditimage wpemoji wpgallery wplink wptextpattern wpview",toolbar1:"formatselect bold italic | bullist numlist | blockquote | alignleft aligncenter alignright | link unlink | wp_more | spellchecker | fullscreen | wp_adv",toolbar2:"strikethrough hr forecolor pastetext removeformat charmap outdent indent undo redo",height:"200px",init_instance_callback:function(e){e.on("keyup change",function(i){t("#"+e.id).val(wp.editor.getContent(e.id)).trigger("keyup").trigger("input")})}},quicktags:!0,mediaButtons:!0},a=t(this).attr("data-helper-css");a&&(i.tinymce.content_css=ws_form_settings.url+"helper/"+a+"/"),wp.editor.remove(e),wp.editor.initialize(e,i)}))))},t.WS_Form.prototype.sidebar_buttons_init=function(e,i){t('button[data-action="wsf-sidebar-save"]',i).click(function(){t.WS_Form.this.object_button_save(e,!1)}),t('button[data-action="wsf-sidebar-save-close"]',i).click(function(){t.WS_Form.this.object_button_save(e,!0)}),t('button[data-action="wsf-sidebar-cancel"]',i).click(function(){t.WS_Form.this.object_button_cancel(e)}),t('button[data-action="wsf-sidebar-clone"]',i).click(function(){t.WS_Form.this.object_button_clone(e)}),t('button[data-action="wsf-sidebar-delete"]',i).click(function(){t.WS_Form.this.object_button_delete(e)}),t.WS_Form.this.keydown[27]={function:function(){t.WS_Form.this.object_button_cancel(e)},ctrl_key:!1},t.WS_Form.this.keydown[83]={function:function(){t.WS_Form.this.object_button_save(e,!0)},ctrl_key:!0}},t.WS_Form.prototype.sidebar_conditions_init=function(e){if(0===this.sidebar_conditions.length)return!0;var i=this,a=[];if(void 0===e.attr("data-sidebar-conditions-init")){for(var o in this.sidebar_conditions){var s=this.sidebar_conditions[o].meta_key,r='[data-meta-key="'+s+'"]';0!=t(r,e).length&&(void 0===a[s]&&(a[s]=!0,e.on("change",r,function(){i.sidebar_condition_process(e,t(this),!1)})))}e.attr("data-sidebar-conditions-init",""),this.sidebar_conditions_events_added=!0}this.sidebar_condition_process(e,e,!0)},t.WS_Form.prototype.sidebar_condition_process=function(e,i,a){if(0==this.sidebar_conditions.length)return!0;var o=[];for(var s in this.sidebar_conditions){var r=this.sidebar_conditions[s],n=r.meta_key,d=t('[data-meta-key="'+n+'"]',e);if(d.length){var _=d.attr("type"),l=r.logic,c=r.meta_value,f=r.show,h=t('[data-meta-key="'+f+'"]',e),u=r.logic_previous;if(h.length){var m=!0,p="";switch(_){case"checkbox":switch(p=d.is(":checked"),l){case"==":m=p;break;case"!=":m=!p}break;default:if(null===(p=d.val())&&(p=""),"default"===p){var v=t.WS_Form.meta_keys[n];void 0!==v.options_default&&(p=this.get_object_meta_value(this.form,v.options_default,""))}switch(l){case"==":m=p==c;break;case"!=":m=p!=c}}if(void 0===o[f])o[f]=m;else switch(u){case"||":o[f]=o[f]||m;break;default:o[f]=o[f]&&m}}}}for(f in o){var b=o[f],g=t('[data-meta-key="'+f+'"]',e).closest(".wsf-field-wrapper"),w=g.closest("fieldset.wsf-fieldset",e);if(w.length)1==t(".wsf-field-wrapper",w).length&&(g=w);b?g.show().removeClass("wsf-field-hidden"):g.hide().addClass("wsf-field-hidden"),this.sidebar_fieldset_toggle(g)}if(!a){var S=i.closest(".wsf-data-grid");if(S.length){switch(S.attr("data-meta-key")){case"conditional":t.WS_Form.this.conditional_save();break;case"action":t.WS_Form.this.action_save()}}else{var W=i.closest("[data-object]"),F=W.attr("data-object"),y=W.attr("data-id"),k=t.WS_Form.this.get_object_data(F,y,!0);for(var x in t.WS_Form.this.object_meta_cache){var j=t.WS_Form.this.object_meta_cache[x].meta_key;t.WS_Form.this.object_data_update_by_meta_key(F,k,j)}}t.WS_Form.this.sidebar_inits(["options-action","repeater","text-editor","html-editor"],e)}},t.WS_Form.prototype.sidebar_fieldset_toggle=function(e){var i=e.closest(".wsf-fieldset");t(".wsf-field-wrapper",i).length==t(".wsf-field-hidden",i).length?i.hide():i.show()},t.WS_Form.prototype.sidebar_placeholders_init=function(e){t("[data-placeholder]",e).each(function(){var i=t('[name="label"]',e);if(i.length){var a=i.val(),o=t(this).attr("data-placeholder"),s=t.WS_Form.this.replace_all(o,"#label_lowercase",a.toLowerCase());s=t.WS_Form.this.replace_all(s,"#label",a)}else s="";t(this).attr("placeholder",t.WS_Form.this.html_encode(s))})},t.WS_Form.prototype.breakpoints=function(){var e=t("#wsf-breakpoints"),i=t.WS_Form.settings_plugin.framework,a=(i=t.WS_Form.frameworks.types[i]).breakpoints,o=t.WS_Form.frameworks.icons,s=this.get_object_meta_value(this.form,"breakpoint");t.WS_Form.breakpoints=[];var r=!1,n=0,d=0,_=0,l=1;for(var c in a){if(_++,c!=s||r){var f=Math.abs(c-s);(0==n||f<n)&&(n=f,d=c)}else r=!0,l=_;t.WS_Form.breakpoints.push(c)}r||(s=d,this.set_object_meta_value(this.form,"breakpoint",s),t.WS_Form.this.form_put(!1,!1,!0));var h=a[s].id;t("#"+this.form_obj_id).attr("data-breakpoint",h),e.html('<div id="wsf-slider"></div>'),e.append('<ul class="wsf-breakpoint-actions"><li><button class="wsf-button wsf-button-full wsf-button-small" data-action="wsf-reset">'+this.svg("undo")+" "+this.language("breakpoint_reset")+"</button></li></ul>");var u=t("#wsf-slider"),m=0;for(var c in a){s=a[c];if(void 0===o[c])var p="";else p=o[c];var v=[];void 0!==s.name&&v.push(s.name),void 0!==s.min_width?v.push(">= "+s.min_width+"px"):v.push("> 0 px"),void 0!==s.max_width&&v.push("<= "+s.max_width+"px");var b=v.join("\n");u.append('<label title="'+this.html_encode(b)+'" style="'+(ws_form_settings.rtl?"right":"left")+":"+m/(_-1)*100+'%;">'+p+"</label>"),m++}t("#wsf-slider").slider({range:"max",min:1,max:_,value:ws_form_settings.rtl?_-(l-1):l,start:function(){"off"!=t.WS_Form.settings_plugin.helper_columns&&t(".wsf-group:visible").addClass("wsf-column-helper")},stop:function(){"on"!=t.WS_Form.settings_plugin.helper_columns&&t(".wsf-group:visible").removeClass("wsf-column-helper"),t.WS_Form.this.form_put(!1,!1,!0)},slide:function(e,i){var a=t.WS_Form.breakpoints[ws_form_settings.rtl?_-i.value:i.value-1];t.WS_Form.this.breakpoint_set(a)}}),t('#wsf-breakpoints [data-action="wsf-reset"]').click(function(){var e=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("reset"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("confirm_breakpoint_reset"),e,t(this),function(){t.WS_Form.this.breakpoint_reset()})})},t.WS_Form.prototype.breakpoint_optimize=function(e){var i=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework],a=i.breakpoints,o=parseInt(i.columns.column_count),s=0,r=0;for(var n in a){var d=a[n];if(0==r){var _;s=void 0!==d.column_size_default?"column_count"==d.column_size_default?o:d.column_size_default:s}var l="breakpoint_size_"+n,c="breakpoint_offset_"+n,f=this.get_object_meta_value(e,l,"",!1);""!=f&&((f=parseInt(f))==s&&(e.meta[l]=""),s=f);var h=this.get_object_meta_value(e,c,"",!1);""!=h&&((h=parseInt(h))==_&&(e.meta[c]=""),_=h),r++}},t.WS_Form.prototype.breakpoint_reset=function(){t.WS_Form.settings_plugin.framework,t(t(".wsf-group-tab.ui-tabs-active a").attr("href"));for(var e in this.section_data_cache){var i=this.section_data_cache[e];t.WS_Form.this.breakpoint_reset_process(i)}for(var e in this.field_data_cache){i=this.field_data_cache[e];t.WS_Form.this.breakpoint_reset_process(i)}t.WS_Form.this.form_build(),t.WS_Form.this.loader_on(),t.WS_Form.this.api_call("form/"+t.WS_Form.this.form_id+"/full","PUT",{form:t.WS_Form.this.form,history_method:"put_reset"},function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.breakpoint_set=function(e){var i=t.WS_Form.settings_plugin.framework,a=t.WS_Form.frameworks.types[i].breakpoints[e].id;t.WS_Form.this.set_object_meta_value(t.WS_Form.this.form,"breakpoint",e),t("#"+t.WS_Form.this.form_obj_id).attr("data-breakpoint",a)},t.WS_Form.prototype.breakpoint_buttons=function(){var e=!1;t(t(".wsf-group-tab.ui-tabs-active a").attr("href"));for(var i in this.section_data_cache){var a=this.section_data_cache[i];e=e||t.WS_Form.this.breakpoint_can_reset(a,!0)}for(var i in this.field_data_cache){a=this.field_data_cache[i];e=e||t.WS_Form.this.breakpoint_can_reset(a,!0)}t('#wsf-breakpoints [data-action="wsf-reset"]').attr("disabled",!e)},t.WS_Form.prototype.sidebar_select_ajax=function(e){var i=this,a=[],o=[];for(var s in t("select[data-select-ajax-method-search]",e).each(function(){var e=t(this).attr("data-meta-key");void 0===a[e]&&(a[e]=t(this).attr("data-select-ajax-method-cache"));var i=t(this).attr("data-select-ajax-id");i&&o.push(i)}),a){var r=a[s];if(void 0===i.select_ajax_cache[s]&&r){var n={form_id:i.form_id,meta_key:s,ids:o};t.WS_Form.this.api_call("select2/"+r,"POST",n,function(t){i.loader_off(),i.select_ajax_cache[s]=t,i.sidebar_select_ajax_process(e,s)})}else i.sidebar_select_ajax_process(e,s)}},t.WS_Form.prototype.sidebar_select_ajax_process=function(e,i){var a=this;t('select[data-select-ajax-method-search][data-meta-key="'+i+'"]',e).each(function(){var e=t(this).attr("data-select-ajax-method-search"),o=t(this).attr("data-select-ajax-placeholder"),s={ajax:{url:ws_form_settings.url+"select2/"+e,dataType:"json"},delay:250,cache:!0,placeholder:o,minimumInputLength:1,allowClear:!0},r=t(this).attr("data-select-ajax-id");if(void 0!==r){var n=void 0!==a.select_ajax_cache[i][r]&&a.select_ajax_cache[i][r];!1!==n&&(s.data=[{id:r,text:n}])}"object"==typeof t(this).select2()&&e&&(t(this).select2(s),t(this).on("select2:select",function(e){var i=e.params.data.id,o=e.params.data.text,s=t(this).attr("data-meta-key");a.select_ajax_cache[s][i]=o}))})},t.WS_Form.prototype.sidebar_breakpoint_sizes=function(e){t(".wsf-breakpoint-sizes:not(.wsf-breakpoint-sizes-initialized)",e).each(function(e,i){t.WS_Form.this.sidebar_breakpoint_sizes_init(t(this),i)})},t.WS_Form.prototype.sidebar_breakpoint_sizes_init=function(e,i){i.render=function(){var a=e.attr("data-object"),o=e.attr("data-id"),s=e.attr("data-meta-key");switch(a){case"section":var r=t('.wsf-section[data-id="'+o+'"]');break;case"field":r=t('.wsf-field-wrapper[data-id="'+o+'"]')}var n=t.WS_Form.this.get_object_data(a,o,!0);!1===n&&t.WS_Form.this.error("error_object_data"),!1===t.WS_Form.this.get_object_meta_value(n,s,!1)&&t.WS_Form.this.error("error_object_meta_value"),e.html(t.WS_Form.this.sidebar_breakpoint_sizes_html(r,s,n)),t('select[data-action="wsf-column"]',e).change(function(){var e=t(this).attr("data-id"),a=t(this).val(),o="breakpoint_size_"+e;r.length?(t.WS_Form.this.column_classes_render(r,n,!1),t.WS_Form.this.set_object_meta_value(n,o,a),t.WS_Form.this.column_classes_render(r,n)):t.WS_Form.this.error("error_object"),i.render()}),t('select[data-action="wsf-offset"]',e).change(function(){var e=t(this).attr("data-id"),a=t(this).val(),o="breakpoint_offset_"+e;r.length?(t.WS_Form.this.column_classes_render(r,n,!1),t.WS_Form.this.set_object_meta_value(n,o,a),t.WS_Form.this.column_classes_render(r,n)):t.WS_Form.this.error("error_object"),i.render()}),t('[data-action="wsf-reset"]',e).click(function(){var e=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("reset"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("confirm_breakpoint_reset"),e,t(this),function(){t.WS_Form.this.column_classes_render(r,n,!1),t.WS_Form.this.breakpoint_reset_process(n),t.WS_Form.this.column_classes_render(r,n),i.render()})});var d=t.WS_Form.this.breakpoint_can_reset(n,!0);t('[data-action="wsf-reset"]',e).attr("disabled",!d),e.addClass("wsf-breakpoint-sizes-initialized")},i.render()},t.WS_Form.prototype.sidebar_breakpoint_sizes_html=function(e,i,a){var o="",s=t.WS_Form.settings_plugin.framework,r=t.WS_Form.frameworks.types[s],n=r.columns.column_count,d=r.breakpoints,_=t.WS_Form.frameworks.icons,l=!1,c=!1,f=0;for(var h in d){var u=d[h],m=u.name;if(0==f)l=void 0!==u.column_size_default?"column_count"==u.column_size_default?n:u.column_size_default:l,c=0;var p="breakpoint_size_"+h,v=this.get_object_meta_value(a,p,"",!1);if(""!=v)var b=v=parseInt(v);else b=l;var g="breakpoint_offset_"+h,w=this.get_object_meta_value(a,g,"",!1);if(""!=w)w=parseInt(w);else;var S=n-w,W=n-b;if(o+="<div>",void 0===_[h])var F="";else F=_[h];o+='<label class="wsf-label">'+F+this.html_encode(m)+"</label>",o+='<div class="wsf-breakpoint-width-offset">',o+="<div>",o+='<label class="wsf-label" for="'+p+'">'+this.language("breakpoint_offset_column_width")+"</label>",o+='<select class="wsf-field wsf-column-size-select" id="'+p+'" data-id="'+h+'" data-action="wsf-column">',o+='<option value=""'+(""==v?" selected":"")+">";var y="("+this.language(1==l?"breakpoint_option_column_default_singular":"breakpoint_option_column_default_plural",l)+")";ws_form_settings.rtl&&!1!==l&&(o+=y+" "),o+=0==f?this.language("breakpoint_option_default"):this.language("breakpoint_option_inherit"),ws_form_settings.rtl||!1===l||(o+=" "+y),o+="</option>";for(var k=1;k<=S;k++)o+='<option value="'+k+'"'+(v===k?" selected":"")+">"+this.language(1==k?"breakpoint_option_column_singular":"breakpoint_option_column_plural",k)+"</option>";o+="</select>",o+="</div>",o+="<div>",o+='<label class="wsf-label" for="'+g+'">'+this.language("breakpoint_offset_column_offset")+"</label>",o+='<select class="wsf-field wsf-offset-select" id="'+g+'" data-id="'+h+'" data-action="wsf-offset">',o+='<option value=""'+(""===w?" selected":"")+">";var x="("+this.language(1==c?"breakpoint_option_offset_default_singular":"breakpoint_option_offset_default_plural",c)+")";ws_form_settings.rtl&&(o+=x+" "),o+=0==f?this.language("breakpoint_option_default"):this.language("breakpoint_option_inherit"),ws_form_settings.rtl||(o+=" "+x),o+="</option>";for(k=0;k<=W;k++)o+='<option value="'+k+'"'+(w===k?" selected":"")+">"+this.language(1==k?"breakpoint_option_offset_singular":"breakpoint_option_offset_plural",k)+"</option>";o+="</select>",o+="</div>",o+="</div>",o+="</div>",""!==v&&(l=v),""!==w&&(c=w),f++}return o+='<ul class="wsf-list-inline">',o+='<li><button class="wsf-button wsf-button-small" data-action="wsf-reset">'+this.svg("undo")+" "+this.language("breakpoint_reset")+"</button></li>",o+="</ul>"},t.WS_Form.prototype.breakpoint_can_reset=function(e){var i=!1,a=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework],o=a.breakpoints,s=parseInt(a.columns.column_count),r=0,n=0;for(var d in o){var _=o[d];if(0==n)r=void 0!==_.column_size_default?"column_count"==_.column_size_default?s:_.column_size_default:r;var l="breakpoint_size_"+d,c="breakpoint_offset_"+d,f=this.get_object_meta_value(e,l,"",!1);""!=f&&((f=parseInt(f))!=s&&(i=!0),r=f);var h=this.get_object_meta_value(e,c,"",!1);""!=h&&(0!=(h=parseInt(h))&&(i=!0),h),n++}return i},t.WS_Form.prototype.breakpoint_reset_process=function(e){var i=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework].breakpoints;for(var a in i)e.meta["breakpoint_size_"+a]="",e.meta["breakpoint_offset_"+a]=""},t.WS_Form.prototype.sidebar_orientation_breakpoint_sizes=function(e){t(".wsf-orientation-breakpoint-sizes:not(.wsf-orientation-breakpoint-sizes-initialized)",e).each(function(e,i){t.WS_Form.this.sidebar_orientation_breakpoint_sizes_init(t(this),i)})},t.WS_Form.prototype.sidebar_orientation_breakpoint_sizes_init=function(e,i){i.render=function(){var a=e.attr("data-object"),o=e.attr("data-id"),s=e.attr("data-meta-key"),r=t('.wsf-field-wrapper[data-id="'+o+'"]'),n=t.WS_Form.this.get_object_data(a,o,!0);!1===n&&t.WS_Form.this.error("error_object_data"),!1===t.WS_Form.this.get_object_meta_value(n,s,!1)&&t.WS_Form.this.error("error_object_meta_value"),e.html(t.WS_Form.this.sidebar_orientation_breakpoint_sizes_html(r,s,n)),t('select[data-action="wsf-column"]',e).change(function(){var e=t(this).attr("data-id"),a=t(this).val(),o="orientation_breakpoint_size_"+e;r.length?t.WS_Form.this.set_object_meta_value(n,o,a):t.WS_Form.this.error("error_object"),i.render()}),t('[data-action="wsf-reset"]',e).click(function(){var e=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("reset"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("confirm_orientation_breakpoint_reset"),e,t(this),function(){t.WS_Form.this.orientation_breakpoint_reset_process(n),i.render()})});var d=t.WS_Form.this.orientation_breakpoint_can_reset(n,!0);t('[data-action="wsf-reset"]',e).attr("disabled",!d),e.addClass("wsf-orientation-breakpoint-sizes-initialized")},i.render()},t.WS_Form.prototype.sidebar_orientation_breakpoint_sizes_html=function(e,i,a){var o="",s=t.WS_Form.settings_plugin.framework,r=t.WS_Form.frameworks.types[s],n=r.columns.column_count,d=r.breakpoints,_=t.WS_Form.frameworks.icons,l=!1,c=0;for(var f in d){var h=d[f],u=h.name;if(0==c)l=void 0!==h.column_size_default?"column_count"==h.column_size_default?n:h.column_size_default:l;var m="orientation_breakpoint_size_"+f,p=this.get_object_meta_value(a,m,"",!1);if(""!=p)p=parseInt(p);else;if(o+="<div>",void 0===_[f])var v="";else v=_[f];o+='<label class="wsf-label">'+v+this.language("orientation_breakpoint_label_width",this.html_encode(u))+"</label>",o+='<select class="wsf-field wsf-column-size-select" id="'+m+'" data-id="'+f+'" data-action="wsf-column">',o+='<option value=""'+(""==p?" selected":"")+">"+(0==c?this.language("orientation_breakpoint_option_default"):this.language("orientation_breakpoint_option_inherit")),!1!==l&&(o+=" ("+this.orientation_column_width_description(l,n)+")"),o+="</option>";for(var b=1;b<=n;b++)if(!(b>n/2&&b<n)){var g=this.orientation_column_width_description(b,n);!1!==g&&(o+='<option value="'+b+'"'+(p===b?" selected":"")+">"+g+"</option>")}o+="</select>",o+="</div>",""!==p&&(l=p),c++}return o+='<ul class="wsf-list-inline">',o+='<li><button class="wsf-button wsf-button-small" data-action="wsf-reset">'+this.svg("undo")+" "+this.language("breakpoint_reset")+"</button></li>",o+="</ul>"},t.WS_Form.prototype.orientation_column_width_description=function(t,e){if(e%t!=0)return!1;var i=this.language(1==t?"orientation_breakpoint_option_column_singular":"orientation_breakpoint_option_column_plural",t);switch(t/e){case 1:i+=this.language("orientation_breakpoint_width_full");break;case.5:i+=this.language("orientation_breakpoint_width","&frac12;",!1);break;case 1/3:i+=this.language("orientation_breakpoint_width","&frac13;",!1);break;case 2/3:i+=this.language("orientation_breakpoint_width","&frac23;",!1);break;case.25:i+=this.language("orientation_breakpoint_width","&frac14;",!1);break;case.75:i+=this.language("orientation_breakpoint_width","&frac34;",!1);break;case.2:i+=this.language("orientation_breakpoint_width","&frac15;",!1);break;case.4:i+=this.language("orientation_breakpoint_width","&frac25;",!1);break;case.6:i+=this.language("orientation_breakpoint_width","&frac35;",!1);break;case.8:i+=this.language("orientation_breakpoint_width","&frac45;",!1);break;case 1/6:i+=this.language("orientation_breakpoint_width","&frac16;",!1);break;case 5/6:i+=this.language("orientation_breakpoint_width","&frac56;",!1)}return i},t.WS_Form.prototype.orientation_breakpoint_optimize=function(e){var i=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework],a=i.breakpoints,o=parseInt(i.columns.column_count),s=0,r=0;for(var n in a){var d=a[n];if(0==r)s=void 0!==d.column_size_default?"column_count"==d.column_size_default?o:d.column_size_default:s;var _="orientation_breakpoint_size_"+n,l=this.get_object_meta_value(e,_,"",!1);""!=l&&((l=parseInt(l))==s&&(e.meta[_]=""),s=l),r++}},t.WS_Form.prototype.orientation_breakpoint_can_reset=function(e){var i=!1,a=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework],o=a.breakpoints,s=parseInt(a.columns.column_count),r=0,n=0;for(var d in o){var _=o[d];if(0==n)r=void 0!==_.column_size_default?"column_count"==_.column_size_default?s:_.column_size_default:r;var l="orientation_breakpoint_size_"+d,c=this.get_object_meta_value(e,l,"",!1);""!=c&&((c=parseInt(c))!=s&&(i=!0),r=c),n++}return i},t.WS_Form.prototype.orientation_breakpoint_reset_process=function(e){var i=t.WS_Form.frameworks.types[t.WS_Form.settings_plugin.framework].breakpoints;for(var a in i)e.meta["orientation_breakpoint_size_"+a]=""},t.WS_Form.prototype.data_grid_html=function(e,i,a,o){if("object"!=typeof i)return"";void 0===i.columns&&this.error("error_data_grid_columns"),void 0===i.groups&&this.error("error_data_grid_groups"),void 0===i.rows_per_page&&this.error("error_data_grid_rows_per_page"),void 0===a&&(a="");var s=i.columns,r=i.groups,n=i.rows_per_page,d=t.WS_Form.meta_keys[e],_=d.groups_group,l=(void 0!==d.conditional&&d.conditional,void 0!==d.upload_download&&d.upload_download),c=void 0!==d.data_source&&d.data_source;"undefined"!=typeof rows_per_page_override&&(n=rows_per_page_override);s.length;var f=r.length,h="";c&&(h+='<div id="wsf-data-source-meta"></div>'),h+='<div class="wsf-field-wrapper wsf-data-grid-groups">',h+='<div class="wsf-data-grid-group-tabs-wrapper">',h+='<ul class="wsf-data-grid-group-tabs">';f=r.length;for(var u in r){var m=r[u];h+='<li class="wsf-data-grid-group-tab'+(1==f?" ui-state-active":"")+'">',h+='<a href="#wsf-data-grid-group-'+u+'">',h+=this.html_encode(m.label),h+="</a>",!o&&f>1&&(h+='<div data-action="wsf-data-grid-group-delete" title="'+this.language("data_grid_group_delete")+'">'+this.svg("close-circle")+"</div>"),h+="</li>"}!o&&_&&(h+='<li class="wsf-ui-cancel" data-action="wsf-data-grid-group-add" title="'+this.language("data_grid_group_add")+'"><div>'+this.svg("plus-circle")+"</div></li>"),h+="</ul>\n\n";var p=[];for(var u in void 0!==d.compatibility_url&&t.WS_Form.settings_plugin.helper_compatibility&&p.push('<li><div class="wsf-data-grid-compatibility"><a class="wsf-compatibility" href="'+d.compatibility_url+'" target="_blank" title="'+this.language("field_compatibility")+'" tabindex="-1">'+this.svg("markup-circle")+"</a></div></li>"),l&&(o||p.push('<li><div data-action="wsf-data-grid-upload" title="'+this.language("data_grid_group_upload_csv")+'">'+this.svg("upload")+'</div><input type="file" class="wsf-file-upload" id="wsf-data-grid-upload-file" accept=".csv"/></li>'),p.push('<li><div data-action="wsf-data-grid-download" title="'+this.language("data_grid_group_download_csv")+'">'+this.svg("download")+"</div></li>")),p.length&&(h+='<ul class="wsf-data-grid-options">'+p.join("")+"</ul>"),h+="</div>\n\n",r){m=r[u];if(h+=this.data_grid_html_group(m,u,s,n,e,o),!_)break}return l&&(h+='<div class="wsf-data-grid-upload-csv-window"><div class="wsf-data-grid-upload-csv-window-content"><h1>'+this.language("data_grid_upload_csv")+'</h1><div class="wsf-uploads"></div></div></div>'),h+="</div>"},t.WS_Form.prototype.data_grid_html_group=function(e,i,a,o,s,r){var n=t.WS_Form.meta_keys[s],d=parseInt(e.page);void 0===e.rows&&(e.rows=[]);var _=e.rows,l=_.length,c=!r&&(void 0!==n.row_default&&n.row_default),f=!r&&(void 0!==n.row_disabled&&n.row_disabled),h=!r&&(void 0!==n.row_required&&n.row_required),u=!r&&(void 0!==n.row_hidden&&n.row_hidden),m=void 0===n.groups_label||n.groups_label,p=void 0!==n.groups_label_label?this.html_encode(n.groups_label_label):this.language("data_grid_groups_label"),v=void 0===n.groups_label_render||n.groups_label_render,b=void 0!==n.groups_label_render_label?this.html_encode(n.groups_label_render_label):this.language("data_grid_groups_label_render"),g=void 0===n.groups_group||n.groups_group,w=void 0!==n.groups_group_label?this.html_encode(n.groups_group_label):this.language("data_grid_groups_group"),S=void 0===n.groups_disabled||n.groups_disabled,W=void 0!==n.groups_auto_group&&n.groups_auto_group,F=m||W||g||S,y=(void 0!==n.rows_randomize&&n.rows_randomize,'<div id="wsf-data-grid-group-'+i+'" class="wsf-data-grid-group" data-group-index="'+i+'">\n\n');y+='<div class="wsf-data-grid-table-outer"><div class="wsf-data-grid-table-inner"><table><thead>\n\n',y+=this.data_grid_html_row_header(a,i,c,f,h,u,s,r),y+="</thead>\n<tbody>";for(var k=d*o;k<l&&(0==o||k<(d+1)*o);k++)y+=this.data_grid_html_row(_[k],i,k,c,f,h,u,s,r);y+="\n</tbody>\n</table>",y+="</div>",r||(y+='<div data-action="wsf-data-grid-row-add" title="'+this.language("data_grid_row_add")+'"><div>'+this.svg("plus-circle")+"</div></div>"),y+="</div>\n\n",y+='<ul class="wsf-data-grid-pagination"></ul>',y+='<ul class="wsf-data-grid-footer wsf-list-inline">',r||(y+="<li>",y+='<label class="wsf-label wsf-label-small">'+this.language("data_grid_row_bulk_actions")+"</label>",y+='<div class="wsf-field-inline">',y+='<select class="wsf-field wsf-field-small" disabled>\n',y+='<option value="">'+this.language("data_grid_row_bulk_actions_select")+"</option>\n",c&&(y+='<option value="default">'+this.language("data_grid_row_bulk_actions_default")+"</option>\n",y+='<option value="default_off">'+this.language("data_grid_row_bulk_actions_default_off")+"</option>\n"),h&&(y+='<option value="required">'+this.language("data_grid_row_bulk_actions_required")+"</option>\n",y+='<option value="required_off">'+this.language("data_grid_row_bulk_actions_required_off")+"</option>\n"),f&&(y+='<option value="disabled">'+this.language("data_grid_row_bulk_actions_disabled")+"</option>\n",y+='<option value="disabled_off">'+this.language("data_grid_row_bulk_actions_disabled_off")+"</option>\n"),u&&(y+='<option value="hidden">'+this.language("data_grid_row_bulk_actions_hidden")+"</option>\n",y+='<option value="hidden_off">'+this.language("data_grid_row_bulk_actions_hidden_off")+"</option>\n"),y+='<option value="delete">'+this.language("data_grid_row_bulk_actions_delete")+"</option>\n",y+="</select>",y+='<button class="wsf-button wsf-button-primary wsf-button-small" data-action="wsf-data-grid-bulk-action" disabled>'+this.language("data_grid_row_bulk_actions_apply")+"</button>\n\n",y+="</div>",y+="</li>"),y+="<li>",y+='<label class="wsf-label wsf-label-small" for="wsf-data-grid-rows-per-page-'+i+'">'+this.language("data_grid_rows_per_page")+"</label>",y+='<div class="wsf-field-inline">',y+='<select class="wsf-field wsf-field-small">\n',y+='<option value="0">'+this.language("data_grid_rows_per_page_0")+"</option>\n";var x=t.WS_Form.settings_form.data_grid.rows_per_page_options;for(var j in x)y+='<option value="'+j+'"'+(j==o?" selected":"")+">"+this.html_encode(x[j])+"</option>\n";return y+="</select>",y+='<button class="wsf-button wsf-button-primary wsf-button-small" data-action="wsf-data-grid-rows-per-page" disabled>'+this.language("data_grid_rows_per_page_apply")+"</button>\n\n",y+="</div>",y+="</li>",!r&&F&&(y+='<li class="wsf-flex-none"><div data-action="wsf-data-grid-settings" title="'+this.language("data_grid_settings")+'">'+this.svg("settings")+"</div></li>"),y+="</ul>",!r&&F&&(y+='<div class="wsf-data-grid-settings-wrapper">',y+='<div class="wsf-data-grid-settings">',m&&(y+='<label for="wsf-data-grid-group-label-'+i+'" class="wsf-label">'+p+"</label>\n",y+='<input type="text" id="wsf-field wsf-data-grid-group-label-'+i+'" class="wsf-field" data-text="label" value="'+this.html_encode(e.label)+'" maxlength="190" />\n'),g&&(y+='<input type="checkbox" id="wsf-data-grid-mask_group-'+i+'" class="wsf-field" data-children="wsf-data-grid-groups-group-'+i+'" data-checkbox="mask_group"'+(e.mask_group?" checked":"")+" />\n",y+='<label for="wsf-data-grid-mask_group-'+i+'" class="wsf-label">'+w+"</label>\n"),y+='<div id="wsf-data-grid-groups-group-'+i+'" class="wsf-field-indent">',m&&v&&(y+='<input type="checkbox" id="wsf-data-grid-group-label-render-'+i+'" class="wsf-field" data-checkbox="label_render"'+(e.label_render?" checked":"")+" />\n",y+='<label for="wsf-data-grid-group-label-render-'+i+'" class="wsf-label">'+b+"</label>\n"),S&&(y+='<input type="checkbox" id="wsf-data-grid-disabled-'+i+'" class="wsf-field" data-checkbox="disabled"'+(e.disabled?" checked":"")+" />\n",y+='<label for="wsf-data-grid-disabled-'+i+'" class="wsf-label">'+this.language("data_grid_group_disabled")+"</label>\n"),y+="</div>",W&&(y+='<label for="wsf-data-grid-auto-group-'+i+'" class="wsf-label">'+this.language("data_grid_group_auto_group")+"</label>\n",y+='<select class="wsf-field" data-action="wsf-data-grid-auto-group"></select>\n'),y+="</div>",y+="</div>"),y+="</div>\n\n"},t.WS_Form.prototype.data_grid_html_row_header=function(e,i,a,o,s,r,n,d){var _=t.WS_Form.meta_keys[n],l=void 0!==_.max_columns?_.max_columns:0,c=void 0!==_.type_sub&&_.type_sub,f="<tr>";if(!d){var h="wsf-data-grid-bulk-"+n+"-"+i;f+='<th data-fixed-sort class="wsf-data-grid-icon"></th>',f+='<th data-fixed-select class="wsf-data-grid-checkbox"><input id="'+h+'" class="wsf-field" data-action="wsf-data-grid-row-select-all" type="checkbox" /><label for="'+h+'" class="wsf-label"></label></th>'}var u=0;for(var m in e){var p=e[m],v=p.id,b=p.label;if(f+='<th><input type="text" class="wsf-field wsf-field-small" data-id="'+v+'" data-column="'+m+'" data-action="wsf-data-grid-column-label" value="'+this.html_encode(b)+'"'+(d?" readonly":"")+"/>",!d&&e.length>0&&(l>1||0==l)&&(f+='<div data-action="wsf-data-grid-column-delete" data-id="'+v+'" title="'+this.language("data_grid_column_delete")+'">'+this.svg("close-circle")+"</div>"),f+="</th>",u++,l>0&&u==l)break}return!1!==c&&(f+="<th data-fixed-icon></th>",f+="<th data-fixed-icon></th>"),!1!==c&&(f+="<th data-fixed-icon></th>"),a&&(f+="<th data-fixed-icon></th>"),s&&(f+="<th data-fixed-icon></th>"),o&&(f+="<th data-fixed-icon></th>"),r&&(f+="<th data-fixed-icon></th>"),!d&&(0==l||e.length<l)&&(f+='<th data-fixed-icon><div data-action="wsf-data-grid-column-add" title="'+this.language("data_grid_column_add")+'">'+this.svg("plus-circle")+"</div></th>"),f+="</tr>\n\n"},t.WS_Form.prototype.data_grid_html_row=function(e,i,a,o,s,r,n,d,_){var l=t.WS_Form.meta_keys[d],c=void 0!==l.max_columns?l.max_columns:0,f=void 0!==l.type_sub&&l.type_sub,h=(void 0!==l.conditional&&l.conditional,void 0!==l.insert_image&&l.insert_image&&!_);if(void 0===e.data)return"";var u=e.data;if(void 0===u.length)return"";var m=u.length,p="<tr>";if(!_){var v="wsf-data-grid-bulk-"+d+"-"+i+"-"+a;p+='<td data-fixed-sort><div data-action="wsf-data-grid-row-sort" title="'+this.language("data_grid_row_sort")+'">'+this.svg("sort")+"</div></td>",p+='<td data-fixed-select><input data-action="wsf-data-grid-row-select" id="'+v+'" class="wsf-field" type="checkbox" tabindex="-1" /><label for="'+v+'" class="wsf-label"></label></td>'}for(var b=0;b<m;b++){var g=u[b];if(p+="<td"+(h?" data-insert-image":"")+'><input class="wsf-field wsf-field-small" type="text" data-column="'+b+'" value="'+this.html_encode(g)+'"'+(_?" readonly":"")+" />",h&&(p+='<div data-action="wsf-insert-image" title="'+this.language("data_grid_insert_image")+'">'+this.svg("file-picture")+"</div>"),p+="</td>",c>0&&b==c-1)break}return!1!==f&&(p+='<td data-fixed-icon><div data-action="wsf-data-grid-'+f+'-edit" title="'+this.language("data_grid_"+f+"_edit")+'">'+this.svg("edit")+"</div></td>",p+='<td data-fixed-icon><div data-action="wsf-data-grid-'+f+'-clone" title="'+this.language("data_grid_"+f+"_clone")+'">'+this.svg("clone")+"</div></td>"),o&&(p+='<td data-fixed-icon><div data-attribute="default" data-status="'+(e.default?"on":"")+'" title="'+this.language("data_grid_row_default")+'">'+this.svg("check")+"</div></td>"),r&&(p+='<td data-fixed-icon><div data-attribute="required" data-status="'+(e.required?"on":"")+'" title="'+this.language("data_grid_row_required")+'">'+this.svg("asterisk")+"</div></td>"),s&&(p+='<td data-fixed-icon><div data-attribute="disabled" data-status="'+(e.disabled?"on":"")+'" title="'+this.language("data_grid_row_disabled")+'">'+this.svg("disabled")+"</div></td>"),n&&(p+='<td data-fixed-icon><div data-attribute="hidden" data-status="'+(e.hidden?"on":"")+'" title="'+this.language("data_grid_row_hidden")+'">'+this.svg("visible")+this.svg("hidden")+"</div></td>"),_||(p+='<td data-fixed-icon><div data-action="wsf-data-grid-row-delete" title="'+this.language("data_grid_row_delete")+'">'+this.svg("minus-circle")+"</div></td>"),p+="</tr>\n"},t.WS_Form.prototype.sidebar_data_grids_init=function(e){t(".wsf-data-grid:not(.wsf-data-grid-initialized)",e).each(function(e,i){t.WS_Form.this.data_grid_init(t(this),i)})},t.WS_Form.prototype.data_grid_settings_children=function(e,i){var a=i.is(":checked"),o=i.attr("data-children");if(o){var s=o.split(",");for(var r in s){var n=s[r];a?t("#"+n,e).show():t("#"+n,e).hide()}}},t.WS_Form.prototype.data_grid_init=function(e,i){i.render=function(a){if(void 0===a)a=!1;var o=e.attr("data-object"),s=e.attr("data-id"),r=e.attr("data-meta-key"),n=void 0!==(f=t.WS_Form.meta_keys[r]).type_sub&&f.type_sub,d=void 0!==f.data_source&&f.data_source,_=t.WS_Form.this.get_object_data(o,s,!0);if(!1===_&&t.WS_Form.this.error("error_object_data"),""===(l=t.WS_Form.this.get_object_meta_value(_,r,"",!0))){var l=f.default;t.WS_Form.this.set_object_meta_value(_,r,l)}var c=t.WS_Form.this.get_object_meta_value(_,"data_source_id","");e.html(t.WS_Form.this.data_grid_html(r,l,c,a));var f,h=!1;(d&&t.WS_Form.this.data_source_render(e,i),a)||(t('[data-action="wsf-data-grid-auto-group"]',e).change(function(){var e=t(this).val(),a=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),o=t.extend(!0,{},l.groups[a]),s=o.rows,r=[];for(var n in s){var d=s[n].data[e];void 0===d&&(d=""),void 0===r[d]&&(r[d]=t.extend(!0,{},o),r[d].label=""==d?t.WS_Form.this.language("data_grid_group_label_default"):d,r[d].rows=[],r[d].mask_group="on",r[d].page="0",r[d].disabled=""),r[d].rows.push(s[n])}for(var _ in l.groups=[],r)l.groups.push(r[_]);l.groups.sort(function(t,e){return t.label===e.label||(t.label<e.label?-1:1)}),l.group_index=0,i.render()}),t(".wsf-data-grid-groups table",e).each(function(){for(var e=0,i=t("th[data-fixed-icon]",t(this)),a=0;a<i.length;a++)e+=t(i[a]).outerWidth();var o=e;ws_form_settings.rtl?t(this).css({"padding-right":"47px","padding-left":o+"px"}):t(this).css({"padding-left":"47px","padding-right":o+"px"})}),t(".wsf-data-grid-group",e).on("dragenter",function(i){i.stopPropagation(),i.preventDefault(),t(".wsf-data-grid-upload-csv-window",e).fadeIn(200)}),t(".wsf-data-grid-upload-csv-window",e).on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),t(".wsf-data-grid-upload-csv-window",e).on("drop",function(i){i.preventDefault();var a=i.originalEvent.dataTransfer.files;t.WS_Form.this.data_grid_upload_csv(o,s,r,a,t(this),function(){t(".wsf-data-grid-upload-csv-window",e).fadeOut(200)})}),t(".wsf-data-grid-upload-csv-window",e).on("dragleave",function(i){t(".wsf-data-grid-upload-csv-window",e).fadeOut(200)}),t('[data-action="wsf-data-grid-upload"]',e).click(function(){t('input[id="wsf-data-grid-upload-file"]',e).click()}),t('input[id="wsf-data-grid-upload-file"]',e).change(function(){var i=t('input[id="wsf-data-grid-upload-file"]',e).prop("files");if(i.length>0){var a=t(".wsf-data-grid-upload-csv-window",e);a.fadeIn(200),t.WS_Form.this.data_grid_upload_csv(o,s,r,i,a)}}),void 0!==f.insert_image&&f.insert_image&&t('[data-action="wsf-insert-image"]',e).click(function(){t.WS_Form.this.file_frame_input_obj=t("input",t(this).closest("td")),t.WS_Form.this.file_frame?t.WS_Form.this.file_frame.open():(t.WS_Form.this.file_frame=wp.media.frames.file_frame=wp.media({title:"Select image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}),t.WS_Form.this.file_frame.on("select",function(){var e=t.WS_Form.this.file_frame.state().get("selection").first().toJSON(),i=e.url,a=e.alt,o=e.width,s=e.height,r="<img"+(o?' width="'+o+'"':"")+(s?' height="'+s+'"':"")+(a?' alt="'+a+'"':"")+' src="'+i+'" />';t.WS_Form.this.file_frame_input_obj.val(r).trigger("keyup")}),t.WS_Form.this.file_frame.open())}));if(t('[data-action="wsf-data-grid-download"]',e).click(function(){var i=t(t(".wsf-data-grid-group-tabs .ui-tabs-active").find("a").attr("href"),e).attr("data-group-index");t.WS_Form.this.data_grid_download_csv(o,s,r,i)}),a||(t('[data-action="wsf-data-grid-conditional-edit"]',e).click(function(){t.WS_Form.this.data_grid_row_open(t(this),"conditional",l)}),t('[data-action="wsf-data-grid-conditional-clone"]',e).click(function(){t.WS_Form.this.conditional_save(),t.WS_Form.this.data_grid_row_clone(t(this),i,l)}),t('[data-action="wsf-data-grid-action-edit"]',e).click(function(){t.WS_Form.this.data_grid_row_open(t(this),"action",l)}),t('[data-action="wsf-data-grid-action-clone"]',e).click(function(){t.WS_Form.this.action_save(),t.WS_Form.this.data_grid_row_clone(t(this),i,l)}),t("[data-attribute]",e).click(function(){var i=t(this).attr("data-attribute"),a=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),o=l.groups[a],s=o.rows,r="on"==t(this).attr("data-status"),n=1==e.closest(".wsf-sidebar").find('[data-meta-key="multiple"]:checked').length;switch(i){case"default":var d=void 0!==f.row_default_multiple&&f.row_default_multiple;n=n||d;break;case"required":var _=void 0!==f.row_required_multiple&&f.row_required_multiple;n=n||_;break;case"disabled":case"hidden":n=!0}if(!n)for(var c in t('.wsf-data-grid-group [data-attribute="'+i+'"]',t(this).closest(".wsf-data-grid-groups")).attr("data-status",""),l.groups){var h=l.groups[c].rows;for(var u in h)h[u][i]=""}if(r){t(this).attr("data-status","");var m=""}else{t(this).attr("data-status","on");m="on"}s[o.page*l.rows_per_page+t(this).closest("tr").index()][i]=m}),t('[data-action="wsf-data-grid-settings"]',e).click(function(){var i=t(".wsf-data-grid-settings-wrapper",e),a=t(".wsf-data-grid-settings",e);a.is(":visible")?(t(this).removeClass("wsf-editing"),i.removeClass("wsf-data-grid-settings-open"),a.slideUp()):(t(this).addClass("wsf-editing"),i.addClass("wsf-data-grid-settings-open"),a.slideDown())}),t("input[data-checkbox][data-children]",e).each(function(){t.WS_Form.this.data_grid_settings_children(e,t(this))}),t("input[data-checkbox]",e).change(function(){var i=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),a=l.groups[i],o=t(this).attr("data-checkbox"),s=t(this).is(":checked");a[o]=s?"on":"",t.WS_Form.this.data_grid_settings_children(e,t(this))}),t("input[data-text]",e).keyup(function(){var i=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),a=l.groups[i],o=t(this).attr("data-text"),s=""!=t(this).val()?t(this).val():t.WS_Form.this.language("data_grid_group_label_default");a[o]=s,t('.wsf-data-grid-group-tab a[href="#wsf-data-grid-group-'+i+'"], .wsf-data-grid-group-tab span',e).html(t.WS_Form.this.html_encode(s))})),t('[data-action="wsf-data-grid-rows-per-page"]',e).click(function(){var e=parseInt(t(this).siblings("select").first().val());t.WS_Form.this.data_grid_group_rows_per_page_set(l,e,o,s,r,function(){i.render(a)})}),t('[data-action="wsf-data-grid-rows-per-page"]',e).each(function(){t(this).siblings("select").first().change(function(){t('[data-action="wsf-data-grid-rows-per-page"]',e).prop("disabled",!1)})}),t(".wsf-data-grid-pagination",e).each(function(){var e=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),n=l.groups[e],d=l.rows_per_page,_=0==d?0:parseInt(n.page),c=n.rows,f=c.length,u=0==d?1:Math.ceil(f/d);if(_*d>=f&&f>0&&(_=u-1,t.WS_Form.this.data_grid_group_page_set(n,e,_,o,s,r,function(){h=!0})),u>1){var m=u-1,p=_>0?_-1:_,v=_<m?_+1:_,b=0==_?' class="disabled"':"",g=_==m?' class="disabled"':"",w='<li data-page="0"'+b+"><div>"+t.WS_Form.this.svg("first")+"</div></li>";w+='<li data-page="'+p+'"'+b+"><div>"+t.WS_Form.this.svg("previous")+"</div></li>";var S=_-4;S<0&&(S=0);var W=_+4;W>m&&(W=m);for(var F=S;F<W+1;F++)w+="<li"+(F==_?' class="active"':"")+' data-page="'+F+'"><div>'+(F+1)+"</div></li>";w+='<li data-page="'+v+'"'+g+"><div>"+t.WS_Form.this.svg("next")+"</div></li>",w+='<li data-page="'+m+'"'+g+"><div>"+t.WS_Form.this.svg("last")+"</div></li>",t(this).prepend(w),t("li[data-page]",t(this)).click(function(){var d=t(this).attr("data-page");_!=d&&t.WS_Form.this.data_grid_group_page_set(n,e,d,o,s,r,function(){i.render(a)})})}else t(this).remove()}),h)return i.render(a),!1;if((f=t.WS_Form.meta_keys[r]).groups_group){var u=l.group_index;t(".wsf-data-grid-groups",e).tabs({active:u,activate:function(i,n){a||t("table",e).sortable("refreshPositions");var d=n.newTab.index();l.group_index=d;var _=t.WS_Form.this.get_object_data(o,s);!1===_&&t.WS_Form.this.error("error_object_data");var c=t.WS_Form.this.get_object_meta_value(_,r,!1);if(!1===c&&t.WS_Form.this.error("error_object_meta_value"),void 0!==c.groups[d]){t.WS_Form.this.loader_on(),c.group_index=d;var f={};f.form_id=t.WS_Form.this.form_id,f[o]=_,f[o].history_suppress="on",t.WS_Form.this.api_call(o+"/"+s,"PUT",f,function(e){t.WS_Form.this.loader_off()})}}}),a||(t(".wsf-data-grid-group-tabs",e).sortable({cursor:"move",tolerance:"pointer",containment:"parent",scroll:!1,forceHelperSize:!0,revert:200,placeholder:"wsf-data-grid-group-tab-placeholder",cancel:".wsf-ui-cancel",items:"li:not(.wsf-ui-cancel)",start:function(e,i){t.WS_Form.data_grid_group_tab_index_dragged_from=i.helper.index();var a=["height: "+i.helper.height()+"px","width: "+i.helper.outerWidth()+"px"].join(";");i.placeholder.attr("style",a)},stop:function(e,i){var a=t.WS_Form.this.get_object_meta_value(_,r);!1===a&&t.WS_Form.this.error("error_object_meta_value");var o=a.groups,s=t.WS_Form.data_grid_group_tab_index_dragged_from,n=i.item.index();if(n>=o.length)for(var d=n-o.length;1+d--;)o.push(void 0);o.splice(n,0,o.splice(s,1)[0])}}),t('[data-action="wsf-data-grid-group-add"]',e).click(function(){if(void 0!==l.groups[0]){var e=t.extend(!0,{},l.groups[0]);e.rows=[],e.label=t.WS_Form.this.language("data_grid_group_label_default"),e.disabled="",e.mask_group="",e.label_render="",l.groups.push(e),l.group_index=l.groups.length-1,i.render()}else t.WS_Form.this.error("error_data_grid_default_group")}),t('[data-action="wsf-data-grid-group-delete"]',e).click(function(){var e=t(this).closest("li"),a=e.index(),o=l.groups,s=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("delete"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("data_grid_group_delete_confirm"),s,e,function(){delete o[a],o=t.grep(o,function(t){return 0==t||t});var e=[];for(var s in o)e.push(o[s]);l.groups=e,i.render()})}))}a||(t('[data-action="wsf-data-grid-column-add"]',e).click(function(){var e=l.columns,a=0;for(var n in e)e[n].id>a&&(a=e[n].id);var d={id:++a,label:t.WS_Form.this.language("data_grid_column_label_default")};l.columns.push(d);var _=l.groups;for(var c in _){var f=_[c].rows;for(var h in f){f[h].data.push("")}}t.WS_Form.this.data_grid_update_mask_row_lookups(o,s,r),i.render()}),t('[data-action="wsf-data-grid-column-delete"]',e).click(function(){var e=t(this).closest("th"),a=t(this).attr("data-id"),n=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("delete"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("data_grid_column_delete_confirm"),n,e,function(){var e=l.columns;for(var n in e)if(parseInt(e[n].id)==parseInt(a)){delete e[n],l.columns=t.grep(l.columns,function(t){return 0==t||t});break}if(!1!==n){var d=l.groups;for(var _ in d){var c=d[_].rows;for(var f in c){var h=c[f];delete h.data[n],h.data=t.grep(h.data,function(t){return 0==t||t})}}}t.WS_Form.this.data_grid_update_mask_row_lookups(o,s,r),i.render()})}),t('[data-action="wsf-data-grid-column-label"]',e).keyup(function(e){var i=t(this).attr("data-column"),a=(l.columns[i],""!=t(this).val()?t(this).val():t.WS_Form.this.language("data_grid_column_label_default"));l.columns[i].label=a,t.WS_Form.this.data_grid_update_mask_row_lookups(o,s,r)}),t('td input[type="text"]',e).keyup(function(i){if(13==i.keyCode){var a=t('input[type="text"]',e),o=a.index(this);return void 0!==a[o+1]&&a[o+1].focus(),!1}var s=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),r=l.groups[s],n=r.page*l.rows_per_page+t(this).closest("tr").index(),d=t(this).attr("data-column");r.rows[n].data[d]=t(this).val()}),t("table",e).sortable({items:"tbody tr",containment:"parent",cursor:"move",tolerance:"pointer",handle:'[data-action="wsf-data-grid-row-sort"]',axis:"y",cancel:".wsf-ui-cancel, input[type=text]:not([readonly])",start:function(i,a){t("table",e).sortable("refreshPositions"),t.WS_Form.data_grid_index_dragged_from=a.helper.index()},stop:function(e,i){var a=t.WS_Form.this.get_object_meta_value(_,r);!1===a&&t.WS_Form.this.error("error_object_meta_value");var o=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),s=a.groups[o],n=s.page*a.rows_per_page,d=n+t.WS_Form.data_grid_index_dragged_from,l=n+i.item.index(),c=s.rows;if(l>=c.length)for(var f=l-c.length;1+f--;)c.push(void 0);c.splice(l,0,c.splice(d,1)[0])}}),t('[data-action="wsf-data-grid-row-add"] div',e).click(function(){var e=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),a=l.groups[e],d=l.rows_per_page,_=0==d?0:a.page,c=l.columns.length,f=a.rows;switch(n){case"conditional":var h=[t.WS_Form.this.language("conditional_label_default"),JSON.stringify(t.WS_Form.this.conditional_new())];break;case"action":h=[t.WS_Form.this.language("action_label_default"),JSON.stringify(t.WS_Form.this.action_new())];break;default:h=new Array(c).join(".").split(".")}var u={id:t.WS_Form.this.data_grid_row_next_id(l),default:"",disabled:"",required:"",hidden:"",data:h};f.push(u);var m=f.length,p=(0==d?1:Math.ceil(m/d))-1;if(_!=p?t.WS_Form.this.data_grid_group_page_set(a,e,p,o,s,r,function(){i.render()}):i.render(),!1!==n){var v=t('[data-action="wsf-data-grid-'+n+'-edit"]',v).last();t.WS_Form.this.data_grid_row_open(v,n,l)}}),t('[data-action="wsf-data-grid-row-delete"]',e).click(function(){var e=t(this).closest("tr"),a=e.closest(".wsf-data-grid-group").attr("data-group-index"),o=l.groups[a],s=0==r?0:o.page,r=l.rows_per_page,n=s*r+e.index();delete o.rows[n],o.rows=t.grep(o.rows,function(t){return 0==t||t});var d=[];for(var _ in o.rows)d.push(o.rows[_]);o.rows=d,i.render()}),t('[data-action="wsf-data-grid-bulk-action"]',e).click(function(){var a=t(this).siblings("select").first().val(),o=t(this).closest(".wsf-data-grid-group").find('input[data-action="wsf-data-grid-row-select"]:checked',e).closest("tr"),s=t(this).closest(".wsf-data-grid-group").attr("data-group-index"),r=l.groups[s],n=r.page*l.rows_per_page;switch(a){case"delete":o.each(function(){var e=n+t(this).index();delete r.rows[e]}),r.rows=t.grep(r.rows,function(t){return 0==t||t});break;case"default":case"disabled":case"required":case"hidden":for(var d in r.rows)r.rows[d][a]="";o.each(function(){var e=n+t(this).index();r.rows[e][a]="on"});break;case"default_off":case"disabled_off":case"required_off":case"hidden_off":for(var d in a=a.replace("_off",""),r.rows)r.rows[d][a]="";o.each(function(){var e=n+t(this).index();r.rows[e][a]=""})}i.render()}),t('[data-action="wsf-data-grid-row-select-all"]',e).change(function(){var i=t(this).closest("table");t(this).is(":checked")?t('input[data-action="wsf-data-grid-row-select"]',i).attr("checked","checked"):t('input[data-action="wsf-data-grid-row-select"]',i).removeAttr("checked"),t.WS_Form.this.data_grid_bulk_action_button(e,o,s,r)}),t('[data-action="wsf-data-grid-row-select"]',e).change(function(){t.WS_Form.this.data_grid_bulk_action_button(e,o,s,r)}),e.closest(".wsf-sidebar").find('[data-meta-key="multiple"]').change(function(){t.WS_Form.this.data_grid_bulk_action_button(e,o,s,r,!0,i)})),t.WS_Form.this.data_grid_update_mask_row_lookups(o,s,r),e.addClass("wsf-data-grid-initialized")},i.render();var a=e.attr("data-object"),o=e.attr("data-id"),s=e.attr("data-meta-key"),r=t.WS_Form.meta_keys[s];if(void 0!==r.data_source&&r.data_source){var n=t.WS_Form.this.get_object_data(a,o,!0);!1===n&&t.WS_Form.this.error("error_object_data"),""!=t.WS_Form.this.get_object_meta_value(n,"data_source_id","")&&t(".wsf-data-grid-groups",e).hide()}},t.WS_Form.prototype.data_source_render=function(e,i){var a=e.attr("data-object"),o=e.attr("data-id"),s=e.attr("data-meta-key"),r=(void 0!==(l=t.WS_Form.meta_keys[s]).data_source&&l.data_source,t.WS_Form.this.get_object_data(a,o,!0));!1===r&&t.WS_Form.this.error("error_object_data");t.WS_Form.this.get_object_meta_value(r,s,"",!0);var n=t.WS_Form.this.get_object_meta_value(r,"data_source_id",""),d=t.WS_Form.data_sources[n];if(void 0===d.fieldsets||void 0===d.fieldsets[n]||void 0===d.fieldsets[n].meta_keys)return t("#wsf-data-source-meta",e).html(""),void t(".wsf-data-grid-groups",e).show();for(var _ in d.fieldsets[n].meta_keys){s=d.fieldsets[n].meta_keys[_];if(void 0!==t.WS_Form.meta_keys[s]&&void 0===r.meta[s]){var l,c=void 0!==(l=t.WS_Form.meta_keys[s]).default?l.default:"";r.meta[s]=c}}var f=this.sidebar_html(a,o,r,d,!1,!1,!0,!1,!1);t("#wsf-data-source-meta",e).html(f.html),t('[data-meta-key="data_source_id"]',e).change(function(){var s=t(this).val();t.WS_Form.this.object_data_update_by_meta_key(a,r,"data_source_id"),e.removeAttr("data-sidebar-conditions-init"),t.WS_Form.this.data_source_render(e,i),""!=s?t(".wsf-data-grid-groups",e).hide():i.render(),""!==t.WS_Form.this.get_object_meta_value(r,"data_source_last_api_error","")&&t.WS_Form.this.api_call("field/"+o+"/last_api_error/clear/","PUT",!1)}),t('[data-meta-key="data_source_get"]').click(function(){t.WS_Form.this.data_source_get(e)}),this.sidebar_inits(f.inits,e,e,r)},t.WS_Form.prototype.data_source_get=function(e,i,a){if(void 0===i)i=1;var o=e.attr("data-object"),s=e.attr("data-id"),r=e.attr("data-meta-key"),n=t.WS_Form.meta_keys[r],d=(void 0!==n.data_source&&n.data_source,t.WS_Form.this.get_object_data(o,s,!0));!1===d&&t.WS_Form.this.error("error_object_data");var _=t.WS_Form.this.get_object_meta_value(d,r,"",!0),l=t.WS_Form.this.get_object_meta_value(d,"data_source_id",""),c=t.WS_Form.data_sources[l];if(l){var f=["meta_key_value","meta_key_label","meta_key_parse_variable"];for(var h in f){var u=f[h],m=void 0!==n[u]&&n[u];!1!==m&&this.object_data_update_by_meta_key(o,d,m)}if(void 0!==(c=t.WS_Form.data_sources[l]).endpoint_get&&void 0!==c.fieldsets&&void 0!==c.fieldsets[l]&&void 0!==c.fieldsets[l].meta_keys){var p={field_id:s,meta_key:r,meta_value:_,page:i};for(var v in c.fieldsets[l].meta_keys){var b=c.fieldsets[l].meta_keys[v];this.object_data_update_by_meta_key(o,d,b),void 0!==d.meta[b]&&(p[b]=d.meta[b])}if(this.object_data_update_by_meta_key(o,d,r),void 0===a)(a=new this.upload_status_bar(e,!0,!1,!1)).populate(c.label_retrieving),a.set_progress(0),t("h1",e).hide(),t(".wsf-data-grid-upload-csv-window",e).fadeIn(200),t('[data-meta-key="data_source_get"]',e).attr("disabled","");t(".wsf-data-grid-groups",e).show(),t.WS_Form.this.loader_on(),this.api_call(c.endpoint_get,"POST",p,function(n){"object"!=typeof n.meta_value&&t.WS_Form.this.error("data_grid_data_source_error");var d=void 0!==n.max_num_pages?n.max_num_pages:1,_=d>1?Math.round(i/(d-1)*100):100;if(a.set_progress(_),1===i)t.WS_Form.this.object_data_scratch.meta[r]=n.meta_value;else for(var l in n.meta_value.groups){if(void 0!==n.meta_value.groups[l].rows)for(var c in n.meta_value.groups[l].rows){var f=n.meta_value.groups[l].rows[c];t.WS_Form.this.object_data_scratch.meta[r].groups[l].rows.push(f)}}if(i<d)t.WS_Form.this.data_source_get(e,++i,a);else{if("object"==typeof n.meta_keys)for(var h in n.meta_keys)t.WS_Form.this.object_data_scratch.meta[h]=n.meta_keys[h];t.WS_Form.this.data_grid_update_mask_row_lookups(o,s,r);var u=void 0!==n.deselect_data_source_id?n.deselect_data_source_id:"";u&&(t.WS_Form.this.object_data_scratch.meta.data_source_id=""),a.set_progress(100),setTimeout(function(){e.closest(".wsf-data-grid")[0].render(!u)},200),t.WS_Form.this.loader_off()}},function(i){void 0!==i.error_message&&t.WS_Form.this.data_source_error(d,i),e.closest(".wsf-data-grid")[0].render(!0),t(".wsf-data-grid-groups",e).hide(),t('[data-meta-key="data_source_get"]',e).removeAttr("disabled"),t.WS_Form.this.loader_off()})}}},t.WS_Form.prototype.data_source_error=function(t,e){var i=[];i.push(this.language("data_grid_data_source_error_last_field",t.label+" ("+this.language("data_grid_data_source_error_last_field_id",t.id)+")")),i.push(this.language("data_grid_data_source_error_last_source",e.data_source_label)),i.push(this.language("data_grid_data_source_error_last_date",e.date)),i.push(this.language("data_grid_data_source_error_last_error",e.error_message));var a=i.join("<br />");this.error("data_grid_data_source_error_last",a)},t.WS_Form.prototype.data_grid_row_open=function(e,i,a){if(t(".wsf-hidden-table-row").length){switch(t('[data-action="wsf-data-grid-row-sort"]').removeClass("wsf-ui-cancel"),i){case"action":t.WS_Form.this.action_save();break;case"conditional":t.WS_Form.this.conditional_save()}t(".wsf-hidden-table-row").remove();var o=e.hasClass("wsf-data-grid-row-open");if(t(".wsf-data-grid-row-open").removeClass("wsf-data-grid-row-open"),o)return}t('[data-action="wsf-data-grid-row-sort"]').addClass("wsf-ui-cancel"),e.addClass("wsf-data-grid-row-open");var s=e.closest(".wsf-data-grid-group").attr("data-group-index"),r=a.groups[s],n=r.rows[r.page*a.rows_per_page+e.closest("tr").index()],d=e.closest("tr");t("td",d).length;switch(t('<tr id="wsf-'+i+'-tr" class="wsf-hidden-table-row"><td></td><td></td><td class="wsf-hidden-table-cell"><div></div></td><td></td><td></td><td></td></tr>').insertAfter(d).show(),i){case"action":t.WS_Form.this.action_data=n.data,t.WS_Form.this.action_render_from_data();break;case"conditional":t.WS_Form.this.conditional_data=n.data,t.WS_Form.this.conditional_render_from_data()}},t.WS_Form.prototype.data_grid_row_clone=function(e,i,a){var o=this.get_object_type(e);for(var s in this.object_meta_cache){var r=this.object_meta_cache[s].meta_key;this.object_data_update_by_meta_key(o,this.object_data_scratch,r)}var n=e.closest("tr"),d=n.closest(".wsf-data-grid-group"),_=d.attr("data-group-index"),l=a.groups[_];t(".wsf-hidden-table-row",d).remove();var c=0==f?0:l.page,f=a.rows_per_page,h=c*f+n.index(),u=t.extend(!0,{},l.rows[h]);u.id=t.WS_Form.this.data_grid_row_next_id(a),u.data[0]=u.data[0]+" (Copy)",l.rows.splice(h+1,0,u);var m=[];h=1;for(var p in l.rows)m.push(l.rows[p]);l.rows=m,i.render()},t.WS_Form.prototype.data_grid_row_next_id=function(t){var e=0,i=t.groups;for(var a in i){var o=i[a].rows;for(var s in o){var r=o[s];void 0===r.id&&this.error("error_data_grid_row_id");var n=parseInt(r.id);n>e&&(e=n)}}return++e},t.WS_Form.prototype.data_grid_upload_csv=function(e,i,a,o,s,r){if(t("h1",s).hide(),0==o.length)return"function"==typeof r&&r(),!1;var n=new FormData;n.append("id",this.form_id),n.append("file",o[0]),n.append("meta_key",a),n.append(ws_form_settings.wsf_nonce_field_name,ws_form_settings.wsf_nonce);var d=new this.upload_status_bar(s);d.populate(o[0].name,o[0].size),this.data_grid_upload_csv_ajax(e,i,n,d,s,function(o){t.WS_Form.this.data_grid_upload_csv_complete(e,i,a,o.data,s)})},t.WS_Form.prototype.data_grid_upload_csv_complete=function(e,i,a,o,s){t.WS_Form.this.object_data_scratch.meta[a]=o,t.WS_Form.this.data_grid_update_mask_row_lookups(e,i,a,!0),s.closest(".wsf-data-grid")[0].render()},t.WS_Form.prototype.data_grid_download_csv=function(e,i,a,o,s){if(void 0===s)s=!0;if(s){var r=t.WS_Form.this.get_object_data(e,i,!0);!1===r&&t.WS_Form.this.error("error_object_data");var n=t.WS_Form.this.get_object_meta_value(r,a,!1);!1===n&&t.WS_Form.this.error("error_object_meta_value");var d=encodeURIComponent(JSON.stringify(n))}var _='<form id="wsf-data-grid-downloader" action="'+ws_form_settings.url+e+"/"+i+'/download/csv" method="post">';_+='<input type="hidden" name="form_id" value="'+t.WS_Form.this.form_id+'" />',_+='<input type="hidden" name="meta_key" value="'+a+'" />',_+='<input type="hidden" name="group_index" value="'+o+'" />',_+='<input type="hidden" name="_wpnonce" value="'+ws_form_settings.x_wp_nonce+'" />',_+='<input type="hidden" name="'+ws_form_settings.wsf_nonce_field_name+'" value="'+ws_form_settings.wsf_nonce+'" />',s&&(_+='<input type="hidden" name="meta_value" value="'+d+'" />'),_+="</form>";t("body").append(_);t("#wsf-data-grid-downloader").submit(),t("#wsf-data-grid-downloader").remove()},t.WS_Form.prototype.object_to_csv=function(t){var e=new Array;for(var i in t){var a=t[i];-1!=a.indexOf(",")&&(a='"'+(a=this.replace_all(a,/"/g,'""'))+'"'),e.push(a)}return e.join(",")+"\r\n"},t.WS_Form.prototype.data_grid_upload_csv_ajax=function(e,i,a,o,s,r){var n=t.ajax({beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ws_form_settings.x_wp_nonce)},xhr:function(){var e=t.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(t){var e=0,i=t.loaded||t.position,a=t.total;t.lengthComputable&&(e=Math.ceil(i/a*100)),o.set_progress(e)},!1),e},url:ws_form_settings.url+e+"/"+i+"/upload/csv",type:"POST",contentType:!1,processData:!1,cache:!1,data:a,statusCode:{200:function(t){o.set_progress(100),"function"==typeof r&&r(t)},400:function(e){var i=e.responseJSON;i.error&&(i.error_message?t.WS_Form.this.error("error_bad_request_message",i.error_message):t.WS_Form.this.error("error_bad_request")),s.fadeOut(200)},403:function(e){t.WS_Form.this.error("error_forbidden",url),s.fadeOut(200)},404:function(e){t.WS_Form.this.error("error_not_found",url),s.fadeOut(200)},500:function(e){t.WS_Form.this.error("error_server",url),s.fadeOut(200)}}});o.set_abort(n)},t.WS_Form.prototype.upload_status_bar=function(e,i,a,o){if(void 0===i)i=!0;if(void 0===a)a=!0;if(void 0===o)o=!0;this.status_bar=t('<div class="wsf-upload-status-bar"></div>'),this.progress_bar=t('<div class="wsf-upload-status-bar-progress"><div></div></div>').appendTo(this.status_bar),this.file_name=!!i&&t('<div class="wsf-upload-status-bar-file-name"></div>').appendTo(this.status_bar),this.file_size=!!a&&t('<div class="wsf-upload-status-bar-file-size"></div>').appendTo(this.status_bar),this.abort=!!o&&t('<div class="wsf-upload-status-bar-abort">Abort</div>').appendTo(this.status_bar),t(".wsf-uploads",e).append(this.status_bar),this.set_progress=function(t){var e=t*this.progress_bar.width()/100;this.progress_bar.find("div").animate({width:e},10).html("<span>"+t+"%</span>"),!1!==this.abort&&parseInt(t)>=100&&this.abort.hide()},this.populate=function(t,e){if(!1!==this.file_name&&this.file_name.html(t),!1!==this.file_size){var i="",a=e/1024;if(parseInt(a)>1024)i=(a/1024).toFixed(2)+" MB";else i=a.toFixed(2)+" KB";this.file_size.html(i)}},this.set_abort=function(t){if(!1!==this.abort){var e=this.status_bar;this.abort.click(function(){t.abort(),e.hide()})}}},t.WS_Form.prototype.data_grid_update_mask_row_lookups=function(e,i,a,o){if("field"!==e)return!1;if(void 0===o);var s=t.WS_Form.this.get_object_data(e,i,!0);!1===s&&t.WS_Form.this.error("error_object_data"),!1===(h=t.WS_Form.this.get_object_meta_value(s,a,!1))&&t.WS_Form.this.error("error_object_meta_value");var r=h.columns,n=s.type,d=t.WS_Form.field_type_cache[n];if(void 0!==d.mask_row_lookups){var _=d.mask_row_lookups;for(var l in _.push("wsf-data-grid-auto-group"),_){var c=_[l],f="wsf-data-grid-auto-group"==c,h=f?"":this.get_object_meta_value(s,c,0),u=t("#wsf-sidebar-"+e+" ["+(f?"data-action":"data-meta-key")+'="'+c+'"]');u.empty();var m=[],p=!1;for(var v in r){var b=r[v];parseInt(b.id)==parseInt(h)&&(p=!0),m.push({value:b.id,text:b.label})}p&&!o||(this.set_object_meta_value(s,c,0),h=0),m.sort(function(t,e){return t.text<e.text?-1:t.text>e.text?1:0});var g=f?'<option value="">'+this.language("data_grid_group_auto_group_select")+"</option>\n":"";for(var w in m){var S=m[w].value;g+='<option value="'+S+'"'+(f?"":parseInt(S)==parseInt(h)?" selected":"")+">"+m[w].text+"</option>\n"}u.html(g)}}},t.WS_Form.prototype.data_grid_bulk_action_button=function(e,i,a,o,s,r){if(void 0===s)s=!1;if(void 0===r)r=!1;var n=e.closest(".wsf-sidebar").find('[data-meta-key="multiple"]').length,d=e.closest(".wsf-sidebar").find('[data-meta-key="multiple"]:checked').length;t(".wsf-data-grid-group",e).each(function(){if(!d&&s){var e=t.WS_Form.this.get_object_data(i,a,!0);!1===e&&t.WS_Form.this.error("error_object_data");var _=t.WS_Form.this.get_object_meta_value(e,o,!1);!1===_&&t.WS_Form.this.error("error_object_meta_value");var l=t(this).attr("data-group-index"),c=_.groups[l].rows,f=0;for(var h in c)if(""!=c[h].default&&f++,f>1)break;if(f>0){f=0;for(var h in c)""!=c[h].default&&++f>1&&(c[h].default="");!1!==r&&r.render()}}var u=t('[data-action="wsf-data-grid-row-select"]:checked',t(this)),m=t('[data-action="wsf-data-grid-bulk-action"]',t(this)),p=m.siblings("select");m.attr("disabled",0==u.length),p.attr("disabled",0==u.length),n&&!d&&u.length>1?t('option[value="default"]',p).attr("disabled",""):t('option[value="default"]',p).removeAttr("disabled")})},t.WS_Form.prototype.data_grid_group_page_set=function(e,i,a,o,s,r,n){e.page=a;var d=t.WS_Form.this.get_object_data(o,s);!1===d&&t.WS_Form.this.error("error_object_data");var _=t.WS_Form.this.get_object_meta_value(d,r,!1);if(!1!==_&&void 0!==_.groups[i]){t.WS_Form.this.loader_on(),_.groups[i].page=a;var l={};l.form_id=t.WS_Form.this.form_id,l[o]=d,l[o].history_suppress="on",t.WS_Form.this.api_call(o+"/"+s,"PUT",l,function(e){t.WS_Form.this.loader_off()})}void 0!==n&&n()},t.WS_Form.prototype.data_grid_group_rows_per_page_set=function(e,i,a,o,s,r){e.rows_per_page=i;var n=t.WS_Form.this.get_object_data(a,o);!1===n&&t.WS_Form.this.error("error_object_data");var d=t.WS_Form.this.get_object_meta_value(n,s,!1);for(var _ in!1===d&&t.WS_Form.this.error("error_object_meta_value"),t.WS_Form.this.loader_on(),d.rows_per_page=i,e.groups)e.groups[_].page=0;for(var _ in d.groups)d.groups[_].page=0;var l={};l.form_id=t.WS_Form.this.form_id,l[a]=n,l[a].history_suppress="on",void 0!==r&&r(),t.WS_Form.this.api_call(a+"/"+o,"PUT",l,function(e){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.sidebar_html_editor_init=function(e){"undefined"!=typeof wp&&void 0!==wp.codeEditor?(t(".CodeMirror",e).remove(),t('.wsf-sidebar-tabs-panel:visible [data-html-editor="true"], [id^=wsf-action] [data-html-editor="true"], .wsf-html-editor [data-html-editor="true"]',e).each(function(){wp.codeEditor.initialize(t(this).attr("id"))}),t(".CodeMirror").each(function(){t(this)[0].CodeMirror.on("keyup",function(e){var i=e.getValue(),a=e.getTextArea();t(a).val(i).trigger("keyup")})})):t(document).delegate('[data-html-editor="true"]',"keydown",function(e){if(9==(e.keyCode||e.which)){e.preventDefault();var i=this.selectionStart,a=this.selectionEnd;t(this).val(t(this).val().substring(0,i)+"\t"+t(this).val().substring(a)),this.selectionStart=this.selectionEnd=i+1}})},t.WS_Form.prototype.conditional_init=function(e){for(var i in this.conditional.if){var a=this.conditional.if[i];if(void 0!==a.conditions)for(var o in a.conditions){var s=a.conditions[o],r=s.id,n=t('.wsf-conditional-condition[data-id="'+r+'"]');this.conditional_condition(n,s,r)}}this.conditional_thenelse_init("then"),this.conditional_thenelse_init("else"),t('[data-action="wsf-conditional-condition-add"]',e).click(function(){var e=t(this).attr("data-id");t.WS_Form.this.conditional.if[e].conditions.push(t.WS_Form.this.conditional_condition_new()),t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()}),t('[data-action="wsf-conditional-group-add"]',e).click(function(){t.WS_Form.this.conditional.if.push(t.WS_Form.this.conditional_group_new()),t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()}),t('.wsf-conditional-group [data-attribute="logic_previous"]',e).change(function(){var e=parseInt(t(this).closest(".wsf-conditional-group").attr("data-id"));t.WS_Form.this.conditional.if[e].logic_previous=t(this).val(),t.WS_Form.this.conditional_save()}),t('[data-action="wsf-conditional-group-delete"]',e).click(function(){var e=parseInt(t(this).closest(".wsf-conditional-group").attr("data-id"));delete t.WS_Form.this.conditional.if[e],t.WS_Form.this.conditional.if=t.grep(t.WS_Form.this.conditional.if,function(t){return 0==t||t}),t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()}),t('[data-action="wsf-conditional-then-add"]',e).click(function(){t.WS_Form.this.conditional_thenelse_add("then")}),t('[data-action="wsf-conditional-else-add"]',e).click(function(){t.WS_Form.this.conditional_thenelse_add("else")}),t(".wsf-conditional-if > ul",e).sortable({items:"li.wsf-conditional-group",cursor:"move",containment:"parent",handle:'[data-action="wsf-group-sort"]',axis:"y",sort:function(e,i){var a=t(this),o=a.children(".ui-sortable-placeholder:first"),s=i.helper.outerHeight(),r=i.position.top,n=r+s;a.children().each(function(){var e=t(this);if(!e.hasClass("ui-sortable-helper")&&!e.hasClass("ui-sortable-placeholder")){var i=e.outerHeight(),d=e.position().top,_=d+i;if(r>d&&r<_){var l=Math.min(s,i)/2;if(r-d<l)return o.insertBefore(e),a.sortable("refreshPositions"),!1}else if(n<_&&n>d){l=Math.min(s,i)/2;if(_-n<l)return o.insertAfter(e),a.sortable("refreshPositions"),!1}}})},start:function(e,i){var a=i.placeholder,o=["height: "+i.helper.height()+"px","width: "+i.helper.width()+"px"].join(";");a.attr("style",o),t.WS_Form.conditional_group_index_old=i.helper.index()},stop:function(e,i){var a=t.WS_Form.conditional_group_index_old,o=i.item.index();if(a==o)return!0;var s=t.WS_Form.this.conditional.if;if(o>=s.length)for(var r=o-s.length;1+r--;)s.push(void 0);s.splice(o,0,s.splice(a,1)[0]),t.WS_Form.this.conditional_save()}}),t(".wsf-conditional-group > ul",e).sortable({items:"li.wsf-conditional-condition",cursor:"move",containment:"parent",handle:'[data-action="wsf-conditional-condition-sort"]',axis:"y",connectWith:".wsf-conditional-group > ul",sort:function(e,i){var a=t(this),o=a.children(".ui-sortable-placeholder:first"),s=i.helper.outerHeight(),r=i.position.top,n=r+s;a.children().each(function(){var e=t(this);if(!e.hasClass("ui-sortable-helper")&&!e.hasClass("ui-sortable-placeholder")){var i=e.outerHeight(),d=e.position().top,_=d+i;if(r>d&&r<_){var l=Math.min(s,i)/2;if(r-d<l)return o.insertBefore(e),a.sortable("refreshPositions"),!1}else if(n<_&&n>d){l=Math.min(s,i)/2;if(_-n<l)return o.insertAfter(e),a.sortable("refreshPositions"),!1}}})},start:function(e,i){var a=i.placeholder,o=["height: "+i.helper.height()+"px","width: "+i.helper.width()+"px"].join(";");a.attr("style",o),t.WS_Form.conditional_group_index_old=parseInt(t(this).closest(".wsf-conditional-group").attr("data-id")),t.WS_Form.conditional_condition_index_old=i.helper.index()},stop:function(e,i){var a=t.WS_Form.conditional_group_index_old,o=parseInt(i.item.closest(".wsf-conditional-group").attr("data-id")),s=t.WS_Form.conditional_condition_index_old,r=i.item.index();if(a==o&&s==r)return!0;var n=t.extend(!0,{},t.WS_Form.this.conditional.if[a].conditions[s]);delete t.WS_Form.this.conditional.if[a].conditions[s],t.WS_Form.this.conditional.if[a].conditions=t.grep(t.WS_Form.this.conditional.if[a].conditions,function(t){return 0==t||t}),t.WS_Form.this.conditional.if[o].conditions.splice(r,0,n),t.WS_Form.this.conditional_save()}}),this.conditional_thenelse_sortable("then",e),this.conditional_thenelse_sortable("else",e)},t.WS_Form.prototype.conditional_render_from_data=function(){try{this.conditional=JSON.parse(this.conditional_data[1])}catch(t){this.conditional=this.conditional_new()}void 0===this.conditional.if&&this.error("error_conditional_if"),void 0===this.conditional.then&&this.error("error_conditional_then"),void 0===this.conditional.else&&this.error("error_conditional_else"),this.conditional_render()},t.WS_Form.prototype.conditional_new=function(){var t={if:[],then:[],else:[]};return t.if.push(this.conditional_group_new()),t},t.WS_Form.prototype.conditional_render=function(){var e=t("#wsf-conditional-tr > td > div");e.show();var i=this.conditional_html();e.html(i),this.conditional_init(e)},t.WS_Form.prototype.conditional_html=function(){var e=t.WS_Form.settings_form.conditional.logic_previous;void 0===t.WS_Form.settings_form.conditional&&this.error("error_conditional_settings");var i="<ul>";i+='<li class="wsf-conditional-if">',i+='<div class="wsf-conditional-title"><h3>'+this.language("conditional_if")+"</h3></div>",i+="<ul>";for(var a in this.conditional.if){var o=this.conditional.if[a];if(void 0!==o.logic_previous){for(var s in i+='<li class="wsf-conditional-group" data-id="'+a+'">',i+='<div class="wsf-conditional-group-logic-previous" data-id="'+a+'">',i+='<select data-attribute="logic_previous" class="wsf-field wsf-field-small">',e){var r=e[s];i+='<option value="'+s+'"'+(s==o.logic_previous?' selected="selected"':"")+">"+this.html_encode(r.text)+"</option>"}if(i+="</select>",i+="</div>",void 0!==o.conditions){for(var n in i+="<ul>",o.conditions){var d=o.conditions[n],_=d.id;this.object_cache.condition[_]=d,void 0!==d.object?void 0!==d.object_id?void 0!==d.logic?void 0!==d.logic_previous?i+='<li class="wsf-conditional-condition" data-id="'+_+'"></li>':this.error("error_conditional_logic_previous"):this.error("error_conditional_logic"):this.error("error_conditional_object_id"):this.error("error_conditional_object")}i+='<li data-action="wsf-group-sort" title="'+this.language("conditional_group_sort")+'">'+this.svg("sort")+"</li>",i+='<li data-action="wsf-conditional-group-delete" title="'+this.language("conditional_group_delete")+'" data-id="'+a+'">'+this.svg("minus-circle")+"</li>",i+='<li data-action="wsf-conditional-condition-add" title="'+this.language("conditional_condition_add")+'" data-id="'+a+'">'+this.svg("plus-circle")+"</li>",i+="</ul>",i+="</li>"}}else this.error("error_conditional_logic_previous_group")}return i+='<li data-action="wsf-conditional-group-add" title="'+this.language("conditional_group_add")+'" data-id="'+a+'">'+this.svg("plus-circle")+"</li>",i+="</ul>",i+="</li>",i+=this.conditional_thenelse_html_base("then"),i+=this.conditional_thenelse_html_base("else"),i+="</ul>"},t.WS_Form.prototype.conditional_save=function(){if(!t("#wsf-conditional-tr").length)return!1;this.conditional_data[1]=JSON.stringify(this.conditional)},t.WS_Form.prototype.conditional_group_new=function(){return{conditions:[this.conditional_condition_new()],logic_previous:"||"}},t.WS_Form.prototype.conditional_condition=function(e,i,a){var o=this.conditional_condition_html(e,i);o+='<li data-action="wsf-conditional-condition-delete" title="'+this.language("conditional_condition_delete")+'">'+this.svg("minus-circle")+"</li>",o+="</ul>",e.html(o),this.conditional_objects_events("condition",e,i,a),this.conditional_object_rows_events("condition",e,i,a),this.conditional_value_events("condition",e,i,a),this.conditional_case_sensitive_events("condition",e,i,a),t('[data-attribute="logic"]',e).change(function(){var i=e.attr("data-id"),a=t.WS_Form.this.object_cache.condition[i];a.logic=t(this).val(),a.value="",t.WS_Form.this.conditional_condition(e,a,i),t.WS_Form.this.conditional_save()}),t('[data-attribute="condition_logic_previous"]',e).change(function(){var i=e.attr("data-id");t.WS_Form.this.object_cache.condition[i].logic_previous=t(this).val(),t.WS_Form.this.conditional_save()}),t('[data-action="wsf-conditional-condition-delete"]',e).click(function(){var e=parseInt(t(this).closest(".wsf-conditional-condition").attr("data-id"));for(var i in t.WS_Form.this.conditional.if){var a=t.WS_Form.this.conditional.if[i];if(void 0!==a.conditions)for(var o in a.conditions){e==a.conditions[o].id&&(delete a.conditions[o],a.conditions=t.grep(a.conditions,function(t){return 0==t||t}))}}t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()})},t.WS_Form.prototype.conditional_condition_html=function(t,e){var i=e.object,a=e.object_id,o=void 0!==e.object_row_id&&e.object_row_id,s=e.logic,r=e.logic_previous,n=void 0!==e.value&&e.value,d=void 0!==e.case_sensitive&&e.case_sensitive,_=this.conditional_logic_previous_html("condition",r);_+=this.conditional_sort_html("condition");var l=this.conditional_objects_html("condition",i,a);if(_+=l.html,!l.found)return _;var c=this.conditional_logic_html("condition",i,a,s);_+=c.html;var f=c.logic_key_found;if(!f)return _;if(c.rows){var h=this.conditional_object_rows_html("condition",i,a,o);if(h.has_data_grid_fields&&(_+=h.html,!h.found))return _}return _+=this.conditional_value_html("condition",f,i,a,n,d)},t.WS_Form.prototype.conditional_condition_new=function(){return{id:this.conditional_condition_id_next(),object:"",object_id:"",object_row_id:"",logic:"",value:"",case_sensitive:!0,logic_previous:"||"}},t.WS_Form.prototype.conditional_condition_id_next=function(){var t=0;for(var e in this.conditional.if){var i=this.conditional.if[e].conditions;for(var a in i){var o=i[a];o.id>t&&(t=o.id)}}return++t},t.WS_Form.prototype.conditional_thenelse=function(e,i,a,o){var s=this.conditional_thenelse_html(e,i,a);s+='<li data-action="wsf-conditional-'+e+'-delete" title="'+this.language("conditional_"+e+"_delete")+'">'+this.svg("minus-circle")+"</li>",s+="</ul>",i.html(s),this.conditional_objects_events(e,i,a,o),this.conditional_object_rows_events(e,i,a,o),this.conditional_value_events(e,i,a,o),t('[data-attribute="object_action"]',i).change(function(){var s=i.attr("data-id"),r=t.WS_Form.this.object_cache[e][s],n=r.action,d=t(this).val();r.action=d,r.object_row_id="",r.value="","then"==e&&""!=d&&""==n&&t.WS_Form.this.conditional_then_auto_else(r),t.WS_Form.this.conditional_thenelse(e,i,a,o),t.WS_Form.this.conditional_save()}),t('[data-action="wsf-conditional-'+e+'-delete"]',i).click(function(){t.WS_Form.this.conditional_thenelse_delete(e,t(this))})},t.WS_Form.prototype.conditional_then_auto_else=function(e,i){void 0===i&&(i=!1);var a=t.WS_Form.settings_form.conditional.objects[e.object].action[e.action];if(void 0===a.auto_else)return!1;var o=a.auto_else,s=!1;for(var r in t.WS_Form.this.conditional.else){var n;s|=(n=t.WS_Form.this.conditional.else[r]).object==e.object&&n.object_id==e.object_id&&n.action==o}if(i&&!s)return!1;s||((n=t.WS_Form.this.conditional_thenelse_new("else")).object=e.object,n.object_id=e.object_id,n.action=o);if("object"==typeof a.values&&!i)for(var d in a.values){var _=a.values[d];_.value==e.value&&void 0!==_.auto_else&&(n.value=_.auto_else)}!0===a.values&&s&&i&&(n.value=e.value,t('.wsf-conditional-else[data-id="'+n.id+'"] [data-attribute="value"]').val(n.value));s||t.WS_Form.this.conditional.else.push(n),i||t.WS_Form.this.conditional_render()},t.WS_Form.prototype.conditional_thenelse_html_base=function(t){var e='<li class="wsf-conditional-'+t+'-wrapper">';for(var i in e+='<div class="wsf-conditional-title"><h3>'+this.language("conditional_"+t)+"</h3></div>",e+="<ul>",this.conditional[t]){var a=this.conditional[t][i],o=a.id;this.object_cache[t][o]=a,e+='<li class="wsf-conditional-'+t+'" data-id="'+o+'"></li>'}return e+='<li data-action="wsf-conditional-'+t+'-add" title="'+this.language("conditional_"+t+"_add")+'">'+this.svg("plus-circle")+"</li>",e+="</ul>",e+="</li>"},t.WS_Form.prototype.conditional_thenelse_html=function(t,e,i){var a=i.object,o=i.object_id,s=void 0!==i.object_row_id&&i.object_row_id,r=i.action,n=i.value,d='<ul class="wsf-list-inline">';d+=this.conditional_sort_html(t);var _=this.conditional_objects_html(t,a,o,!0);if(d+=_.html,!_.found)return d;var l=this.conditional_actions_html(t,a,o,r);d+=l.html;var c=l.found;if(!c)return d;if(l.value_row_ids){var f=this.conditional_object_rows_html(t,a,o,s);if(f.has_data_grid_fields&&(d+=f.html,!f.found))return d}return d+=this.conditional_value_html(t,c,a,o,n)},t.WS_Form.prototype.conditional_thenelse_init=function(e){for(var i in this.conditional[e]){var a=this.conditional[e][i],o=a.id,s=t(".wsf-conditional-"+e+'[data-id="'+o+'"]');this.conditional_thenelse(e,s,a,o)}},t.WS_Form.prototype.conditional_thenelse_add=function(e){var i=t.WS_Form.this.conditional_thenelse_new(e);this.conditional[e].push(i),t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()},t.WS_Form.prototype.conditional_thenelse_delete=function(e,i){var a=parseInt(i.closest(".wsf-conditional-"+e).attr("data-id"));for(var o in this.conditional[e]){if(a==this.conditional[e][o].id){delete this.conditional[e][o],this.conditional[e]=t.grep(this.conditional[e],function(t){return 0==t||t});break}}t.WS_Form.this.conditional_render(),t.WS_Form.this.conditional_save()},t.WS_Form.prototype.conditional_thenelse_sortable=function(e,i){t(".wsf-conditional-"+e+"-wrapper > ul",i).sortable({items:"li.wsf-conditional-"+e,cursor:"move",containment:"parent",tolerance:"pointer",handle:'[data-action="wsf-conditional-'+e+'-sort"]',axis:"y",sort:function(e,i){var a=t(this),o=a.children(".ui-sortable-placeholder:first"),s=i.helper.outerHeight(),r=i.position.top,n=r+s;a.children().each(function(){var e=t(this);if(!e.hasClass("ui-sortable-helper")&&!e.hasClass("ui-sortable-placeholder")){var i=e.outerHeight(),d=e.position().top,_=d+i;if(r>d&&r<_){var l=Math.min(s,i)/2;if(r-d<l)return o.insertBefore(e),a.sortable("refreshPositions"),!1}else if(n<_&&n>d){l=Math.min(s,i)/2;if(_-n<l)return o.insertAfter(e),a.sortable("refreshPositions"),!1}}})},start:function(e,i){t.WS_Form.conditional_index_dragged_from=i.helper.index()},stop:function(i,a){var o=t.WS_Form.conditional_index_dragged_from,s=a.item.index();if(o==s)return!0;if(s>=t.WS_Form.this.conditional[e].length)for(var r=s-t.WS_Form.this.conditional[e].length;1+r--;)t.WS_Form.this.conditional[e].push(void 0);t.WS_Form.this.conditional[e].splice(s,0,t.WS_Form.this.conditional[e].splice(o,1)[0]),t.WS_Form.this.conditional_save()}})},t.WS_Form.prototype.conditional_thenelse_new=function(t){return{id:this.conditional_thenelse_id_next(t),object:"",object_id:"",object_row_id:"",action:"",value:""}},t.WS_Form.prototype.conditional_thenelse_id_next=function(t){var e=0;for(var i in this.conditional[t]){var a=this.conditional[t][i];a.id>e&&(e=a.id)}return++e},t.WS_Form.prototype.conditional_logic_previous_html=function(e,i){var a=t.WS_Form.settings_form.conditional.logic_previous,o='<div class="wsf-conditional-logic"><select data-attribute="condition_logic_previous" class="wsf-field wsf-field-small">';for(var s in a){var r=a[s];o+='<option value="'+s+'"'+(s==i?' selected="selected"':"")+">"+this.html_encode(r.text)+"</option>"}return o+="</select></div>",o+='<ul class="wsf-list-inline">'},t.WS_Form.prototype.conditional_sort_html=function(t){return'<li data-action="wsf-conditional-'+t+'-sort" title="'+this.language("conditional_"+t+"_sort")+'">'+this.svg("sort")+"</li>"},t.WS_Form.prototype.conditional_objects_html=function(t,e,i,a){if(void 0===a)a=!1;var o=[];o.push({optgroup:this.conditional_options_groups(t),value:this.form_id,text:this.language("form"),object:"form",disabled:!1}),a&&(o=this.conditional_options_actions(o));var s='<li><select data-attribute="object_id" class="wsf-field wsf-field-small">';s+='<option value="">'+this.language("conditional_"+t+"_select")+"</option>";var r=this.conditional_options(e,i,o,t);return s+=r.html,s+="</select></li>",{found:r.found,html:s}},t.WS_Form.prototype.conditional_options_actions=function(t){var e=this.get_object_meta_value(this.form,"action",!1);if(!1===e||void 0===e.groups||void 0===e.groups[0]||"object"!=typeof e.groups[0].rows||0==e.groups[0].rows.length)return t;var i=e.groups[0].rows;for(var a in i){var o=i[a];t.push({value:o.id,text:"- "+this.language("action")+": "+o.data[0],object:"action"})}return t},t.WS_Form.prototype.conditional_object_rows_html=function(e,i,a,o){var s=!1,r=!1,n="",d=!1;switch(i){case"field":d=this.field_data_cache[a]}if(!1!==d){var _=t.WS_Form.field_type_cache[d.type];if(void 0!==_.conditional&&void 0!==_.conditional.data_grid_fields){s=!0;var l=_.conditional.data_grid_fields,c=_.conditional.option_text,f=this.get_object_meta_value(d,l,!1);!1===f&&this.error("error_conditional_data_grid");var h=parseInt(this.get_object_meta_value(d,c,!1)),u=this.get_object_meta_value(d,"placeholder_row","");n+='<li><select data-attribute="object_row_id" class="wsf-field wsf-field-small">',n+='<option value="">'+this.language("conditional_condition_select_row")+"</option>",""!=u&&(n+='<option value="0"'+(0==parseInt(o)?' selected="selected"':"")+">["+this.language("conditional_condition_select_placeholder")+": "+u+"]</option>");var m=f.groups;for(var p in m){var v=m[p],b=void 0!==v.mask_group&&"on"==v.mask_group;b&&(n+='<optgroup label="'+this.html_encode(v.label)+'">');var g=v.rows;for(var w in g){var S=g[w],W=(c=S.data[h],""!=o&&parseInt(S.id)===parseInt(o));r|=W,n+='<option value="'+S.id+'"'+(W?' selected="selected"':"")+">"+this.html_encode(c)+"</option>"}b&&(n+="</optgroup>")}n+="</select></li>"}}return{has_data_grid_fields:s,found:r,html:n}},t.WS_Form.prototype.conditional_actions_html=function(e,i,a,o){var s=t.WS_Form.settings_form.conditional.objects,r=t.extend(!0,[],s[i].action),n=!1,d=!1,_=!1;switch(i){case"field":_=this.field_data_cache[a]}if(!1!==_){var l=t.WS_Form.field_type_cache[_.type],c=""!==this.get_object_meta_value(_,"data_source_id","");if(void 0!==l.conditional){if(void 0!==l.conditional.actions_enabled){var f=l.conditional.actions_enabled;r=[];for(var h in f){var u=f[h];void 0!==s[i].action[u]&&(r[u]=s[i].action[u])}}if(void 0!==l.conditional.actions_disabled){var m=l.conditional.actions_disabled;for(var h in m){var p=m[h];void 0!==r[p]&&delete r[p]}}}}var v='<li><select data-attribute="object_action" class="wsf-field wsf-field-small">';for(var b in v+='<option value="">'+this.language("conditional_"+e+"_select_action")+"</option>",r){var g=r[b];v+='<option value="'+b+'"'+(b==o?' selected="selected"':"")+(void 0!==g.data_source_exclude&&g.data_source_exclude&&c?' disabled="disabled"':"")+">"+this.html_encode(g.text)+"</option>",b==o&&(n=b,d|=void 0!==g.value_row_ids&&g.value_row_ids)}return{found:n,value_row_ids:d,html:v+="</select></li>"}},t.WS_Form.prototype.conditional_logic_html=function(e,i,a,o){var s=t.WS_Form.settings_form.conditional,r=(s.logic_previous,s.objects),n=t.extend(!0,[],r[i].logic),d=!1,_=!1,l=!1;switch(i){case"field":l=this.field_data_cache[a]}if(!1!==l){var c=t.WS_Form.field_type_cache[l.type],f=""!==this.get_object_meta_value(l,"data_source_id","");if(void 0!==c.conditional){if(void 0!==c.conditional.logics_enabled){var h=c.conditional.logics_enabled;n=[];for(var u in h){var m=h[u];void 0!==r[i].logic[m]&&(n[m]=r[i].logic[m])}}if(void 0!==c.conditional.logics_disabled){var p=c.conditional.logics_disabled;for(var u in p){var v=p[u];void 0!==n[v]&&delete n[v]}}}}var b='<li><select data-attribute="logic" class="wsf-field wsf-field-small">';for(var g in b+='<option value="">'+this.language("conditional_condition_select_logic")+"</option>",n){var w=n[g];b+='<option value="'+g+'"'+(g==o?' selected="selected"':"")+(void 0!==w.data_source_exclude&&w.data_source_exclude&&f?' disabled="disabled"':"")+">"+this.html_encode(w.text)+"</option>",g==o&&(d=g,_=void 0!==w.rows&&w.rows)}return{logic_key_found:d,html:b+="</select></li>",rows:_}},t.WS_Form.prototype.conditional_value_html=function(e,i,a,o,s,r){var n=t.WS_Form.settings_form.conditional.objects,d=t.extend(!0,[],n[a].logic),_=t.extend(!0,[],n[a].action),l="";switch(e){case"condition":var c=void 0===(f=d[i]).case_sensitive||f.case_sensitive;break;case"then":case"else":var f=_[i];c=!1}var h=void 0===f.values||f.values;if(!0===h){e=void 0===f.type?"text":f.type;var u=void 0!==f.min&&f.min,m=void 0!==f.max&&f.max,p=void 0===f.unit?"":f.unit;if("datetime"==e){var v=!1;switch(a){case"field":v=this.field_data_cache[o],e=this.get_object_meta_value(v,"input_type_datetime","datetime-local")}}switch(e){case"textarea":l='<li><textarea data-attribute="value" class="wsf-field wsf-field-small">'+this.html_encode(s)+"</textarea></li>";break;case"text_editor":l='<li class="wsf-text-editor"><textarea id="wsf-text-editor-'+this.text_editor_index+'" data-attribute="value" data-text-editor="true" class="wsf-field wsf-field-small">'+this.html_encode(s)+"</textarea></li>",this.text_editor_index++;break;case"html_editor":l='<li class="wsf-html-editor"><textarea id="wsf-html-editor-'+this.code_editor_index+'" data-attribute="value" data-html-editor="true" class="wsf-field wsf-field-small">'+this.html_encode(s)+"</textarea></li>",this.code_editor_index++;break;default:"advanced"==t.WS_Form.settings_plugin.mode&&(e="text"),l='<li><input type="'+e+'" data-attribute="value" class="wsf-field wsf-field-small" value="'+this.html_encode(s)+'"'+(!1===u?"":' min="'+u+'"')+(!1===m?"":' max="'+m+'"')+' /><span class="wsf-field-unit">'+p+"</span></li>"}if(c){var b="wsf-case-sensitive-"+e+"-"+o;l+='<li><input id="'+b+'" type="checkbox" data-attribute="case_sensitive" class="wsf-field" value="on"'+(r?' checked="checked"':"")+' /><label for="'+b+'" class="wsf-label">'+this.language("conditional_case_sensitive")+"</label></li>"}}if("fields"===h){var g=this.conditional_options_groups("field");l='<li><select data-attribute="value" class="wsf-field wsf-field-small">';l+='<option value="">'+this.language("conditional_field_select")+"</option>",l+=this.conditional_options("field",s,g,e).html,l+="</select></li>"}if("object"==typeof h){for(var w in l='<li><select data-attribute="value" class="wsf-field wsf-field-small">',h){var S=h[w];l+='<option value="'+S.value+'"'+(S.value==s?' selected="selected"':"")+">"+this.html_encode(S.text)+"</option>"}l+="</select></li>"}return l},t.WS_Form.prototype.conditional_objects_events=function(e,i,a,o){t('[data-attribute="object_id"]',i).change(function(){var o=i.attr("data-id"),s=t.WS_Form.this.object_cache[e][o];switch(s.object=t(this).find(":selected").attr("data-object"),s.object_id=t(this).val(),s.object_row_id=0,s.value="",e){case"condition":s.logic="",t.WS_Form.this.conditional_condition(i,a,o);break;case"then":case"else":s.action="",t.WS_Form.this.conditional_thenelse(e,i,a,o)}t.WS_Form.this.conditional_save()})},t.WS_Form.prototype.conditional_object_rows_events=function(e,i,a,o){t('[data-attribute="object_row_id"]',i).change(function(){var o=i.attr("data-id"),s=t.WS_Form.this.object_cache[e][o];switch(s.object_row_id=t(this).val(),s.value="",e){case"condition":t.WS_Form.this.conditional_condition(i,a,o);break;case"then":case"else":t.WS_Form.this.conditional_thenelse(e,i,a,o)}t.WS_Form.this.conditional_save()})},t.WS_Form.prototype.conditional_value_events=function(e,i,a,o){t('[data-attribute="value"]',i).keyup(function(){var a=i.attr("data-id"),o=t.WS_Form.this.object_cache[e][a];if(o.value=t(this).val(),"then"==e){var s=t.WS_Form.settings_form.conditional.objects[o.object].action[o.action];void 0!==s.auto_else_copy&&s.auto_else_copy&&t.WS_Form.this.conditional_then_auto_else(o,!0)}}),t('[data-attribute="value"]',i).change(function(){var o=i.attr("data-id"),s=t.WS_Form.this.object_cache[e][o];if(s.value=t(this).val(),"then"==e){var r=t.WS_Form.settings_form.conditional.objects[s.object].action[s.action];void 0!==r.auto_else_copy&&r.auto_else_copy&&t.WS_Form.this.conditional_then_auto_else(s)}switch(e){case"condition":t.WS_Form.this.conditional_condition(i,a,o);break;case"then":case"else":t.WS_Form.this.conditional_thenelse(e,i,a,o)}t.WS_Form.this.conditional_save()}),this.sidebar_tinymce_init(i),this.sidebar_html_editor_init(i)},t.WS_Form.prototype.conditional_case_sensitive_events=function(e,i,a,o){t('[data-attribute="case_sensitive"]',i).change(function(){var o=i.attr("data-id");switch(t.WS_Form.this.object_cache[e][o].case_sensitive=t(this).is(":checked"),e){case"condition":t.WS_Form.this.conditional_condition(i,a,o);break;case"then":case"else":t.WS_Form.this.conditional_thenelse(e,i,a,o)}t.WS_Form.this.conditional_save()})},t.WS_Form.prototype.conditional_options=function(t,e,i,a,o){void 0===o&&(o=1);var s="",r=!1;for(var n in i){var d=i[n],_=d.object==t&&d.value==e,l=void 0!==d["disabled_"+a]&&d["disabled_"+a];if(r|=_,void 0!==d.optgroup){s+='<option value="'+d.value+'" data-object="'+d.object+'"'+(_?' selected="selected"':"")+(l?" disabled":"")+">"+(o>1?Array(o).join("-")+" ":"")+this.html_encode(d.text)+"</option>";var c=this.conditional_options(t,e,d.optgroup,a,o+1);s+=c.html,r|=c.found}else s+='<option value="'+d.value+'" data-object="'+d.object+'"'+(_?' selected="selected"':"")+(l?" disabled":"")+">"+(o>1?Array(o).join("-")+" ":"")+this.html_encode(d.text)+"</option>"}return{html:s,found:r}},t.WS_Form.prototype.conditional_options_groups=function(t){var e=[];for(var i in this.form.groups){var a=this.form.groups[i];e.push({optgroup:this.conditional_options_sections(t,a.sections),value:a.id,text:this.language("group")+": "+a.label,object:"group"})}return e},t.WS_Form.prototype.conditional_options_sections=function(t,e){var i=[];for(var a in e){var o=e[a];i.push({optgroup:this.conditional_options_fields(t,o.fields),value:o.id,text:this.language("section")+": "+o.label+" ("+this.language("id")+": "+o.id+")",object:"section"})}return i},t.WS_Form.prototype.conditional_options_fields=function(e,i){var a=[];for(var o in i){var s=i[o],r=t.WS_Form.field_type_cache[s.type];void 0!==r.conditional&&void 0!==r.conditional["exclude_"+e]&&r.conditional["exclude_"+e]||a.push({value:s.id,text:s.label+" ("+this.language("id")+": "+s.id+")",object:"field"})}return a},t.WS_Form.prototype.action_render_from_data=function(){try{this.action=JSON.parse(this.action_data[1])}catch(t){this.action=this.action_new()}this.action_render()},t.WS_Form.prototype.action_new=function(){return{id:"",meta:{},events:[]}},t.WS_Form.prototype.action_render=function(){var e=t("#wsf-action-tr > td > div"),i=this.action.id;void 0===t.WS_Form.actions[i]&&(this.action=this.action_new(),i="");var a='<fieldset class="wsf-fieldset wsf-fieldset-header" data-action-header="true" data-object="action" data-id="'+i+'">';a+='<div class="wsf-field-wrapper"><label class="wsf-label">'+this.language("data_grid_action_action")+"</label>",a+='<select data-meta-key="action_id" class="wsf-field">',a+='<option value="">'+this.language("options_select")+"</option>";var o=[],s=this.get_object_meta_value(this.object_data_scratch,"action").groups[0].rows;for(var r in s){try{var n=JSON.parse(s[r].data[1])}catch(t){continue}if(void 0!==n.id){var d=n.id;void 0!==t.WS_Form.actions[d]&&void 0!==t.WS_Form.actions[d].multiple&&(t.WS_Form.actions[d].multiple||o.push(d))}}var _=[];for(var l in t.WS_Form.actions)_.push({id:l,action:t.WS_Form.actions[l]});for(var c in _.sort(function(t,e){return t.action.label_action.toLowerCase()<e.action.label_action.toLowerCase()?-1:1}),_){d=(n=_[c]).id;if(-1===o.indexOf(d)||d==i){var f=n.action.label_action;a+='<option value="'+d+'"'+(d==i?' selected="selected"':"")+">"+this.html_encode(f)+"</option>"}}if(a+="</select>",a+="</div>",a+='<div class="wsf-field-wrapper">',""!=i){a+='<label class="wsf-label">'+this.language("data_grid_action_event")+"</label>";var h=t.WS_Form.settings_form.sidebars.action.events;for(var u in h){var m=h[u];a+='<div><input class="wsf-field" type="checkbox" id="wsf_action_event_'+u+'" name="wsf_action_event[]"'+(-1!=t.WS_Form.this.action.events.indexOf(u)?' checked="checked"':"")+' /><label class="wsf-label" for="wsf_action_event_'+u+'">'+this.html_encode(m.label)+"</label></div>"}}if(t.WS_Form.settings_plugin.helper_field_help&&(a+='<div class="wsf-helper">'+this.language("data_grid_action_event_conditional","",!1)+"</div>"),a+="</div>",a+="</fieldset>",e.html(a),""!=i){this.sidebar_cache_clear(e);var p=this.sidebar_html("action",i,this.action,t.WS_Form.actions[i],!1,!0,!0,!1,!1);e.append(p.html),this.sidebar_inits(p.inits,e,e,this.action)}t('[data-meta-key="action_id"]',e).change(function(){var e=t(this).val(),i=t('[data-column="0"]',t(this).closest("tr").prev());if(t.WS_Form.this.action_save(!0),t.WS_Form.this.action_render(),""!=e){var a=t.WS_Form.actions[e];if(void 0!==a.events)for(var o in a.events){var s=a.events[o];t("#wsf_action_event_"+s).prop("checked",!0)}i.val(a.label_action)}else{var r=t.WS_Form.this.language("action_label_default");i.val(r)}i.trigger("keyup"),t.WS_Form.this.action_save(!0)}),t('[data-change="reload"]',e).change(function(){t.WS_Form.this.action_save(),t.WS_Form.this.action_render()}),e.show()},t.WS_Form.prototype.api_reload_init=function(e,i,a,o){t('[data-action="wsf-api-reload"]',e).click(function(){var e=t(this);if(e.addClass("wsf-api-method-calling"),o){var a=e.attr("data-meta-key-for"),s=(_=t('[data-meta-key="'+a+'"]')).attr("data-object"),r=_.attr("data-object-id"),n=t.WS_Form.this.get_object_data(s,r,!0);for(var d in t.WS_Form.this.object_meta_cache){var _=t.WS_Form.this.object_meta_cache[d].meta_key;t.WS_Form.this.object_data_update_by_meta_key(s,n,_)}}var l=e.attr("data-action-id");if(null==l){var c=e.attr("data-action-id-meta-key");null!=c&&(l=t('[data-meta-key="'+c+'"]',t("#wsf-sidebars")).val())}var f=e.attr("data-method"),h=e.attr("data-list-id-meta-key"),u=null!=h&&t('[data-meta-key="'+h+'"]',t("#wsf-sidebars")).val(),m=e.attr("data-list-sub-id-meta-key"),p=null!=m&&t('[data-meta-key="'+m+'"]',t("#wsf-sidebars")).val(),v=t.WS_Form.this.action_api_method_path(l,f,u,p);t.WS_Form.this.options_action_cache_clear(v),t.WS_Form.this.api_call(v,"GET",!1,function(){e.removeClass("wsf-api-method-calling"),i(e,l,f)},function(i){i.error&&t.WS_Form.this.error("error_bad_request_message",i.error_message),e.removeClass("wsf-api-method-calling")},!0)})},t.WS_Form.prototype.options_action_cache_clear=function(e){if(!1===e)return!1;e.endsWith("/fetch/")&&(e=e.substring(0,e.length-6)),t.WS_Form.this.options_action_cache[e]=void 0},t.WS_Form.prototype.action_api_method_path=function(t,e,i,a){if(void 0===t||""==t||null===t)return!1;if(void 0===e||""==e||null===e)return!1;if(void 0===i||""==i||null===i)i=!1;if(void 0===a||""==i||null===i)a=!1;var o="action/"+t+"/";switch(e){case"lists":o+="lists/";break;case"lists_fetch":o+="lists/fetch/";break;case"list":if(!1===i)return!1;o+="list/"+encodeURIComponent(i)+"/";break;case"list_fetch":if(!1===i)return!1;o+="list/"+encodeURIComponent(i)+"/fetch/";break;case"list_subs":if(!1===i)return!1;o+="list/"+encodeURIComponent(i)+"/subs/";break;case"list_subs_fetch":if(!1===i)return!1;o+="list/"+encodeURIComponent(i)+"/subs/fetch/";break;case"list_fields":if(!1===i)return!1;o+=!1===a?"list/"+encodeURIComponent(i)+"/fields/":"list/"+encodeURIComponent(i)+"/subs/"+encodeURIComponent(a)+"/fields/";break;case"list_fields_fetch":if(!1===i)return!1;o+=!1===a?"list/"+encodeURIComponent(i)+"/fields/fetch/":"list/"+encodeURIComponent(i)+"/subs/"+encodeURIComponent(a)+"/fields/fetch/";break;default:o+=e+"/"}return o},t.WS_Form.prototype.action_save=function(e){if(void 0===e)e=!1;if(!1===this.action)return!1;if(!t("#wsf-action-tr").length)return!1;if(this.action.id=t('[data-meta-key="action_id"]').val(),this.action.events=[],this.action.meta={},""!=this.action.id){var i=this.build_meta_data(t.WS_Form.actions[this.action.id],t.WS_Form.meta_keys);for(var a in i)if(void 0!==t.WS_Form.meta_keys[a])if(e){var o=i[a];this.action.meta[a]=o}else this.object_data_update_by_meta_key("action",this.action,a);var s=t.WS_Form.settings_form.sidebars.action.events;for(var r in s){t("#wsf_action_event_"+r).is(":checked")&&this.action.events.push(r)}}this.action_data[1]=JSON.stringify(this.action)},t.WS_Form.prototype.build_meta_data=function(t,e,i){if(void 0===i)i=[];for(var a in t){var o=t[a];if("object"==typeof o)if("meta_keys"===a)for(var s in o){var r=o[s];if(void 0!==e[r]&&(e[r].dummy,!e[r].dummy)){if(void 0!==e[r].default)var n=e[r].default;else n="";n="boolean"==typeof n?n?"on":"":n,void 0!==e[r].key&&(r=e[r].key),i[r]=n}}else i=this.build_meta_data(o,e,i)}return i},t.WS_Form.prototype.sidebar_title=function(t,e,i,a,o,s){if(void 0===i)i="";if(void 0===a)a="";if(void 0===o)o="";if(void 0===s)s=!1;if(s){var r='<div data-action="wsf-sidebar-expand" title="'+this.language("sidebar_expand")+'">'+this.svg("expand")+"</div>";r+='<div data-action="wsf-sidebar-contract" title="'+this.language("sidebar_contract")+'">'+this.svg("contract")+"</div>"}else r="";return'<div class="wsf-sidebar-header"><h2>'+t+e+a+i+o+"</h2>"+r+"</div>"},t.WS_Form.prototype.sidebar_open=function(e){var i=t("#wsf-sidebars").attr("data-current");if(t.WS_Form.this.sidebar_resize_reset(),void 0!==i&&i!=e){var a="sidebar_"+i+"_close";"function"==typeof window[a]&&window[a](t.WS_Form.this),this.sidebar_close(i)}t('[data-action-sidebar="'+e+'"]').addClass("wsf-editing"),!1!==ws_form_settings.sidebar_tab_key&&(t('[data-wsf-tab-key="'+ws_form_settings.sidebar_tab_key+'"]',t("#wsf-sidebar-"+e)).click(),ws_form_settings.sidebar_tab_key=!1),t("#wsf-sidebar-"+e).removeClass("wsf-sidebar-closed").addClass("wsf-sidebar-open"),t("#wsf-sidebars").attr("data-current",e),t(".wsf-sidebar-inner").scrollTop(0),window.matchMedia("(max-width: 600px)").matches&&(t("html").css({overflow:"hidden"}),t("body").css({overflow:"auto","-webkit-overflow-scrolling":"touch"}))},t.WS_Form.prototype.sidebar_close=function(e){t('[data-action-sidebar="'+e+'"]').removeClass("wsf-editing").blur(),t(".wsf-sidebar").addClass("wsf-sidebar-closed").removeClass("wsf-sidebar-open"),window.matchMedia("(max-width: 600px)").matches&&(t("html").css({overflow:""}),t("body").css({overflow:"","-webkit-overflow-scrolling":""}))},t.WS_Form.prototype.sidebar_reset=function(){if(window.matchMedia("(min-width: 851px)").matches){var e=ws_form_settings.sidebar_reset_id;ws_form_settings.sidebar_reset_id="toolbox";var i="sidebar_"+e+"_open";if("function"==typeof window[i]){var a=t("#wsf-sidebar-"+e);t(".wsf-sidebar-inner",a);window[i](this,null,null)}else this.sidebar_open(e)}else{var o=t("#wsf-sidebars").attr("data-current");this.sidebar_close(o)}},t.WS_Form.prototype.sidebars_render=function(){var e=t.WS_Form.settings_form.sidebars;for(var i in e)this.sidebar_render(i);this.sidebar_expand_contract_init()},t.WS_Form.prototype.sidebar_expand_contract_init=function(){t('[data-action="wsf-sidebar-expand"]',t("#wsf-sidebars")).click(function(){t.WS_Form.this.sidebar_expanded_obj=t(this).closest(".wsf-sidebar"),t.WS_Form.this.sidebar_expanded_obj.addClass("wsf-sidebar-expanded")}),t('[data-action="wsf-sidebar-contract"]',t("#wsf-sidebars")).click(function(){t.WS_Form.this.sidebar_resize_reset()})},t.WS_Form.prototype.sidebar_render=function(e){this.sidebar_wrapper_add(e);var i=t.WS_Form.settings_form.sidebars[e],a=void 0!==i.static&&i.static,o=void 0!==i.buttons&&i.buttons,s=void 0!==i.nav&&i.nav,r=void 0!==i.expand&&i.expand,n=t("#wsf-sidebar-"+e),d=void 0!==i.label?i.label:"Title",_=void 0!==i.icon?i.icon:"default";if(void 0!==i.kb_url)var l='<a class="wsf-kb-url" href="'+this.get_plugin_website_url(i.kb_url,"sidebar")+'" target="_blank" title="'+this.language("field_kb_url")+'" tabindex="-1">'+this.svg("question-circle")+"</a>";if(n.html(this.sidebar_title(this.svg(_),d,"",l,"",r)),s){var c='<li data-action-sidebar="'+e+'" title="'+this.html_encode(d)+'">'+this.svg(_)+"</li>";t(".wsf-heading .wsf-settings").append(c)}if(a&&void 0!==i.meta){this.sidebar_cache_clear(n);var f=this.sidebar_html("form",this.form_id,this.form,i.meta,!1,!0,!0,!1,o),h=f.html_tabs,u=f.html,m=f.html_buttons,p=f.inits;n.append(h),n.append('<div class="wsf-sidebar-inner">'+u+"</div>"),n.append(m);var v=t(".wsf-sidebar-inner",n);this.sidebar_inits(p,n,v)}t('[data-action-sidebar="'+e+'"]').click(function(){var e=t(this).attr("data-action-sidebar");if(e!=t("[data-action-sidebar].wsf-editing").first().attr("data-action-sidebar")){var i=t(".wsf-editing",t("#wsf-form"));i.length&&t.WS_Form.this.object_cancel(i);var a="sidebar_"+e+"_open";if("function"==typeof window[a]){var o=t("#wsf-sidebar-"+e),s=t(".wsf-sidebar-inner",o);window[a](t.WS_Form.this,s,t(this))}else t.WS_Form.this.sidebar_open(e)}else{var r="sidebar_"+e+"_toggle";if("function"==typeof window[r]){o=t("#wsf-sidebar-"+e),s=t(".wsf-sidebar-inner",o);window[r](t.WS_Form.this,s,t(this))}else t.WS_Form.this.sidebar_reset()}}),!1!==o&&n.addClass("wsf-sidebar-has-footer")},t.WS_Form.prototype.sidebar_resize_reset=function(e){!1!==t.WS_Form.this.sidebar_expanded_obj&&t.WS_Form.this.sidebar_expanded_obj.removeClass("wsf-sidebar-expanded"),t.WS_Form.this.sidebar_expanded_obj=!1},t.WS_Form.prototype.sidebar_wrapper_add=function(e){var i='<div id="wsf-sidebar-'+e+'" class="wsf-sidebar wsf-sidebar-closed"></div>\n\n';t("#wsf-sidebars").append(i)},t.WS_Form.prototype.sidebar_form_history=function(){var e=t(".wsf-form-history ul");e.empty();for(var i=this.form_history.length-1;i>=0;i--){var a=this.form_history[i].history,o="",s="";if(0==i)o=t.WS_Form.settings_form.history.initial;else{var r=t.WS_Form.settings_form.history.method[a.method],n="";if(void 0!==a.id){a.id;void 0!==a.label&&(n=' <span class="wsf-history-highlight">'+a.label+"</span>")}o=r+n}this.history_index==i&&(s=' class="wsf-history-current"');var d='<li data-id="'+i+'"'+s+'><div class="date">'+a.time+'</div><div class="description">'+o+"</div></li>";e.append(d);var _=e.find('li[data-id="'+i+'"]').first();this.touch_device||_.mouseenter(function(){var e=t(this).attr("data-id");t.WS_Form.this.history_pull(e),t.WS_Form.this.sidebar_form_history_classes(e)}),_.click(function(){t.WS_Form.this.history_index=parseInt(t(this).attr("data-id")),t.WS_Form.this.history_pull(t.WS_Form.this.history_index,!0),t.WS_Form.this.sidebar_form_history_classes(t.WS_Form.this.history_index)})}this.sidebar_form_history_classes()},t.WS_Form.prototype.sidebar_form_history_classes=function(e){if(void 0===e)e=this.history_index;t(".wsf-form-history ul li").each(function(){t(this).removeClass("wsf-history-current").removeClass("wsf-history-undo").removeClass("wsf-history-redo");var i=parseInt(t(this).attr("data-id"));i==e&&t(this).addClass("wsf-history-current"),i>e&&t(this).addClass("wsf-history-redo"),i<e&&t(this).addClass("wsf-history-undo")})},t.WS_Form.prototype.history_push=function(e){if(this.preview_update(),this.form_history=this.form_history.slice(0,this.history_index+1),void 0!==(e=t.extend(!0,{},e)).history&&!1!==e.history){var i={form:e.form,history:e.history};this.form_history.push(i)}this.history_index=this.form_history.length-1,this.sidebar_form_history(),this.undo_redo_update(),this.breakpoint_buttons()},t.WS_Form.prototype.history_pull=function(e,i){if(void 0===i)i=!1;this.loader_on(),this.sidebar_reset(),this.form=t.extend(!0,{},this.form_history[e].form),this.data_cache_build(),i?this.form_put(!0,!0,!0):(this.form_build(),this.loader_off())},t.WS_Form.prototype.undo=function(){return 0!=this.history_index&&(!(this.form_history.length<=1)&&(this.history_index--,this.history_pull(this.history_index,!0),this.sidebar_form_history(),void this.undo_redo_update()))},t.WS_Form.prototype.redo=function(){var t=this.form_history.length;if(this.history_index==t-1)return!1;this.history_index++,this.history_pull(this.history_index,!0),this.sidebar_form_history(),this.undo_redo_update()},t.WS_Form.prototype.undo_redo_update=function(){var e=this.form_history.length;if(this.history_index>0){if(this.history_index>99)var i="";else i=this.history_index;t('[data-action="wsf-undo"]').removeClass("wsf-undo-inactive").find(".count").html(i)}else t('[data-action="wsf-undo"]').addClass("wsf-undo-inactive").find(".count").html("");if(this.history_index<e-1){if(this.history_index>99)i="";else i=e-1-this.history_index;t('[data-action="wsf-redo"]').removeClass("wsf-redo-inactive").find(".count").html(i)}else t('[data-action="wsf-redo"]').addClass("wsf-redo-inactive").find(".count").html("")},t.WS_Form.prototype.popover=function(e,i,a,o){var s=this;t(".wsf-popover").hide(),t(".wsf-popover").html(""),t(".wsf-group.wsf-ui-cancel").removeClass("wsf-ui-cancel"),t(".wsf-section.wsf-ui-cancel").removeClass("wsf-ui-cancel"),t(".wsf-field-wrapper.wsf-ui-cancel").removeClass("wsf-ui-cancel"),t(".wsf-data-grid-group-tab.wsf-ui-cancel").removeClass("wsf-ui-cancel");var r=t("#wsf-popover"),n="<p>"+e+"</p>";a.addClass("wsf-ui-cancel");var d=this.get_object_type(a),_=a.attr("data-id");switch(d){case"group":t('.wsf-group-tab[data-id="'+_+'"]').addClass("wsf-ui-cancel")}for(var l in i){var c=i[l],f=c.label,h=c.action,u="";void 0!==c.class&&(u=c.class),n+='<button class="wsf-button wsf-button-small',""!=u&&(n+=" "+u),n+='" data-action="'+h+'">'+f+"</button>"}r.html(n),r.css({opacity:0}),r.show();var m=a.offset(),p=r.innerWidth(),v=r.innerHeight();v+=6;var b=a.width(),g=t(window).width(),w=m.left+b/2-p/2,S=m.top-v,W=t("#wpcontent").offset();w<W.left&&(w=W.left),S<W.top&&(S=W.top),w+p>g&&(w=g-p),r.offset({left:w,top:S}),r.find("button[data-action]").each(function(){t(this).click(function(e){switch(e.preventDefault(),t(this).attr("data-action")){case"wsf-confirm":"function"==typeof o&&o()}r.hide(),r.html(""),a.removeClass("wsf-ui-cancel");var i=s.get_object_type(a),n=a.attr("data-id");switch(i){case"group":t('.wsf-group-tab[data-id="'+n+'"]').removeClass("wsf-ui-cancel")}})}),r.css({opacity:1})},t.WS_Form.prototype.settings_html=function(e,i,a){var o='<ul class="wsf-settings wsf-settings-'+e+' wsf-ui-cancel">',s=t.WS_Form.settings_form[e].buttons;for(var r in s){var n=s[r],d=n.name,_=n.icon,l=n.method;(a||"clone"!=l)&&(o+='<li data-id="'+i+'" data-action="'+l+'" title="'+this.html_encode(d)+'">'+_+"</li>")}return o+="</ul>"},t.WS_Form.prototype.settings_events=function(e,i){e.find(".wsf-settings-"+i+" li").each(function(){t(this).click(function(){var e="wsf_"+i+"_"+t(this).attr("data-action");if("undefined"!=(window[e],"string")){var a=t(".wsf-"+i+("field"==i?"-wrapper":"")+'[data-id="'+t(this).attr("data-id")+'"]').first();window[e](t.WS_Form.this,a,t(this))}})})},t.WS_Form.prototype.column_size_change_html=function(){return'<div class="wsf-column-size wsf-ui-cancel" title="'+this.language("column_size_change")+'"></div>'},t.WS_Form.prototype.column_size_change_init=function(e){e.find(".wsf-column-size").last().mousedown(function(){t.WS_Form.this.mouseup_mode="column_size",t("body").addClass("wsf-column-size-change-body"),e.addClass("wsf-column-size-change"),t.WS_Form.this.column_size_change_obj=e;var i=e.parent().innerWidth(),a=e.attr("data-id");if(e.hasClass("wsf-section")){"resize"==t.WS_Form.settings_plugin.helper_columns&&e.closest(".wsf-group").addClass("wsf-column-helper");var o=t.WS_Form.this.section_data_cache[a]}if(e.hasClass("wsf-field-wrapper")){"resize"==t.WS_Form.settings_plugin.helper_columns&&e.closest(".wsf-section").addClass("wsf-column-helper");o=t.WS_Form.this.field_data_cache[a]}!1!==t.WS_Form.this.object_data_scratch&&t.WS_Form.this.object_data_scratch.id==a&&(o=t.WS_Form.this.object_data_scratch);var s=t.WS_Form.settings_plugin.framework,r=(s=t.WS_Form.frameworks.types[s]).columns.column_count,n=s.breakpoints,d=t.WS_Form.this.get_object_meta_value(t.WS_Form.this.form,"breakpoint");t.WS_Form.this.column_size=r;var _=0;for(var l in n){n[l];var c="breakpoint_size_"+l;""!=(f=t.WS_Form.this.get_object_meta_value(o,c,"",!1))&&(t.WS_Form.this.column_size=parseInt(f));var f;c="breakpoint_offset_"+l;if(""!=(f=t.WS_Form.this.get_object_meta_value(o,c,"",!1))&&(_=parseInt(f)),l==d)break}t.WS_Form.this.column_size_old=t.WS_Form.this.column_size;var h=e.offset().left,u=e.width(),m=r-_;t(document).bind("mousemove",function(a){a.preventDefault(),t.WS_Form.this.column_size_change(a,e,h,u,i,o,m)})})},t.WS_Form.prototype.column_size_change=function(e,i,a,o,s,r,n){if(!1!==this.column_size_change_obj){if(ws_form_settings.rtl)var d=a+o-e.pageX;else d=e.pageX-a;d<0&&(d=0);var _=t.WS_Form.settings_plugin.framework_column_count,l=Math.round(d/s*_+.5);if(l<1&&(l=1),l>n&&(l=n),l!=this.column_size){this.column_classes_render(i,r,!1);var c=this.get_object_meta_value(this.form,"breakpoint");this.column_size_set(r,c,l),this.column_classes_render(i,r);var f=i.attr("data-id"),h=this.get_object_type(i);!1!==t.WS_Form.this.object_data_scratch&&t("#wsf-sidebar-"+h+" .wsf-breakpoint-sizes").length&&t.WS_Form.this.object_data_scratch.id==f&&t("#wsf-sidebar-"+h+" .wsf-breakpoint-sizes").get(0).render(),this.column_size=l}}},t.WS_Form.prototype.column_size_change_release=function(){var e=this.column_size_change_obj;if(!1!==this.column_size_change_obj){if(this.column_size!=this.column_size_old){this.loader_on();var i=e.attr("data-id"),a=!1,o={},s=this.get_object_meta_value(this.form,"breakpoint");if(e.hasClass("wsf-section")){this.column_size_set(this.section_data_cache[i],s,this.column_size);var r=this.section_data_cache[i];a="section",o={section:this.section_data_cache[i]}}if(e.hasClass("wsf-field-wrapper"))switch(this.column_size_set(this.field_data_cache[i],s,this.column_size),a="field",o={field:r=this.field_data_cache[i]},void 0!==r.type&&r.type){case"checkbox":case"radio":this.orientation_breakpoint_optimize(r)}if(!1===a)return!1;this.breakpoint_optimize(r),o.history_method="put_resize",this.api_call(a+"/"+i,"PUT",o,function(e){t.WS_Form.this.loader_off()})}e.removeClass("wsf-column-size-change"),"resize"==t.WS_Form.settings_plugin.helper_columns&&t(".wsf-column-helper").removeClass("wsf-column-helper"),t("body").removeClass("wsf-column-size-change-body"),this.column_size_change_obj=!1,this.column_size=0,this.mouseup_mode=!1,t(document).unbind("mousemove")}},t.WS_Form.prototype.column_size_set=function(t,e,i){this.set_object_meta_value(t,"breakpoint_size_"+e,i)},t.WS_Form.prototype.offset_change_html=function(){return'<div class="wsf-offset wsf-ui-cancel" title="'+this.language("offset_change")+'"></div>'},t.WS_Form.prototype.offset_change_init=function(e){e.find(".wsf-offset").last().mousedown(function(){t.WS_Form.this.mouseup_mode="offset",t("body").addClass("wsf-offset-change-body"),e.addClass("wsf-offset-change"),t.WS_Form.this.offset_change_obj=e;var i=e.parent().innerWidth(),a=parseInt(e.attr("data-id"));if(e.hasClass("wsf-section")){"resize"==t.WS_Form.settings_plugin.helper_columns&&e.closest(".wsf-group").addClass("wsf-column-helper");var o=t.WS_Form.this.section_data_cache[a]}if(e.hasClass("wsf-field-wrapper")){"resize"==t.WS_Form.settings_plugin.helper_columns&&e.closest(".wsf-section").addClass("wsf-column-helper");o=t.WS_Form.this.field_data_cache[a]}!1!==t.WS_Form.this.object_data_scratch&&t.WS_Form.this.object_data_scratch.id==a&&(o=t.WS_Form.this.object_data_scratch);var s=t.WS_Form.settings_plugin.framework,r=(s=t.WS_Form.frameworks.types[s],parseInt(s.columns.column_count)),n=s.breakpoints,d=t.WS_Form.this.get_object_meta_value(t.WS_Form.this.form,"breakpoint");t.WS_Form.this.offset=0;var _=0;for(var l in n){var c=n[l];if(0==_)var f=void 0!==c.column_size_default?"column_count"==c.column_size_default?r:c.column_size_default:column_size_default;var h="breakpoint_offset_"+l;""!=(u=t.WS_Form.this.get_object_meta_value(o,h,"",!1))&&(t.WS_Form.this.offset=parseInt(u));var u;h="breakpoint_size_"+l;if(""!=(u=t.WS_Form.this.get_object_meta_value(o,h,"",!1))&&(f=parseInt(u)),l==d)break;_++}t.WS_Form.this.offset_old=t.WS_Form.this.offset;var m=e.offset().left,p=e.width(),v=r-f;t(document).bind("mousemove",function(a){a.preventDefault(),t.WS_Form.this.offset_change(a,e,m,p,i,o,v)})})},t.WS_Form.prototype.offset_change=function(e,i,a,o,s,r,n){if(!1!==this.offset_change_obj){if(ws_form_settings.rtl)var d=a+o-e.pageX;else d=e.pageX-a;var _=t.WS_Form.settings_plugin.framework_column_count,l=t.WS_Form.this.offset_old+Math.round(d/s*_+.5)-1;if(l<0&&(l=0),l>n&&(l=n),l!=this.offset){this.column_classes_render(i,r,!1);var c=this.get_object_meta_value(this.form,"breakpoint");this.offset_set(r,c,l),this.column_classes_render(i,r);var f=parseInt(i.attr("data-id")),h=this.get_object_type(i);!1!==t.WS_Form.this.object_data_scratch&&t("#wsf-sidebar-"+h+" .wsf-breakpoint-sizes").length&&t.WS_Form.this.object_data_scratch.id==f&&t("#wsf-sidebar-"+h+" .wsf-breakpoint-sizes").get(0).render(),this.offset=l}}},t.WS_Form.prototype.offset_change_release=function(){var e=this.offset_change_obj;if(!1!==this.offset_change_obj){if(this.offset!=this.offset_old){this.loader_on();var i=parseInt(e.attr("data-id")),a=!1,o={},s=this.get_object_meta_value(this.form,"breakpoint");if(e.hasClass("wsf-section")&&(this.offset_set(this.section_data_cache[i],s,this.offset),a="section",o={section:this.section_data_cache[i]}),e.hasClass("wsf-field-wrapper")&&(this.offset_set(this.field_data_cache[i],s,this.offset),a="field",o={field:this.field_data_cache[i]}),!1===a)return!1;o.history_method="put_offset",this.api_call(a+"/"+i,"PUT",o,function(e){t.WS_Form.this.loader_off()})}e.removeClass("wsf-offset-change"),"resize"==t.WS_Form.settings_plugin.helper_columns&&t(".wsf-column-helper").removeClass("wsf-column-helper"),t("body").removeClass("wsf-offset-change-body"),this.offset_change_obj=!1,this.offset=0,this.mouseup_mode=!1,t(document).unbind("mousemove")}},t.WS_Form.prototype.offset_set=function(t,e,i){this.set_object_meta_value(t,"breakpoint_offset_"+e,i.toString())},t.WS_Form.prototype.init_ui=function(){this.groups_sortable(),this.sections_sortable(),this.fields_sortable(),this.group_tabs_droppable(),this.object_blank_update()},t.WS_Form.prototype.groups_sortable=function(){t(".wsf-group-tabs").sortable({tolerance:"pointer",containment:"parent",scroll:!1,forceHelperSize:!0,revert:200,placeholder:"wsf-group-tab-placeholder",cancel:".wsf-ui-cancel, input[type=text]:not([readonly])",items:"> li:not(.wsf-ui-cancel)",start:function(e,i){var a=i.placeholder,o=["height: "+i.helper.height()+"px","width: "+i.helper.width()+"px"].join(";");a.attr("style",o),t.WS_Form.this.next_sibling_id_old=void 0!==a.next().attr("data-id")?a.next().attr("data-id"):0},stop:function(e,i){t.WS_Form.this.group_put_sort_index(i.item)}}).disableSelection()},t.WS_Form.prototype.sections_sortable=function(){t(".wsf-sections").sortable({tolerance:"pointer",forceHelperSize:!0,revert:200,placeholder:"wsf-section-placeholder",items:"> li",cancel:".wsf-section-blank, .wsf-ui-cancel, input[type=text]:not([readonly])",connectWith:".wsf-sections",start:function(e,i){var a=i.placeholder,o=i.helper.height(),s=i.helper.css("background-size"),r=i.helper.css("max-width"),n=["height: "+o+"px","-webkit-box-flex: 0","-ms-flex: 0 0 "+r,"flex: 0 0 "+r,"margin-left: "+s,"max-width: "+r].join(";");a.attr("style",n),t.WS_Form.this.next_sibling_id_old=void 0!==a.next().attr("data-id")?a.next().attr("data-id"):0,t.WS_Form.this.group_id_old=a.closest(".wsf-group").attr("data-id"),t.WS_Form.this.section_field_being_dragged=!0},over:function(e,i){t.WS_Form.this.object_blank_update(),i.helper.css("height","auto");var a=i.helper.height();i.placeholder.height(a)},stop:function(e,i){t.WS_Form.this.object_blank_update(),t.WS_Form.this.section_put_sort_index(i.item),t.WS_Form.this.section_field_being_dragged=!1}}).disableSelection()},t.WS_Form.prototype.fields_sortable=function(){t(".wsf-fields").sortable({tolerance:"pointer",forceHelperSize:!0,revert:200,placeholder:"wsf-field-placeholder",items:"> li",cancel:".wsf-field-blank, .wsf-ui-cancel, input[type=text]:not([readonly])",connectWith:".wsf-fields",start:function(e,i){if(!t.WS_Form.this.dragged_field){var a=i.placeholder,o=i.helper.height(),s=i.helper.css("background-size"),r=i.helper.css("max-width"),n=["height: "+o+"px","-webkit-box-flex: 0","-ms-flex: 0 0 "+r,"flex: 0 0 "+r,"margin-left: "+s,"max-width: "+r].join(";");a.attr("style",n),t.WS_Form.this.next_sibling_id_old=void 0!==a.next().attr("data-id")?a.next().attr("data-id"):0,t.WS_Form.this.section_id_old=a.closest(".wsf-section").attr("data-id"),t.WS_Form.this.section_field_being_dragged=!0}},over:function(e,i){t.WS_Form.this.object_blank_update(),i.helper.css("height","auto");var a=i.helper.height();i.placeholder.height(a),t.WS_Form.this.dragged_field?t.WS_Form.this.dragged_field.width(t(i.placeholder).width()):i.helper.width(t(i.placeholder).width())},out:function(e,i){t.WS_Form.this.object_blank_update()},stop:function(e,i){t.WS_Form.this.object_blank_update(),t.WS_Form.this.dragged_field?(t.WS_Form.this.dragged_field.removeAttr("style"),t.WS_Form.this.field_post(t.WS_Form.this.dragged_field),t.WS_Form.this.init_ui()):(t.WS_Form.this.field_put_sort_index(i.item),t.WS_Form.this.section_field_being_dragged=!1),t.WS_Form.this.dragged_field=null}}).disableSelection()},t.WS_Form.prototype.group_tabs_droppable=function(){t(".wsf-group-tab").droppable({accept:".wsf-section, .wsf-fields .wsf-field-wrapper",hoverClass:"wsf-group-tab-hover",tolerance:"pointer",over:function(e,i){if(t("a",e.target).click(),i.helper.hasClass("wsf-section"))var a=".wsf-sections";if(i.helper.hasClass("wsf-field-wrapper"))a=".wsf-fields";if(void 0!==a){var o=t(t(this).find("a").attr("href")).find(a).first();i.draggable.appendTo(o).show(),t(".wsf-sections").sortable("refreshPositions"),t(".wsf-fields").sortable("refreshPositions")}}})},t.WS_Form.prototype.svg=function(e){return void 0!==t.WS_Form.settings_form.icons[e]?t.WS_Form.settings_form.icons[e]:t.WS_Form.settings_form.icons.default},t.WS_Form.prototype.api_test=function(t,e){this.api_call("helper/test","GET",!1,function(i){void 0===i.error||i.error?e(void 0!==i.error_message&&i.error_message):t()},function(t){e(!1)})},t.WS_Form.prototype.framework_detect=function(t,e){this.api_call("helper/framework_detect","POST",!1,function(e){var i={type:e.data.type,name:e.data.framework.name};t(i)},e)},t.WS_Form.prototype.setup_push=function(t,e,i){this.api_call("helper/setup_push","POST",t,e,i)},t.WS_Form.prototype.wizard=function(){t("#wsf-form-add").tabs({activate:function(e,i){if("true"!==i.newPanel.attr("data-populated")){var a=i.newPanel.attr("data-action-id");void 0!==a&&t.WS_Form.this.wizards_populate(a)}}}),t('[data-action="wsf-add-blank"]').click(function(){t(window).scrollTop(),t.WS_Form.this.loader_on(),t.WS_Form.this.wizards_loading_on(),t("#ws-form-action").val("wsf-add-blank"),t("#ws-form-action-do").submit()}),t('li:not(.wsf-pro-required) [data-action="wsf-add-wizard"]').click(function(){t(window).scrollTop(),t.WS_Form.this.loader_on(),t.WS_Form.this.wizards_loading_on();var e=t(this).attr("data-id");t("#ws-form-action").val("wsf-add-wizard"),t("#ws-form-id").val(e),t("#ws-form-action-do").submit()}),t('[data-action="wsf-close"]',t("#wsf-list-sub-modal")).click(function(){t("#wsf-list-sub-modal").hide(),t("#wsf-list-sub-modal-backdrop").hide(),t(document).keydown=null}),t('[data-action="wsf-add-wizard-action-modal"]',t("#wsf-list-sub-modal")).click(function(){t(window).scrollTop();var e=t(this).attr("data-action-id"),i=t(this).attr("data-list-id"),a=t("#wsf-list-sub-id").val();""!=a&&(t.WS_Form.this.loader_on(),t("#wsf-list-sub-modal").hide(),t("#wsf-list-sub-modal-backdrop").hide(),t(document).keydown=null,t.WS_Form.this.wizards_loading_on(),t("#ws-form-action").val("wsf-add-action"),t("#ws-form-action-id").val(e),t("#ws-form-list-id").val(i),t("#ws-form-list-sub-id").val(a),t("#ws-form-action-do").submit())}),t("#wsf-list-sub-id").change(function(){t("#wsf-modal-buttons-list-sub button").attr("disabled",""==t(this).val()&&"")}),t(document).on("click",'[data-action="wsf-list-sub-action"]',function(e){e.preventDefault();var i=t(this).closest("[data-action-list-sub-modal-label]"),a=i?i.attr("data-action-list-sub-modal-label"):"List";t("#wsf-list-sub-modal .wsf-modal-title").html(a);var o=t(this).attr("data-action-id"),s=t(this).attr("data-list-id");t("#wsf-modal-buttons-list-sub button").attr("data-action-id",o),t("#wsf-modal-buttons-list-sub button").attr("data-list-id",s),t("#wsf-modal-buttons-list-sub button").attr("disabled",""),t("#wsf-list-sub-modal-backdrop").show(),t("#wsf-list-sub-modal").show(),t(document).keydown(function(t){27==t.keyCode&&wsf_add_form_modal_close()});o=t(this).attr("data-action-id"),s=t(this).attr("data-list-id");var r=t.WS_Form.this.action_api_method_path(o,"list_subs_fetch",s);t("#wsf-list-sub-id").empty().append(t("<option />").val("").text(t.WS_Form.this.language("list_subs_call"))),t.WS_Form.this.api_call(r,"GET",!1,function(e){if(e.error)return t.WS_Form.this.loader_off(),t("#wsf-list-sub-modal-backdrop").hide(),t("#wsf-list-sub-modal").hide(),void t.WS_Form.this.error("error_action_list_sub_get");t("#wsf-list-sub-id").empty().append(t("<option />").val("").text(t.WS_Form.this.language("list_subs_select")));var i=e.data;for(var a in i){var o=i[a];t("#wsf-list-sub-id").append(t("<option />").val(o.id).text(o.label))}t.WS_Form.this.loader_off()})}),t(document).on("click","#wsf-list-sub-modal-backdrop",function(t){wsf_add_form_modal_close()});var e=t("#wsf-form-add");this.api_reload_init(e,function(e,i,a){switch(a){case"lists_fetch":t.WS_Form.this.wizards_populate(i)}},null,!1),this.get_configuration(function(){t.WS_Form.this.loader_off()})},t.WS_Form.prototype.wizards_loading_on=function(e){t("#wsf-form-add").hide(),t("#wsf-form-add-loading").show()},t.WS_Form.prototype.wizards_populate=function(e){t.WS_Form.this.loader_on();var i=t("#wsf_wizard_category_"+e+" ul.wsf-templates");t.WS_Form.this.api_call("wizard/action/"+e,"GET",[],function(a){if(a.error)t.WS_Form.this.loader_off();else{var o=a.data,s="",r=0;for(var n in o){var d=o[n],_=d.id,l=d.label,c=d.svg,f=void 0!==d.list_sub&&d.list_sub?"wsf-list-sub-action":"wsf-add-wizard-action";s+='<li><div class="wsf-template" data-action="'+f+'" data-action-id="'+t.WS_Form.this.html_encode(e)+'" data-list-id="'+t.WS_Form.this.html_encode(_)+'" title="'+t.WS_Form.this.html_encode(l)+'">',s+=c,s+="</div>",s+='<button class="wsf-button wsf-button-primary wsf-button-full" data-action="'+f+'" data-action-id="'+t.WS_Form.this.html_encode(e)+'" data-list-id="'+t.WS_Form.this.html_encode(_)+'">'+ws_form_settings_language_form_add_create+"</button>",s+="</li>",r++}r>0&&(t("li:not(:first-child)",i).remove(),i.append(s)),t("#wsf_wizard_category_"+e).attr("data-populated","true"),t('[data-action="wsf-add-wizard-action"]',i).click(function(){t.WS_Form.this.loader_on(),t.WS_Form.this.wizards_loading_on();var e=t(this).attr("data-action-id"),i=t(this).attr("data-list-id");t("#ws-form-action").val("wsf-add-action"),t("#ws-form-action-id").val(e),t("#ws-form-list-id").val(i),t("#ws-form-action-do").submit()}),t.WS_Form.this.loader_off()}})},t.WS_Form.prototype.wp_list_table_form=function(){this.form_id=0,t("[data-action]",t("#wsf-form-list-table")).click(function(){t("#wsf-action").val(t(this).attr("data-action")),t("#wsf-id").val(t(this).attr("data-id")),t("#wsf-action-do").submit()});var e=t("#wsf-form-list-table");t("table.wp-list-table",e).wrap('<div id="wsf-form-table"></div>');var i=t("#wsf-form-table");i.append('<div class="wsf-form-upload-json-window"><div class="wsf-form-upload-json-window-content"><h1></h1><div class="wsf-uploads"></div></div></div>'),i.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t(".wsf-form-upload-json-window",t(this)).fadeIn(200)}),t(".wsf-form-upload-json-window",i).on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),t(".wsf-form-upload-json-window",i).on("drop",function(e){e.preventDefault();var a=e.originalEvent.dataTransfer.files;t.WS_Form.this.form_upload_json(a,t(this),function(){location.reload()},function(){t(".wsf-form-upload-json-window",i).fadeOut(200)})}),t(".wsf-form-upload-json-window",i).on("dragleave",function(e){t(".wsf-form-upload-json-window",i).fadeOut(200)}),t('[data-action-button="wsf-form-upload"]').click(function(e){t('input[id="wsf-form-upload-file"]').click()}),t('input[id="wsf-form-upload-file"]').change(function(){var e=t('input[id="wsf-form-upload-file"]').prop("files");if(e.length>0){var a=t(".wsf-form-upload-json-window",i);a.fadeIn(200),t.WS_Form.this.form_upload_json(e,a,function(){location.reload()},function(){t(".wsf-form-upload-json-window",i).fadeOut(200)})}}),t('[data-action-ajax="wsf-form-status"]').click(function(){var e=t(this).attr("data-id"),i=t(this).is(":checked");t.WS_Form.this.loader_on();var a=t("#wsf-status-"+e+"-label");i?(a.attr("title",t.WS_Form.this.language("publish")),t.WS_Form.this.api_call("form/"+e+"/publish/","PUT",!1,function(e){t.WS_Form.this.loader_off()})):(a.attr("title",t.WS_Form.this.language("draft")),t.WS_Form.this.api_call("form/"+e+"/draft/","PUT",!1,function(e){t.WS_Form.this.loader_off()}))}),t('[data-action-ajax="wsf-form-locate"]').click(function(e){e.preventDefault();var i=t(this);i.blur();var a=t(this).attr("data-id");t.WS_Form.this.loader_on(),t.WS_Form.this.api_call("form/"+a+"/locations/","GET",!1,function(e){t.WS_Form.this.loader_off();var o=[];if(void 0!==e[a])for(var s in e[a]){var r=e[a][s],n=(s=r.id,r.type),d=t.WS_Form.this.html_encode(r.type_name),_=t.WS_Form.this.html_encode(r.title);switch(r.type){case"widget":o.push(d+': <a href="widgets.php">'+_+"</a>");break;default:o.push(d+': <a href="post.php?post='+s+"&post_type="+n+'&action=edit">'+_+"</a>")}}if(0==o.length)var l='<div class="wsf-helper">'+t.WS_Form.this.language("form_location_not_found")+"</div>";else l='<div class="wsf-helper">'+t.WS_Form.this.language("form_location_found",'<span class="ws-form-location">'+o.join(', </span><span class="wsf-form-location">'),!1)+"</div>";var c=i.closest(".row-actions"),f=i.closest("td"),h=t(".wsf-form-locations",f);h.length?h.html(l):c.before('<div class="wsf-form-locations">'+l+"</div>")})}),t("[data-action-copy]",t("#wsf-form-list-table")).click(function(e){e.preventDefault();var i=t(this).html();if(void 0!==i){var a=t("<input>");t("body").append(a),a.val(i).select(),document.execCommand("copy"),a.remove();var o=t(this).closest("td");o.append('<div class="wsf-helper">'+t.WS_Form.this.language("shortcode_copied")+"</div>"),setTimeout(function(){t(".wsf-helper",o).remove()},2e3)}})},t.WS_Form.prototype.wp_list_table_submit=function(e){t("#id-hide").parent().remove(),t("#wsf_filter_id").change(function(){t.WS_Form.this.wp_list_table_filter_do()}),this.form_id=e,0!=this.form_id&&(t(document).on("click",".hide-column-tog",function(){var e={hidden:columns.hidden()};t.WS_Form.this.api_call("helper/user_meta_hidden_column","POST",e,null,null,!1,!0,!0)}),t('[data-action-ajax="wsf-submit-starred"]').click(function(){var e=t(this).attr("data-id"),i=t(this).hasClass("wsf-starred-on"),a=t(this);t.WS_Form.this.loader_on(),i?(t(this).removeClass("wsf-starred-on"),a.attr("title",t.WS_Form.this.language("starred_off")),t.WS_Form.this.api_call("submit/"+e+"/starred/off/","PUT",!1,function(e){t.WS_Form.this.loader_off()})):(t(this).addClass("wsf-starred-on"),a.attr("title",t.WS_Form.this.language("starred_on")),t.WS_Form.this.api_call("submit/"+e+"/starred/on/","PUT",!1,function(e){t.WS_Form.this.loader_off()}))}),t('[data-action-ajax="wsf-submit-viewed"]').click(function(){var e=t(this).attr("data-id"),i=!t(this).closest("tr").hasClass("wsf-submit-not-viewed"),a=t(this);t.WS_Form.this.loader_on(),i?(a.closest("tr").addClass("wsf-submit-not-viewed"),a.html(t.WS_Form.this.language("viewed_off")),t.WS_Form.this.api_call("submit/"+e+"/viewed/off/","PUT",!1,function(e){window.wsf_admin_wp_count_submit_unread_ajax(t.WS_Form.this.form_id),t.WS_Form.this.loader_off()})):(a.closest("tr").removeClass("wsf-submit-not-viewed"),a.html(t.WS_Form.this.language("viewed_on")),t.WS_Form.this.api_call("submit/"+e+"/viewed/on/","PUT",!1,function(e){window.wsf_admin_wp_count_submit_unread_ajax(t.WS_Form.this.form_id),t.WS_Form.this.loader_off()}))}),this.get_configuration(function(){t.WS_Form.this.api_call("form/"+t.WS_Form.this.form_id+"/published","GET",!1,function(e){t.WS_Form.this.form=e.form,t.WS_Form.this.wp_list_table_submit_init(),t.WS_Form.this.keydown_events_init(),t.WS_Form.this.loader_off()},null,!1,!1,!0)}))},t.WS_Form.prototype.wp_list_table_submit_init=function(){if(t("#wpcontent").addClass("wsf-sidebar-closed"),this.set_globals("ws-form","public"),this.data_cache_build(),this.field_type_cache_build(),window.location.hash){var e=Number(window.location.hash.substring(1));isNaN(e)||t.WS_Form.this.submit_action("wsf-view",e)}t("[data-action]").click(function(){var e=t(this).attr("data-id"),i=t(this).attr("data-action");switch(i){case"wsf-view":case"wsf-edit":t.WS_Form.this.submit_action(i,e);break;case"wsf-export-all":t("#ws-form-action").val("wsf-export"),t("#ws-form-submit-id").val(""),t("#ws-form-action-do").submit();break;default:t("#ws-form-action").val(i),t("#ws-form-submit-id").val(e),t("#ws-form-action-do").submit()}}),t("#wsf_filter_do").click(function(e){t.WS_Form.this.wp_list_table_filter_do()}),t("#wsf_filter_reset").click(function(e){t("#wsf_filter_date_from").val(""),t("#wsf_filter_date_to").val(""),t.WS_Form.this.wp_list_table_filter_do()}),t("#wsf_filter_date_from,#wsf_filter_date_to").datepicker()},t.WS_Form.prototype.wp_list_table_filter_do=function(){t('#wsf-submissions form [name="_wp_http_referer"]').remove(),t('#wsf-submissions form [name="_wpnonce"]').remove(),t('#wsf-submissions form [name="action"]').attr("disabled","disabled"),t('#wsf-submissions form [name="action2"]').attr("disabled","disabled"),t("#current-page-selector").val("1"),t("#wsf-submissions form").submit()},t.WS_Form.prototype.submit_action=function(t,e){switch(t){case"wsf-view":this.submit_render(e,!0);break;case"wsf-edit":this.submit_render(e,!1)}},t.WS_Form.prototype.submit_render=function(e,i){var a=t('[data-action-ajax="wsf-submit-viewed"][data-id="'+e+'"]');a.closest("tr").removeClass("wsf-submit-not-viewed"),a.html(t.WS_Form.this.language("viewed_on"));var o=t("#wsf-sidebar-submit");t("h2 span",o).html(""),this.api_call("submit/"+e,"GET",!1,function(e){if(void 0!==e.data){var a=e.data;!(void 0!==a.preview&&a.preview)&&t.WS_Form.this.form.published_checksum?t.WS_Form.this.submit_render_do(a,t.WS_Form.this.form,i):!1===t.WS_Form.this.form_draft?t.WS_Form.this.api_call("form/"+t.WS_Form.this.form_id+"/full","GET",!1,function(e){t.WS_Form.this.form_draft=e.form,t.WS_Form.this.submit_render_do(a,t.WS_Form.this.form_draft,i)}):t.WS_Form.this.submit_render_do(a,t.WS_Form.this.form_draft,i),window.wsf_admin_wp_count_submit_unread_ajax(t.WS_Form.this.form_id)}})},t.WS_Form.prototype.submit_render_do=function(e,i,a){var o=t.extend(!0,{},e),s=t("#wsf-sidebar-submit");if(void 0!==i&&void 0!==i.groups&&parseInt(e.form_id)===parseInt(this.form_id)){var r=i.groups.length>1,n=void 0!==e.meta,d=e.encrypted?'<div class="wsf-encrypted" title="'+this.language("submit_encrypted")+'">'+this.svg("readonly")+"</div>":"",_=void 0!==e.section_repeatable&&e.section_repeatable,l='<div data-action="wsf-sidebar-expand" title="'+this.language("sidebar_expand")+'">'+this.svg("expand")+"</div>";l+='<div data-action="wsf-sidebar-contract" title="'+this.language("sidebar_contract")+'">'+this.svg("contract")+"</div>";var c='<div class="wsf-sidebar-header"><h2>'+this.svg("table")+this.language("submission")+d+"<span></span></h2>"+l+"</div>",f='<table id="wsf-sidebar-info">';f+=this.submit_row_render(e,"status_full",this.language("submit_status"),"status"),f+=this.submit_row_render(e,"date_added_wp",this.language("submit_date_added")),f+=this.submit_row_render(e,"date_updated_wp",this.language("submit_date_updated")),f+=this.submit_row_render(e,"user_id",this.language("submit_user"),"user"),f+=this.submit_row_render(e,"duration",this.language("submit_duration"),"duration"),f+="</table>";var h='<form class="wsf-sidebar-inner" id="ws-form-submit" data-id="'+e.id+'">';if(!n)return h;for(var u in i.groups){var m=i.groups[u];if(void 0!==m.sections&&0!=m.sections.length){var p=!1;for(var v in m.sections){var b=m.sections[v],g=b.id,w="section_"+g,S=!1!==_&&void 0!==_[w]&&void 0!==_[w].index?_[w].index:[!1];for(var W in b.fields){var F=b.fields[W];if(void 0!==t.WS_Form.field_type_cache[F.type])void 0!==(q=t.WS_Form.field_type_cache[F.type]).submit_save&&q.submit_save||delete b.fields[W]}if(b.fields=t.grep(b.fields,function(t){return 0==t||t}),void 0!==b.fields&&0!=b.fields.length){for(var y in h+='<fieldset class="wsf-fieldset">',r&&!p&&(h+="<h3>"+this.html_encode(m.label)+"</h3>\n",p=!0),b.meta.label_render&&(h+="<legend>"+this.html_encode(b.label)+"</legend>\n"),S){var k=S[y],x="";if(!1!==k){if((k=parseInt(k))<=0)continue;h+='<fieldset class="wsf-fieldset wsf-fieldset-repeatable" data-repeatable data-repeatable-index="'+k+'" data-id="'+g+'"><legend>#'+(parseInt(y)+1)+"</legend>";x="_"+k}for(var W in b.fields){F=b.fields[W];var j=this.field_name_prefix+F.id+x,C=void 0!==e.meta[j]?e.meta[j].value:"",z=F.type;switch(F.type){case"rating":a||(F.type="range",F.meta.min="0",F.meta.max=F.meta.rating_max,F.meta.help="#value",this.field_data_cache[F.id].meta.help="#value")}if(h+='<div class="wsf-field-wrapper" data-id="'+F.id+'" data-type="'+F.type+'"'+(k?' data-repeatable-index="'+k+'"':"")+">",void 0!==t.WS_Form.field_type_cache[F.type]){var q,I=void 0!==(q=t.WS_Form.field_type_cache[F.type]).submit_edit&&q.submit_edit,T=void 0!==q.submit_edit_type?q.submit_edit_type:F.type;T!==F.type&&(F.type=T);var O=a||!I;if(I?void 0===e.meta[j]&&(o.meta[j]={id:F.id,value:"",type:F.type}):delete o.meta[j],O)var P="<div><strong>"+this.html_encode(F.label)+"</strong><br />#field</div>";else P="#field";var U=!1;switch(T){case"signature":if(O||(P='<label class="wsf-label">'+this.html_encode(F.label)+"</label>#field"),"object"==typeof C&&"object"==typeof C[0]){var A=C[0],N=this.html_encode(A.name);U='<a href="'+this.file_download_url(e.hash,F.id,k,0,!0)+'" title="'+N+'"><img src="'+this.file_download_url(e.hash,F.id,k,0)+'" alt="'+N+'" class="wsf-responsive" /></a>'}break;case"file":if("object"==typeof C&&"object"==typeof C[0]){for(var M in P=O?"#field":'<label class="wsf-label">'+this.html_encode(F.label)+"</label>#field",U='<div class="wsf-table-outer"><table>',U+="<thead>",U+="<tr>",U+='<th colspan="4">'+this.html_encode(F.label)+"</th>",U+="</tr>",U+="</thead>",U+="<tbody>",C){A=C[M],N=this.html_encode(A.name);var D=A.type,E=this.svg(void 0!==t.WS_Form.file_types[D]?t.WS_Form.file_types[D].icon:t.WS_Form.file_types.default.icon);U+="<tr>",U+='<td class="wsf-submit-file-view" data-icon><a href="'+this.file_download_url(e.hash,F.id,k,M,!0)+'">'+E+"</a></td>",U+='<td><a href="'+this.file_download_url(e.hash,F.id,k,M,!0)+'" title="'+N+'">'+N+"</a></td>",U+='<td class="wsf-submit-file-view" data-icon><a href="'+this.file_download_url(e.hash,F.id,k,M,!0)+'">'+this.svg("download")+"</a></td>",U+='<td class="wsf-submit-file-download" data-icon><a href="'+this.file_download_url(e.hash,F.id,k,M,!1)+'" target="_blank">'+this.svg("visible")+"</a></td>",U+="</tr>"}U+="</tbody></table></div>"}break;case"datetime":C="object"==typeof C?C[O?"presentation_full":"mysql"]:""}if(O&&!1===U&&""!=C)switch(T){case"rating":var J=parseInt(C),R=this.get_object_meta_value(F,"rating_max",5);if(R||(R=5),J>=0&&J<=R){U='<ul class="wsf-submit-rating wsf-list-inline">';for(var H=0;H<R;H++){U+="<li"+(H<J?' class="wsf-submit-rating-on"':"")+">"+this.svg("rating")+"</li>"}U+="</ul>"}break;case"email":U='<a href="mailto:'+this.html_encode(C)+'">'+this.html_encode(C)+"</a>";break;case"tel":U='<a href="tel:'+this.html_encode(this.get_tel(C))+'">'+this.html_encode(C)+"</a>";break;case"url":U='<a href="'+this.html_encode(C)+'" target="_blank">'+this.html_encode(C)+"</a>";break;case"color":U='<span class="wsf-submit-color-sample" style="background:'+this.html_encode(C)+'"></span><span class="wsf-submit-color">'+this.html_encode(C)+"</span>";break;case"range":C=parseInt(C);var G=this.get_object_meta_value(this.field_data_cache[F.id],"min",0);(""==G||isNaN(G))&&(G=0);var L=this.get_object_meta_value(this.field_data_cache[F.id],"max",100);(""==L||isNaN(L))&&(L=100),""==C||isNaN(C)||(U=C>=1&&L-G>=1?'<progress class="wsf-progress" min="'+G+'" max="'+L+'" value="'+this.html_encode(C)+'"></progress><div class="wsf-helper">'+this.html_encode(C)+"</div>":this.html_encode(C))}O?("object"==typeof C&&(C=C.join("<br />")),!1===U&&(U=""==C?"-":C)):(P="#field",U=this.get_field_html_single(F,C,!0,k));var B={field:U};h+=this.mask_parse(P,B),h+="</div>",void 0!==e.meta[j]&&(e.meta[j].processed=!0),void 0!==z&&(F.type=z)}}!1!==x&&(h+="</fieldset>")}h+="</fieldset>"}}}}if(a){if(void 0!==e.meta.ecommerce_transaction_id||void 0!==e.meta.ecommerce_cart_total||void 0!==e.meta.woocommerce_order_id){var X=[];for(var K in t.WS_Form.ecommerce.cart_price_types){var Q=t.WS_Form.ecommerce.cart_price_types[K];if(K="ecommerce_cart_"+K,!1!==(C=void 0!==e.meta[K]&&e.meta[K])&&""!=C){C=this.get_price(parseFloat(C));var V=(Q.priority,Q.priority);X.push({label:Q.label,value:C,priority:V})}}for(var K in t.WS_Form.ecommerce.meta_keys){var $=t.WS_Form.ecommerce.meta_keys[K];if(void 0!==e.meta[K]){var Y=$.label;C=e.meta[K];if(void 0!==$.lookup&&void 0!==t.WS_Form.ecommerce[$.lookup]&&void 0!==t.WS_Form.ecommerce[$.lookup][C]&&(C=t.WS_Form.ecommerce[$.lookup][C].label),void 0!==$.type)switch($.type){case"price":C=this.get_price(parseFloat(C))}if(""==C)continue;V=($.priority,$.priority);var Z=void 0!==$.mask&&$.mask;!1!==Z&&(C=this.mask_parse(Z,{value:C})),X.push({label:Y,value:C,priority:V})}}if(X.sort(function(t,e){return(t=t.priority)<(e=e.priority)?-1:t>e?1:0}),X.length>0){var tt='<fieldset class="wsf-fieldset">\n';for(var et in tt+="<h3>"+this.language("submit_ecommerce")+"</h3>\n",X){var it=X[et];tt+='<div class="wsf-field-wrapper">',tt+="<div><strong>"+this.html_encode(it.label)+"</strong><br />"+it.value+"</div>",tt+="</div>\n"}h+=tt+="</fieldset>\n"}}var at=this.sidebar_render_actions(e);!1!==at&&(h+=at);var ot='<fieldset class="wsf-fieldset">\n';ot+="<h3>"+this.language("submit_tracking")+"</h3>\n";var st=0;for(var K in t.WS_Form.tracking){var rt=t.WS_Form.tracking[K];if(!1!==(C=void 0!==e.meta[K]&&e.meta[K])&&""!=C){switch(rt.type){case"url":C='<a href="'+this.html_encode(C)+'" target="_blank">'+this.html_encode(C)+"</a>";break;case"tel":C='<a href="tel:'+this.html_encode(C)+'" target="_blank">'+this.html_encode(C)+"</a>";break;case"email":C='<a href="email:'+this.html_encode(C)+'" target="_blank">'+this.html_encode(C)+"</a>";break;case"ip":var nt=t.WS_Form.settings_plugin.ip_lookup_url_mask;if(!nt){C=this.html_encode(C);break}var dt={value:C};C='<a href="'+this.mask_parse(nt,dt)+'" target="_blank">'+this.html_encode(C)+"</a>";break;case"latlon":if(/^(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)$/.test(C)){var _t=t.WS_Form.settings_plugin.latlon_lookup_url_mask;if(!_t){C=this.html_encode(C);break}var lt={value:C};C='<a href="'+this.mask_parse(_t,lt)+'" target="_blank">'+this.html_encode(C)+"</a>"}else switch(parseInt(C)){case 1:C=this.language("submit_tracking_geo_location_permission_denied");break;case 2:C=this.language("submit_tracking_geo_location_position_unavailable");break;case 3:C=this.language("submit_tracking_geo_location_timeout");break;default:C="-"}break;default:C=this.html_encode(C)}ot+='<div class="wsf-field-wrapper">',ot+="<div><strong>"+this.html_encode(rt.label)+"</strong><br />"+C+"</div>",ot+="</div>\n",st++}}ot+="</fieldset>\n",st>0&&(h+=ot)}h+="</form>";var ct=t("#wsf-submissions .wp-list-table tbody"),ft=t('[data-id="'+e.id+'"]',ct).first().closest("tr"),ht=ft.prev(),ut=ht.length?t('[data-action="wsf-view"]',ht).attr("data-id"):void 0,mt=ft.next(),pt=mt.length?t('[data-action="wsf-view"]',mt).attr("data-id"):void 0,vt=[{class:"wsf-button-primary",action:"wsf-sidebar-edit",label:this.language("edit")},{action:"wsf-sidebar-print",label:this.language("print")},{action:"wsf-sidebar-close",label:this.language("close")},{action:"wsf-sidebar-view",right:!0,id:ut,label:this.language("previous"),disabled:void 0===ut},{action:"wsf-sidebar-view",id:pt,label:this.language("next"),disabled:void 0===pt}],bt=[{class:"wsf-button-primary",action:"wsf-sidebar-save",label:this.language("save")},{class:"",action:"wsf-sidebar-cancel",label:this.language("cancel")},{class:"wsf-button-danger",right:!0,action:"wsf-sidebar-delete",label:this.language("trash")}],gt=this.sidebar_buttons_html(a?vt:bt);s.html(c),s.append(f),s.append(h),s.append(gt),t("#wsf-sidebar-submit .wsf-sidebar-header h2 span").html(this.language("id")+": "+e.id);var wt=t(".wsf-sidebar-inner",s);a?(t('[data-action="wsf-sidebar-view"]',s).click(function(){var e=t(this).attr("data-id");void 0!==e&&t.WS_Form.this.submit_render(e,!0)}),t('[data-action="wsf-sidebar-edit"]',s).click(function(){t.WS_Form.this.submit_render(e.id,!1)}),t('[data-action="wsf-sidebar-print"]',s).click(function(){window.print()}),t('[data-action="wsf-sidebar-close"]',s).click(function(){t("#wsf-sidebar-submit").removeClass("wsf-sidebar-open").addClass("wsf-sidebar-closed"),t("#wpcontent").removeClass("wsf-sidebar-open").addClass("wsf-sidebar-closed"),window.matchMedia("(max-width: 600px)").matches&&(t("html").css({overflow:""}),t("body").css({overflow:"","-webkit-overflow-scrolling":""}))}),t('[data-action="wsf-submit-action-repost"]',s).click(function(){var i=t(this),a=t(this).closest("tr"),o=[{label:t.WS_Form.this.language("cancel"),action:"wsf-cancel"},{label:t.WS_Form.this.language("repost"),action:"wsf-confirm",class:"wsf-button-danger"}];t.WS_Form.this.popover(t.WS_Form.this.language("confirm_action_repost"),o,a,function(){i.addClass("wsf-api-method-calling");var a={id:t.WS_Form.this.form_id,action_index:i.attr("data-submit-action-index")};t.WS_Form.this.api_call("submit/"+e.id+"/action","POST",a,function(e){if(i.removeClass("wsf-api-method-calling"),void 0===e.data)return!1;if(void 0!==e.data.logs&&e.data.logs.length){var a=e.data.logs.join("<br />");t.WS_Form.this.message(a,!0,"notice-success")}if(void 0!==e.data.errors&&e.data.errors.length){var o=e.data.errors.join("<br />");t.WS_Form.this.message(o,!0,"notice-error")}},function(){i.removeClass("wsf-api-method-calling")},!1,!0)})}),t("[data-toggle]",s).click(function(){t(this).attr("data-status","on"==t(this).attr("data-status")?"":"on");var e=t(this).attr("data-toggle");t("#"+e).toggle()})):(t('[data-action="wsf-sidebar-save"]',s).click(function(){t.WS_Form.this.submit_button_save(o)}),t('[data-action="wsf-sidebar-delete"]',s).click(function(){t("#ws-form-action").val("wsf-delete"),t("#ws-form-submit-id").val(o.id),t("#ws-form-action-do").submit()}),t('[data-action="wsf-sidebar-cancel"]',s).click(function(){t.WS_Form.this.submit_button_cancel(o)}),t.WS_Form.this.keydown[27]={function:function(){t.WS_Form.this.submit_button_cancel(o)},ctrl_key:!1},t.WS_Form.this.keydown[83]={function:function(){t.WS_Form.this.submit_button_save(o)},ctrl_key:!0},this.form_input_range(wt)),this.loader_off(),t("#wsf-sidebar-submit").removeClass("wsf-sidebar-closed").addClass("wsf-sidebar-open"),t("#wpcontent").removeClass("wsf-sidebar-closed").addClass("wsf-sidebar-open"),window.matchMedia("(max-width: 600px)").matches&&(t("html").css({overflow:"hidden"}),t("body").css({overflow:"auto","-webkit-overflow-scrolling":"touch"})),this.sidebar_expand_contract_init()}else this.loader_off()},t.WS_Form.prototype.submit_button_save=function(e){var i=t("#ws-form-submit"),a=new FormData(i[0]);for(var o in e.meta)if(-1!=o.indexOf(this.field_name_prefix)){var s=e.meta[o].repeatable_index,r=e.meta[o].id,n=this.field_name_prefix+r+(s?"["+s+"]":""),d=null!==a.get(n)?a.get(n):a.getAll(n+"[]")?a.getAll(n+"[]"):"";e.meta[o].value=d,delete e.meta[o].processed}var _={id:this.form_id,submit_id:e.id,submit:e};this.api_call("submit/"+e.id,"PUT",_,function(t){location.reload()})},t.WS_Form.prototype.submit_button_cancel=function(e){t.WS_Form.this.keydown=[],t.WS_Form.this.submit_render(e.id,!0)},t.WS_Form.prototype.sidebar_render_actions=function(e){if(void 0===e.actions)return!1;var i=e.actions;if(!1===i)return!1;if(0==i.length)return!1;var a='<fieldset id="wsf-submit-sctions" class="wsf-fieldset">\n';for(var o in a+="<h3>"+this.language("submit_actions")+"</h3>\n",a+='<div class="wsf-field-wrapper">',a+='<div class="wsf-table-outer">',a+="<table>\n",a+="<thead><tr>",a+='<th width="16">'+this.language("submit_actions_column_index")+"</th>",a+="<th>"+this.language("submit_actions_column_action")+"</th>",a+="<th></th>",a+="<th></th>",a+="<th></th>",a+="<th></th>",a+="</tr></thead>\n<tbody>\n",i){var s=i[o=parseInt(o)],r=s.id,n=s.label,d=(s.meta,!!(void 0!==t.WS_Form.actions[r])&&t.WS_Form.actions[r]),_=void 0!==d.can_repost&&d.can_repost,l=this.sidebar_render_action_meta_html(d,s),c=this.sidebar_render_action_logs_html(s,"logs"),f=this.sidebar_render_action_logs_html(s,"errors");a+="<tr>",a+="<td>"+(o+1)+"</td>",a+="<td>"+this.html_encode(n)+"</td>",a+="<td data-icon>",!1!==l&&(a+='<div data-toggle="wsf-action-meta-'+o+'" title="'+this.language("submit_actions_meta")+'">'+this.svg("edit")+"</div>"),a+="</td><td data-icon>",!1!==c&&(a+='<div data-toggle="wsf-action-logs-'+o+'" title="'+this.language("submit_actions_logs")+'">'+this.svg("info-circle")+"</div>"),a+="</td><td data-icon>",!1!==f&&(a+='<div data-toggle="wsf-action-errors-'+o+'" title="'+this.language("submit_actions_errors")+'">'+this.svg("warning")+"</div>"),a+="</td><td data-icon>",_&&(a+='<div data-action="wsf-submit-action-repost" data-submit-action-index="'+o+'" title="'+this.language("submit_actions_repost")+'">'+this.svg("redo")+"</div>"),a+="</td></tr>\n",!1!==l&&(a+='<tr id="wsf-action-meta-'+o+'" class="wsf-hidden-table-row"><td colspan="6" class="wsf-hidden-table-cell"><div>',a+=l,a+="</div></td></tr>"),!1!==c&&(a+='<tr id="wsf-action-logs-'+o+'" class="wsf-hidden-table-row"><td colspan="6" class="wsf-hidden-table-cell"><div>',a+=c,a+="</div></td></tr>"),!1!==f&&(a+='<tr id="wsf-action-errors-'+o+'" class="wsf-hidden-table-row"><td colspan="6" class="wsf-hidden-table-cell"><div>',a+=f,a+="</div></td></tr>")}return a+="</tbody>\n</table>\n</div>\n</div>",a+="</fieldset>"},t.WS_Form.prototype.sidebar_render_action_meta_html=function(e,i){var a=i.id,o=this.get_action_meta_key_cache(e,a);if(void 0===i.meta)return!1;var s=i.meta;if(0==s.length)return!1;var r="<table>";for(var n in r+="<thead><tr>",r+="<th>"+this.language("submit_actions_column_meta_label")+"</th>",r+="<th>"+this.language("submit_actions_column_meta_value")+"</th>",r+="</tr></thead>\n<tbody>\n",s){var d=void 0!==o[n]?o[n].label:n,_=s[n];if("object"==typeof _){if(void 0===t.WS_Form.meta_keys[n])continue;var l=t.WS_Form.meta_keys[n];if(void 0===l.type)continue;switch(l.type){case"repeater":var c="<table>";for(var f in _){var h=_[f];for(var u in c+="<tr>",h){var m=h[u];c+="<td>"+this.html_encode(m)+"</td>"}c+="</tr>"}_=c+="</table>";break;default:_=JSON.stringify(_)}}else _=this.html_encode(_);r+="<tr><td>"+this.html_encode(d)+"</td><td>"+(""!=_?_:"-")+"</td></tr>"}return r+="</tbody>\n</table>"},t.WS_Form.prototype.sidebar_render_action_logs_html=function(t,e){if(void 0===t[e])return!1;var i=t[e];if(0==i.length)return!1;var a="<table>";for(var o in a+="<thead><tr>",a+="<th>"+this.language("submit_actions_column_"+e)+"</th>",a+="</tr></thead>\n<tbody>\n",i){var s=i[o];a+="<tr><td>"+this.html_encode(s)+"</td></tr>"}return a+="</tbody>\n</table>"},t.WS_Form.prototype.get_action_meta_key_cache=function(e,i){var a=[];if(void 0===e.fieldsets)return[];if(void 0===e.fieldsets[i])return[];if(void 0===e.fieldsets[i].meta_keys)return[];for(var o in e.fieldsets[i].meta_keys){var s=e.fieldsets[i].meta_keys[o];if(void 0!==t.WS_Form.meta_keys[s])void 0!==t.WS_Form.meta_keys[s].label&&(a[s]={label:t.WS_Form.meta_keys[s].label})}return a},t.WS_Form.prototype.file_download_url=function(t,e,i,a,o){if(void 0===o)o=!1;var s="helper/file_download",r="hash="+t+"&field_id="+e+"&section_repeatable_index="+(!1!==i?i:0)+"&file_index="+a+"&_wpnonce="+ws_form_settings.x_wp_nonce+"&"+ws_form_settings.wsf_nonce_field_name+"="+ws_form_settings.wsf_nonce+(o?"&download=1":"");return ws_form_settings.url+(ws_form_settings.permalink_custom?s+"?"+r:encodeURIComponent(s)+"&"+r)},t.WS_Form.prototype.submit_row_render=function(t,e,i,a){if(void 0!==t[e]){if(void 0===a)a="default";var o=void 0!==t.preview&&t.preview,s='<tr><th width="80">'+i+"</th><td>";switch(a){case"status":s+=t[e]+(o?" ("+this.language("submit_preview")+")":"");break;case"duration":s+=this.get_nice_duration(t[e]);break;case"user":var r=t[e];if(0===r||void 0===t.user)s+="-";else s+='<a href="user-edit.php?user_id='+r+'">'+t.user.display_name+"</a>";break;default:s+=t[e]}return s+="</td></tr>"}},t.WS_Form.prototype.key_generate=function(){if(void 0===t)var t=64;for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+-=[]\\{}|;':\",./<>?",i="",a=0;a<64;a++){var o=Math.round(Math.random()*e.length);o<0&&(o=0),o>e.length-1&&(o=e.length-1),i+=e[o]}return i},t.WS_Form.prototype.api_call=function(t,e,i,a,o,s,r,n){this.api_call_queue.push({ajax_path:t,method:e,params:i,success_callback:a,error_callback:o,checksum_request:s,bypass_loader:r,bypass_form_processing:n}),this.api_call_queue_running||this.api_call_process_next()},t.WS_Form.prototype.api_call_process_next=function(){if(0==this.api_call_queue.length)return this.api_call_queue_running=!1,!1;this.api_call_queue_running=!0;var t=this.api_call_queue.shift();this.api_call_process(t.ajax_path,t.method,t.params,t.success_callback,t.error_callback,t.checksum_request,t.bypass_loader,t.bypass_form_processing)},t.WS_Form.prototype.api_call_process=function(e,i,a,o,s,r,n,d){if(void 0===i)i="POST";if(void 0===a)a=!1;if(void 0===o)o=!1;if(void 0===s)s=!1;if(void 0===r)r=!1;if(void 0===n)n=!1;if(void 0===d)d=!1;r||n||this.loader_on();var _={};if(this.form_id>0)!1!==a&&(_.data=JSON.stringify(a),_.data=this.mod_security_fix(_.data)),_.id=this.form_id,_.form_tab_index=this.get_object_meta_value(this.form,"tab_index",0);else if(!1!==a)_=a;_.form_is_admin=!0,_[ws_form_settings.wsf_nonce_field_name]=ws_form_settings.wsf_nonce;var l=ws_form_settings.url+e,c={method:ws_form_settings.ajax_http_method_override?"POST":i,url:l,beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ws_form_settings.x_wp_nonce),ws_form_settings.ajax_http_method_override&&t.setRequestHeader("X-HTTP-Method-Override",i)},statusCode:{200:function(e){r||(t.WS_Form.checksum=!1),d||void 0===e.form||void 0!==e.form.checksum&&void 0!==e.form.published_checksum&&(t.WS_Form.this.published_checksum=e.form.published_checksum,t.WS_Form.this.publish_render(e.form.checksum)),0==t.WS_Form.this.api_call_queue.length&&(void 0!==e.form_full&&e.form_full&&(t.WS_Form.this.form=e.form),t.WS_Form.this.data_cache_build()),"function"==typeof o?o(e):t.WS_Form.this.loader_off(),d||void 0===e.history||t.WS_Form.this.history_push(e),t.WS_Form.this.api_call_process_next()},400:function(e){t.WS_Form.this.loader_off(),void 0===e.responseJSON&&t.WS_Form.this.error("error_bad_request");var i=e.responseJSON;"function"==typeof s?s(i):i.error&&(i.error_message?t.WS_Form.this.error("error_bad_request_message",i.error_message):t.WS_Form.this.error("error_bad_request")),t.WS_Form.this.api_call_process_next()},403:function(e){t.WS_Form.this.loader_off(),void 0===e.responseJSON&&t.WS_Form.this.error("error_forbidden");var i=e.responseJSON;void 0!==i.code&&"rest_cookie_invalid_nonce"==i.code&&location.reload(),"function"==typeof s?s(i):i.error&&t.WS_Form.this.error("error_forbidden"),t.WS_Form.this.api_call_process_next()},404:function(e){t.WS_Form.this.loader_off(),void 0===e.responseJSON&&t.WS_Form.this.error("error_not_found");var i=e.responseJSON;"function"==typeof s?s(i):i.error&&t.WS_Form.this.error("error_not_found"),t.WS_Form.this.api_call_process_next()},500:function(e){t.WS_Form.this.loader_off(),void 0===e.responseJSON&&t.WS_Form.this.error("error_server");var i=e.responseJSON;"function"==typeof s?s(i):i.error&&t.WS_Form.this.error("error_server"),t.WS_Form.this.api_call_process_next()}}};return!1!==_&&(c.data=_),t.ajax(c),this},t.WS_Form.prototype.publish_render=function(e){if(""==e)return!1;e!=this.published_checksum?t('[data-action="wsf-publish"]').prop("disabled",!1):t('[data-action="wsf-publish"]').prop("disabled",!0)},t.WS_Form.prototype.log=function(t){},t.WS_Form.prototype.error=function(t,e){if(void 0===e)e="";var i=this.language(t,e,!1).replace(/%s/g,e);this.message(i,!0,"notice-error")},t.WS_Form.prototype.message=function(e,i,a,o){if(void 0===s)var s="";if(void 0===i)i=!0;if(void 0===a)a="notice-success";if(void 0===o)o=!0;var r='<div class="notice '+a+'"><p>'+e+"</p>"+(i?'<button type="button" class="notice-dismiss"><span class="screen-reader-text">'+this.language("dismiss")+"</span></button>":"")+"</div>";if(r.replace("\n","<br />\n"),!o)return r;var n=t(r).insertAfter(t(".wp-header-end"));i&&t("button",n).click(function(){t(this).closest("div").remove()})},t.WS_Form.prototype.preview_update=function(){void 0!==this.preview_window&&void 0!==this.preview_window.location&&void 0!==this.preview_window.location.reload&&t.WS_Form.settings_plugin.helper_live_preview&&this.preview_window.location.reload()},window.sidebar_form_open=function(e,i,a){e.object_edit(t("#wsf-form"))},window.sidebar_form_toggle=function(e,i,a){t("#wsf-form").removeClass("wsf-editing"),e.sidebar_reset()},window.sidebar_form_close=function(e,i,a){t(".wsf-form").removeClass("wsf-editing")},window.sidebar_conditional_open=function(e,i,a){var o=t("#wsf-sidebar-conditional"),s=t.WS_Form.settings_form.sidebars.conditional;if(void 0!==s.kb_url)var r='<a class="wsf-kb-url" href="'+e.get_plugin_website_url(s.kb_url,"sidebar")+'" target="_blank" title="'+e.language("field_kb_url")+'" tabindex="-1">'+e.svg("question-circle")+"</a>";o.html(e.sidebar_title(e.svg(s.icon),s.label,"",r,"",!0)),o.append('<div class="wsf-sidebar-inner"><fieldset class="wsf-fieldset"><div class="wsf-data-grid" data-object="form" data-id="'+e.form_id+'" data-meta-key="conditional"></div></fieldset></div>'),o.append(e.sidebar_buttons_html());var n=e.get_object_data("form",e.form_id);e.object_data_scratch=t.extend(!0,{},n),e.sidebar_data_grids_init(t("#wsf-sidebar-conditional")),t('[data-action="wsf-sidebar-save"]',o).click(function(){e.sidebar_conditional_save(!1)}),t('[data-action="wsf-sidebar-save-close"]',o).click(function(){e.sidebar_conditional_save(!0)}),t('[data-action="wsf-sidebar-cancel"]',o).click(function(){e.sidebar_reset()}),t.WS_Form.this.keydown[27]={function:function(){e.sidebar_reset()},ctrl_key:!1},t.WS_Form.this.keydown[83]={function:function(){e.sidebar_conditional_save(!0)},ctrl_key:!0},e.sidebar_expand_contract_init(),e.sidebar_open("conditional")},t.WS_Form.prototype.sidebar_conditional_save=function(e){this.conditional_save();var i={};i.form_id=this.form_id,i.form=this.object_data_scratch,t.WS_Form.this.keydown=[],this.api_call("form/"+this.form_id,"PUT",i,function(e){t.WS_Form.this.save_notification(),t.WS_Form.this.loader_off()}),e&&this.sidebar_reset()},window.sidebar_action_open=function(e,i,a){var o=t("#wsf-sidebar-action"),s=t.WS_Form.settings_form.sidebars.action;if(void 0!==s.kb_url)var r='<a class="wsf-kb-url" href="'+e.get_plugin_website_url(s.kb_url,"sidebar")+'" target="_blank" title="'+e.language("field_kb_url")+'" tabindex="-1">'+e.svg("question-circle")+"</a>";o.html(e.sidebar_title(e.svg(s.icon),s.label,"",r,"",!0)),o.append('<div class="wsf-sidebar-inner"><fieldset class="wsf-fieldset"><div class="wsf-data-grid" data-object="form" data-id="'+e.form_id+'" data-meta-key="action"></div></fieldset></div>'),o.append(e.sidebar_buttons_html());var n=e.get_object_data("form",e.form_id);e.object_data_scratch=t.extend(!0,{},n),e.sidebar_data_grids_init(t("#wsf-sidebar-action")),t('[data-action="wsf-sidebar-save"]',o).click(function(){e.sidebar_action_save(!1)}),t('[data-action="wsf-sidebar-save-close"]',o).click(function(){e.sidebar_action_save(!0)}),t('[data-action="wsf-sidebar-cancel"]',o).click(function(){e.sidebar_reset()}),t.WS_Form.this.keydown[27]={function:function(){e.sidebar_reset()},ctrl_key:!1},t.WS_Form.this.keydown[83]={function:function(){e.sidebar_action_save(!0)},ctrl_key:!0},e.sidebar_expand_contract_init(),e.sidebar_open("action")},t.WS_Form.prototype.sidebar_action_save=function(e){this.action_save();var i={};i.form_id=this.form_id,i.form=this.object_data_scratch,t.WS_Form.this.keydown=[],this.api_call("form/"+this.form_id,"PUT",i,function(e){t.WS_Form.this.save_notification(),t.WS_Form.this.loader_off()}),e&&this.sidebar_reset()},window.sidebar_support_open=function(e,i,a){var o=t("#wsf-sidebar-support");t('[data-action="wsf-sidebar-cancel"]',o).click(function(){e.sidebar_reset()}),t.WS_Form.this.keydown[27]={function:function(){e.sidebar_reset()},ctrl_key:!1};e.sidebar_inits(["knowledgebase"],o),e.sidebar_open("support")},window.wsf_group_edit=function(t,e,i){t.object_edit(e)},window.wsf_group_clone=function(t,e,i){t.object_cancel(e),t.group_put_clone(e),t.sidebar_reset()},window.wsf_group_delete=function(t,e,i){var a=[{label:t.language("cancel"),action:"wsf-cancel"},{label:t.language("delete"),action:"wsf-confirm",class:"wsf-button-danger"}];t.popover(t.language("confirm_group_delete"),a,e,function(){t.object_cancel(e),t.object_delete(e),t.sidebar_reset()})},window.wsf_section_edit=function(t,e,i){t.object_edit(e)},window.wsf_section_clone=function(t,e,i){t.object_cancel(e),t.section_put_clone(e),t.sidebar_reset()},window.wsf_section_delete=function(t,e,i){var a=[{label:t.language("cancel"),action:"wsf-cancel"},{label:t.language("delete"),action:"wsf-confirm",class:"wsf-button-danger"}];t.popover(t.language("confirm_section_delete"),a,e,function(){t.object_cancel(e),t.object_delete(e),t.sidebar_reset()})},window.wsf_field_edit=function(t,e,i){t.object_edit(e)},window.wsf_field_clone=function(t,e,i){t.object_cancel(e),t.field_put_clone(e),t.sidebar_reset()},window.wsf_field_delete=function(t,e,i){var a=[{label:t.language("cancel"),action:"wsf-cancel"},{label:t.language("delete"),action:"wsf-confirm",class:"wsf-button-danger"}];t.popover(t.language("confirm_field_delete"),a,e,function(){t.object_cancel(e),t.object_delete(e),t.sidebar_reset()})}}(jQuery);